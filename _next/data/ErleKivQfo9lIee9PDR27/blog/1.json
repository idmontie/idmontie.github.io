{"pageProps":{"posts":[{"slug":"2023-08-14-partial-objects","date":"2023-08-14","title":"Forbidden Typescript: full/partial objects","frontmatter":{"title":"Forbidden Typescript: full/partial objects","tags":["typescript"]},"contentRaw":"\nWhen trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn’t know that the object is complete:\n\n```tsx\n/**\n * An example interface to demonstrate\n */\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial<KnownCodes> = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key in ['code1', 'code2', 'code3']) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes as KnownCodes;\n}\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n```\n\nIn the above example, we know that `knownCodes` will have all the keys will have values for the interface `KnownCodes`. However, Typescript can’t infer that, so we have to cast the value.\n\nAs the function gets more complex with additional feature work, this can become brittle and lead to some type-holes where we may have accidentally forgotten to set a key.\n\nOne way to get around this is to use an assert:\n\n```tsx\ntype RequireAll<T> = {\n  [K in keyof T]-?: T[K];\n};\n\nfunction ensureAllRequired<T>(obj: Partial<T>, template: RequireAll<T>): asserts obj is T {\n  for (const key in template) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial<KnownCodes> = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of ['code1', 'code2']) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  ensureAllRequired(knownCodes, TEMPALTE_CODES);\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n```\n\n[Playground link](https://www.typescriptlang.org/play?#code/C4TwDgpgBAShCOBXAlgJwgQQDZYDwBUA+KAXigG8AoKKAbQGkpkA7KAawhAHsAzKfALoBaAPwAufgwEBuSgF9ZlHomYBjYMi6sIzAM6J02LHCRoIAEwKEAFFwBGAKwkAFAIaoNrvEQA0UYBAAtmBYrgESJiiGOFYAlBKuuroQHrpQ9g5MafgU1FA8XKhQ1qpausDsnEysAcGhAbG5NDTIfLaOtBwgAqQkZCrmEDwsFo1Uzc3AABaoXADuUMwQCwCiqLOo1gAGALLISSwA5lDopujmUGCzkB4gEgAk5F1y1VCPAFIAygDyAHIAdOVUEdWiB2g5YnItrFZBM5Hl4fDKCwAqgeK5VNB6Mx5swAMJcQZpcZQUqDACMEmYiECdhSsNJhIgACYqTS6ahZABIMkQADMbNp9PklEopT0FXwKx2zgwABkpQB9PHfAAiK0+EmxuIJRNITUZFIkQnJPjyvNZUBNZpovIFVtNIqUKnUmlYqnQYQgADUvIgILoAGKFbVzfFM3TWeJQUPhvUk8Xldg4sO6gMudyePCxtO6YhkcgKUU0AD0JagAElWK4ThAvFAIAAPVx1CB+aYB6BdNKBVwgRmBaA8WaBKC6LiD9IdooZCDqPJl9JFJuo5j18xhVx5ApFEplCpddJ8WgAcl55JPfjPTOZJ4EYzyzTYKbjAc6VUSlW4fBzEZ6ZHMEA10CZBVF9LB-WsLoYQRYsGz0AxMBwSIzHMKCX1zPwpRleUlRVdVPhgvJ0GAAxWGfHUI1kJEPTrAJwP9IMQwwiMo0URdPlIux8kKfwpmgJsWxCCBnTUDQtCgQDgNAhiICgzgJCBI4xlrUjUFYAAGKAiyAA)\n\nThe above code does a **************runtime************** check that the object has all the keys that are defined in the template. This ensure that any missing keys are caught as well.\n\nI have seen other examples online where only the object is passed in, but this ends up not working if the keys are not defined in the object:\n\n```tsx\n\nfunction ensureAllRequired<T>(obj: Partial<T>): asserts obj is T {\n  for (const key in obj) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\n```\n\nThe above will let any empty object partial to pass the assert.\n\n## Takeaway\n\nThis ends up being a lot of work to do a runtime check to improve our typings, which I’m not sure is the best approach. Most of the time when we construct objects from an empty object, it’s difficult to ensure that the full object has been safely created.\n\nSince we have to create a template object anyway, it is almost always simpler to do the following:\n\n```tsx\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes = { ...TEMPALTE_CODES };\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of ['code1', 'code2', 'code3']) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n```\n\n[Playground link](https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgNIgPYHcQGEMAmEAzsgN4BQyyChEAjAFzIgCuAtgEbQDcVNdAEzM2XXv1pEAzCI7cofAL4UKtEMTDIAKgFEAsgAUAggBldAfVwB5ACI6Ays3TY8dUgF5yEuk2QBaegAabyJhfyCQiBlw4OUKGFYQBDBgDBAaKAg4SAA1OAAbVhIAMQwoZxx8ImIACgBKJ0xKty9qNQ1kAGsm12rkTzJkADoR3UNTC2s7e2RFPn4AegXkAEl0uGRMguQIAA84dgAHfIhA5DAACxIUTogAT1J2ODuBdhQYKAx2ZGIvlAxLtBkBhOAArCDJRbLMo7XaQKAgbYEbJwfgwGE1dqaW4vDAwZAAbQA5JIGESziShOTkJTpESALp1VrUajdFxVEgEnHIOCkHF4tA9DnEen9ZAEO6I9jABB5QoQGo4up8ahxaiZMCsBFdIVuJQqBBbXIFIrEUrlXXVerzJbIeyazjIdFQc5XWEHY4QeKJZKpdISqUyuVFRX3ZgaKCgADmTMGGq16QADLM+EA)\n\nHere we take the easy way out and clone the template and then built the object from there. Even if we forget to add a key (like `code3`) to our list of keys or its missing from our external data that we are using, we will be guaranteed that the return value is the correct shape and types.\n","contentHTML":"<p>When trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn’t know that the object is complete:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">/**\n * An example interface to demonstrate\n */\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial&lt;KnownCodes&gt; = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key in [&#x27;code1&#x27;, &#x27;code2&#x27;, &#x27;code3&#x27;]) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes as KnownCodes;\n}\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n</code></pre></div>\n<p>In the above example, we know that <code>knownCodes</code> will have all the keys will have values for the interface <code>KnownCodes</code>. However, Typescript can’t infer that, so we have to cast the value.</p>\n<p>As the function gets more complex with additional feature work, this can become brittle and lead to some type-holes where we may have accidentally forgotten to set a key.</p>\n<p>One way to get around this is to use an assert:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">type RequireAll&lt;T&gt; = {\n  [K in keyof T]-?: T[K];\n};\n\nfunction ensureAllRequired&lt;T&gt;(obj: Partial&lt;T&gt;, template: RequireAll&lt;T&gt;): asserts obj is T {\n  for (const key in template) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial&lt;KnownCodes&gt; = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of [&#x27;code1&#x27;, &#x27;code2&#x27;]) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  ensureAllRequired(knownCodes, TEMPALTE_CODES);\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n</code></pre></div>\n<p><a href=\"https://www.typescriptlang.org/play?#code/C4TwDgpgBAShCOBXAlgJwgQQDZYDwBUA+KAXigG8AoKKAbQGkpkA7KAawhAHsAzKfALoBaAPwAufgwEBuSgF9ZlHomYBjYMi6sIzAM6J02LHCRoIAEwKEAFFwBGAKwkAFAIaoNrvEQA0UYBAAtmBYrgESJiiGOFYAlBKuuroQHrpQ9g5MafgU1FA8XKhQ1qpausDsnEysAcGhAbG5NDTIfLaOtBwgAqQkZCrmEDwsFo1Uzc3AABaoXADuUMwQCwCiqLOo1gAGALLISSwA5lDopujmUGCzkB4gEgAk5F1y1VCPAFIAygDyAHIAdOVUEdWiB2g5YnItrFZBM5Hl4fDKCwAqgeK5VNB6Mx5swAMJcQZpcZQUqDACMEmYiECdhSsNJhIgACYqTS6ahZABIMkQADMbNp9PklEopT0FXwKx2zgwABkpQB9PHfAAiK0+EmxuIJRNITUZFIkQnJPjyvNZUBNZpovIFVtNIqUKnUmlYqnQYQgADUvIgILoAGKFbVzfFM3TWeJQUPhvUk8Xldg4sO6gMudyePCxtO6YhkcgKUU0AD0JagAElWK4ThAvFAIAAPVx1CB+aYB6BdNKBVwgRmBaA8WaBKC6LiD9IdooZCDqPJl9JFJuo5j18xhVx5ApFEplCpddJ8WgAcl55JPfjPTOZJ4EYzyzTYKbjAc6VUSlW4fBzEZ6ZHMEA10CZBVF9LB-WsLoYQRYsGz0AxMBwSIzHMKCX1zPwpRleUlRVdVPhgvJ0GAAxWGfHUI1kJEPTrAJwP9IMQwwiMo0URdPlIux8kKfwpmgJsWxCCBnTUDQtCgQDgNAhiICgzgJCBI4xlrUjUFYAAGKAiyAA\">Playground link</a></p>\n<p>The above code does a <strong><strong><strong><strong><strong><strong><strong>runtime</strong></strong></strong></strong></strong></strong></strong> check that the object has all the keys that are defined in the template. This ensure that any missing keys are caught as well.</p>\n<p>I have seen other examples online where only the object is passed in, but this ends up not working if the keys are not defined in the object:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">\nfunction ensureAllRequired&lt;T&gt;(obj: Partial&lt;T&gt;): asserts obj is T {\n  for (const key in obj) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\n</code></pre></div>\n<p>The above will let any empty object partial to pass the assert.</p>\n<h2>Takeaway</h2>\n<p>This ends up being a lot of work to do a runtime check to improve our typings, which I’m not sure is the best approach. Most of the time when we construct objects from an empty object, it’s difficult to ensure that the full object has been safely created.</p>\n<p>Since we have to create a template object anyway, it is almost always simpler to do the following:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">interface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes = { ...TEMPALTE_CODES };\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of [&#x27;code1&#x27;, &#x27;code2&#x27;, &#x27;code3&#x27;]) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n</code></pre></div>\n<p><a href=\"https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgNIgPYHcQGEMAmEAzsgN4BQyyChEAjAFzIgCuAtgEbQDcVNdAEzM2XXv1pEAzCI7cofAL4UKtEMTDIAKgFEAsgAUAggBldAfVwB5ACI6Ays3TY8dUgF5yEuk2QBaegAabyJhfyCQiBlw4OUKGFYQBDBgDBAaKAg4SAA1OAAbVhIAMQwoZxx8ImIACgBKJ0xKty9qNQ1kAGsm12rkTzJkADoR3UNTC2s7e2RFPn4AegXkAEl0uGRMguQIAA84dgAHfIhA5DAACxIUTogAT1J2ODuBdhQYKAx2ZGIvlAxLtBkBhOAArCDJRbLMo7XaQKAgbYEbJwfgwGE1dqaW4vDAwZAAbQA5JIGESziShOTkJTpESALp1VrUajdFxVEgEnHIOCkHF4tA9DnEen9ZAEO6I9jABB5QoQGo4up8ahxaiZMCsBFdIVuJQqBBbXIFIrEUrlXXVerzJbIeyazjIdFQc5XWEHY4QeKJZKpdISqUyuVFRX3ZgaKCgADmTMGGq16QADLM+EA\">Playground link</a></p>\n<p>Here we take the easy way out and clone the template and then built the object from there. Even if we forget to add a key (like <code>code3</code>) to our list of keys or its missing from our external data that we are using, we will be guaranteed that the return value is the correct shape and types.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    pre: \"pre\",\n    code: \"code\",\n    a: \"a\",\n    strong: \"strong\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"When trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn’t know that the object is complete:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * An example interface to demonstrate\\n */\\ninterface KnownCodes {\\n  code1: number;\\n  code2: number;\\n  code3: number;\\n}\\n\\nfunction createValuesForKnownCodes(): KnownCodes {\\n  const knownCodes: Partial<KnownCodes> = {};\\n\\n  // In a real example, these keys may come from some other object\\n  // or external data\\n  for (const key in ['code1', 'code2', 'code3']) {\\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\\n  }\\n\\n  return knownCodes as KnownCodes;\\n}\\n\\n// Stub for the example\\nfunction dynamicValue(key: string) { return 0 };\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the above example, we know that \", _jsx(_components.code, {\n        children: \"knownCodes\"\n      }), \" will have all the keys will have values for the interface \", _jsx(_components.code, {\n        children: \"KnownCodes\"\n      }), \". However, Typescript can’t infer that, so we have to cast the value.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As the function gets more complex with additional feature work, this can become brittle and lead to some type-holes where we may have accidentally forgotten to set a key.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"One way to get around this is to use an assert:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"type RequireAll<T> = {\\n  [K in keyof T]-?: T[K];\\n};\\n\\nfunction ensureAllRequired<T>(obj: Partial<T>, template: RequireAll<T>): asserts obj is T {\\n  for (const key in template) {\\n    if (obj[key] === undefined) {\\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\\n    }\\n  }\\n}\\n\\ninterface KnownCodes {\\n  code1: number;\\n  code2: number;\\n  code3: number;\\n}\\n\\nconst TEMPALTE_CODES: KnownCodes = {\\n  code1: -1,\\n  code2: -1,\\n  code3: -1,\\n}\\n\\nfunction createValuesForKnownCodes(): KnownCodes {\\n  const knownCodes: Partial<KnownCodes> = {};\\n\\n  // In a real example, these keys may come from some other object\\n  // or external data\\n  for (const key of ['code1', 'code2']) {\\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\\n  }\\n\\n  ensureAllRequired(knownCodes, TEMPALTE_CODES);\\n\\n  return knownCodes;\\n}\\n\\ncreateValuesForKnownCodes();\\n\\n// Stub for the example\\nfunction dynamicValue(key: string) { return 0 };\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/C4TwDgpgBAShCOBXAlgJwgQQDZYDwBUA+KAXigG8AoKKAbQGkpkA7KAawhAHsAzKfALoBaAPwAufgwEBuSgF9ZlHomYBjYMi6sIzAM6J02LHCRoIAEwKEAFFwBGAKwkAFAIaoNrvEQA0UYBAAtmBYrgESJiiGOFYAlBKuuroQHrpQ9g5MafgU1FA8XKhQ1qpausDsnEysAcGhAbG5NDTIfLaOtBwgAqQkZCrmEDwsFo1Uzc3AABaoXADuUMwQCwCiqLOo1gAGALLISSwA5lDopujmUGCzkB4gEgAk5F1y1VCPAFIAygDyAHIAdOVUEdWiB2g5YnItrFZBM5Hl4fDKCwAqgeK5VNB6Mx5swAMJcQZpcZQUqDACMEmYiECdhSsNJhIgACYqTS6ahZABIMkQADMbNp9PklEopT0FXwKx2zgwABkpQB9PHfAAiK0+EmxuIJRNITUZFIkQnJPjyvNZUBNZpovIFVtNIqUKnUmlYqnQYQgADUvIgILoAGKFbVzfFM3TWeJQUPhvUk8Xldg4sO6gMudyePCxtO6YhkcgKUU0AD0JagAElWK4ThAvFAIAAPVx1CB+aYB6BdNKBVwgRmBaA8WaBKC6LiD9IdooZCDqPJl9JFJuo5j18xhVx5ApFEplCpddJ8WgAcl55JPfjPTOZJ4EYzyzTYKbjAc6VUSlW4fBzEZ6ZHMEA10CZBVF9LB-WsLoYQRYsGz0AxMBwSIzHMKCX1zPwpRleUlRVdVPhgvJ0GAAxWGfHUI1kJEPTrAJwP9IMQwwiMo0URdPlIux8kKfwpmgJsWxCCBnTUDQtCgQDgNAhiICgzgJCBI4xlrUjUFYAAGKAiyAA\",\n        children: \"Playground link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The above code does a \", _jsx(_components.strong, {\n        children: _jsx(_components.strong, {\n          children: _jsx(_components.strong, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.strong, {\n                children: _jsx(_components.strong, {\n                  children: _jsx(_components.strong, {\n                    children: \"runtime\"\n                  })\n                })\n              })\n            })\n          })\n        })\n      }), \" check that the object has all the keys that are defined in the template. This ensure that any missing keys are caught as well.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I have seen other examples online where only the object is passed in, but this ends up not working if the keys are not defined in the object:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"\\nfunction ensureAllRequired<T>(obj: Partial<T>): asserts obj is T {\\n  for (const key in obj) {\\n    if (obj[key] === undefined) {\\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\\n    }\\n  }\\n}\\n\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The above will let any empty object partial to pass the assert.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaway\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This ends up being a lot of work to do a runtime check to improve our typings, which I’m not sure is the best approach. Most of the time when we construct objects from an empty object, it’s difficult to ensure that the full object has been safely created.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Since we have to create a template object anyway, it is almost always simpler to do the following:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"interface KnownCodes {\\n  code1: number;\\n  code2: number;\\n  code3: number;\\n}\\n\\nconst TEMPALTE_CODES: KnownCodes = {\\n  code1: -1,\\n  code2: -1,\\n  code3: -1,\\n}\\n\\nfunction createValuesForKnownCodes(): KnownCodes {\\n  const knownCodes = { ...TEMPALTE_CODES };\\n\\n  // In a real example, these keys may come from some other object\\n  // or external data\\n  for (const key of ['code1', 'code2', 'code3']) {\\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\\n  }\\n\\n  return knownCodes;\\n}\\n\\ncreateValuesForKnownCodes();\\n\\n// Stub for the example\\nfunction dynamicValue(key: string) { return 0 };\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgNIgPYHcQGEMAmEAzsgN4BQyyChEAjAFzIgCuAtgEbQDcVNdAEzM2XXv1pEAzCI7cofAL4UKtEMTDIAKgFEAsgAUAggBldAfVwB5ACI6Ays3TY8dUgF5yEuk2QBaegAabyJhfyCQiBlw4OUKGFYQBDBgDBAaKAg4SAA1OAAbVhIAMQwoZxx8ImIACgBKJ0xKty9qNQ1kAGsm12rkTzJkADoR3UNTC2s7e2RFPn4AegXkAEl0uGRMguQIAA84dgAHfIhA5DAACxIUTogAT1J2ODuBdhQYKAx2ZGIvlAxLtBkBhOAArCDJRbLMo7XaQKAgbYEbJwfgwGE1dqaW4vDAwZAAbQA5JIGESziShOTkJTpESALp1VrUajdFxVEgEnHIOCkHF4tA9DnEen9ZAEO6I9jABB5QoQGo4up8ahxaiZMCsBFdIVuJQqBBbXIFIrEUrlXXVerzJbIeyazjIdFQc5XWEHY4QeKJZKpdISqUyuVFRX3ZgaKCgADmTMGGq16QADLM+EA\",\n        children: \"Playground link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here we take the easy way out and clone the template and then built the object from there. Even if we forget to add a key (like \", _jsx(_components.code, {\n        children: \"code3\"\n      }), \") to our list of keys or its missing from our external data that we are using, we will be guaranteed that the return value is the correct shape and types.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nWhen trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn’t know that the object is complete:","excerptHTML":"<p>When trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn’t know that the object is complete:</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"When trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn’t know that the object is complete:\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-13-reviewing-frontend-applications","date":"2023-08-13","title":"Reviewing Your Frontend Applications","frontmatter":{"title":"Reviewing Your Frontend Applications","tags":["frontend","onboarding","documentation"]},"contentRaw":"\nBelow are some notes I’ve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\n\n## Onboarding\n\nWhen new members start, do you have processes and documentation in place to make onboarding easy?\n\n☐ Is your process written down?\n\n☐ Add a note for people onboarding continue to improve it when they walk through it. Every time a new members onboards, they should follow the documentation and update it with any missing steps or new errors and resolutions if they come across them.\n\n## Environment Setup\n\nPart of onboarding is getting your environment set up. Usually, a team will have a preferred IDE and environment set up so that it is easy to help each other if there are any problems.\n\n☐ Is the preferred IDE documented?\n\n☐ Are preferred 3rd party plugins that developers install listed and documented somewhere?\n\n☐ If there is a VPN, are all the VPN details documented?\n\n☐ Is the preferred Git usage documented? IE git-flow etc?\n\n## README\n\nEach repository should have a main README that acts as a starting point for people new to the project to read. This should be useful to people who have been at the company for years, all the way to someone new who has just received their laptop:\n\n☐ Does the README have all the steps to:\n\n1. Download\n2. Install\n3. Run\n4. Deploy\n5. Test\n\n☐ Architecture - Is the architecture documented? This doesn’t need to be all documented within the README, but the README should at least link out to external documentation that covers:\n\n1. Clients, servers, databases, 3rd party systems are documented\n2. Data flows between systems are documented\n\n☐  API Documentation - How is the API documented? This is similar to the architecture section.\n\n1. If your repo has components, is there a Storybook or similar site to document the interfaces?\n2. If your repo has web APIs, is there a OpenAPI spec that can be viewed?\n3. Other projects will want to document their APIs as well.\n\n☐ Design System - Similar to the API documentation, if there is a design system that is used or implemented, does your README call that out?\n\n1. Documentation - do you have a link to how to get to the documentation?\n2. Storybooks - is there already a live storybook link somewhere? Does your README document how to run the storybook as well?\n\n### Building and CI/CD\n\nIf your project is buildable or deployable, do you have documentation on the Build Pipeline and the CI/CD PIipelines? These are important to simplify and document. Someone new to the project should be able to follow the README in the repo to build the application and understand what happens when they push a commit to the repository.\n\n☐  Build Pipeline\n\n1. Can the app be built in one step?\n2. Is the pipeline modern?\n\n☐  CI/CD\n\n1. Is there a CI/CD runner?\n2. Is it documented?\n3. Are there lint guidelines?\n    1. Are they checked on the CI/CD?\n4. Are there unit tests?\n    1. Are they run on every commit?\n5. Are there pre-push and pre-commit hooks? You can use Husky to set these up\n\n### Testing\n\nAs mentioned above, running unit, integration, and e2e tests may be part of the CI/CD pipeline. Will new people who onboard be able to follow the repo’s README or some other document in order to understand how to test their changes? If there is code-coverage, how do new members of the team know where to find them?\n\n☐ Testing\n\n1. Is there a test pipeline\n2. Are there unit tests\n3. Are there automated code coverage reports?\n\n☐ Bundle Sizes\n\n1. Make sure tree shaking is happening correctly\n2. Analyze the bundle size with create-react-app or BundleSizeAnalyzer webpack plugin\n\n☐ Performance\n\n1. Analyze your web app for pagespeed, lighthouse rating, and [a11y](https://github.com/thecreazy/siteaudit)\n\n### External Services\n\nSometimes repositories are self-contained, but more often than not, a repository will pull external information from a service. This might be feature flags from providers like LaunchDarkly, or website content from a Content Management System (CMS). Do new members of the team need API keys for these services? Make sure to document any external services and how to access them.\n\n☐ CMS\n\n1. Are there a lot of text and content that is constantly updated?\n2. Is there a CMS already implemented?\n\n### Conclusion\n\nThis is not meant to be an exhaustive list of everything to think about concerning onboarding members to a project. Documentation is nice to have, but working with the team to understand what is missing and how to improve it goes a long way to keeping the team happy and productive.\n\nI highly recommend reviewing the onboarding process from time to time and making sure that it is easy to onboard. You never know when your computer will crash and you need to set up your entire environment again.\n","contentHTML":"<p>Below are some notes I’ve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.</p>\n<h2>Onboarding</h2>\n<p>When new members start, do you have processes and documentation in place to make onboarding easy?</p>\n<p>☐ Is your process written down?</p>\n<p>☐ Add a note for people onboarding continue to improve it when they walk through it. Every time a new members onboards, they should follow the documentation and update it with any missing steps or new errors and resolutions if they come across them.</p>\n<h2>Environment Setup</h2>\n<p>Part of onboarding is getting your environment set up. Usually, a team will have a preferred IDE and environment set up so that it is easy to help each other if there are any problems.</p>\n<p>☐ Is the preferred IDE documented?</p>\n<p>☐ Are preferred 3rd party plugins that developers install listed and documented somewhere?</p>\n<p>☐ If there is a VPN, are all the VPN details documented?</p>\n<p>☐ Is the preferred Git usage documented? IE git-flow etc?</p>\n<h2>README</h2>\n<p>Each repository should have a main README that acts as a starting point for people new to the project to read. This should be useful to people who have been at the company for years, all the way to someone new who has just received their laptop:</p>\n<p>☐ Does the README have all the steps to:</p>\n<ol>\n<li>Download</li>\n<li>Install</li>\n<li>Run</li>\n<li>Deploy</li>\n<li>Test</li>\n</ol>\n<p>☐ Architecture - Is the architecture documented? This doesn’t need to be all documented within the README, but the README should at least link out to external documentation that covers:</p>\n<ol>\n<li>Clients, servers, databases, 3rd party systems are documented</li>\n<li>Data flows between systems are documented</li>\n</ol>\n<p>☐  API Documentation - How is the API documented? This is similar to the architecture section.</p>\n<ol>\n<li>If your repo has components, is there a Storybook or similar site to document the interfaces?</li>\n<li>If your repo has web APIs, is there a OpenAPI spec that can be viewed?</li>\n<li>Other projects will want to document their APIs as well.</li>\n</ol>\n<p>☐ Design System - Similar to the API documentation, if there is a design system that is used or implemented, does your README call that out?</p>\n<ol>\n<li>Documentation - do you have a link to how to get to the documentation?</li>\n<li>Storybooks - is there already a live storybook link somewhere? Does your README document how to run the storybook as well?</li>\n</ol>\n<h3>Building and CI/CD</h3>\n<p>If your project is buildable or deployable, do you have documentation on the Build Pipeline and the CI/CD PIipelines? These are important to simplify and document. Someone new to the project should be able to follow the README in the repo to build the application and understand what happens when they push a commit to the repository.</p>\n<p>☐  Build Pipeline</p>\n<ol>\n<li>Can the app be built in one step?</li>\n<li>Is the pipeline modern?</li>\n</ol>\n<p>☐  CI/CD</p>\n<ol>\n<li>Is there a CI/CD runner?</li>\n<li>Is it documented?</li>\n<li>Are there lint guidelines?<!-- -->\n<ol>\n<li>Are they checked on the CI/CD?</li>\n</ol>\n</li>\n<li>Are there unit tests?<!-- -->\n<ol>\n<li>Are they run on every commit?</li>\n</ol>\n</li>\n<li>Are there pre-push and pre-commit hooks? You can use Husky to set these up</li>\n</ol>\n<h3>Testing</h3>\n<p>As mentioned above, running unit, integration, and e2e tests may be part of the CI/CD pipeline. Will new people who onboard be able to follow the repo’s README or some other document in order to understand how to test their changes? If there is code-coverage, how do new members of the team know where to find them?</p>\n<p>☐ Testing</p>\n<ol>\n<li>Is there a test pipeline</li>\n<li>Are there unit tests</li>\n<li>Are there automated code coverage reports?</li>\n</ol>\n<p>☐ Bundle Sizes</p>\n<ol>\n<li>Make sure tree shaking is happening correctly</li>\n<li>Analyze the bundle size with create-react-app or BundleSizeAnalyzer webpack plugin</li>\n</ol>\n<p>☐ Performance</p>\n<ol>\n<li>Analyze your web app for pagespeed, lighthouse rating, and <a href=\"https://github.com/thecreazy/siteaudit\">a11y</a></li>\n</ol>\n<h3>External Services</h3>\n<p>Sometimes repositories are self-contained, but more often than not, a repository will pull external information from a service. This might be feature flags from providers like LaunchDarkly, or website content from a Content Management System (CMS). Do new members of the team need API keys for these services? Make sure to document any external services and how to access them.</p>\n<p>☐ CMS</p>\n<ol>\n<li>Are there a lot of text and content that is constantly updated?</li>\n<li>Is there a CMS already implemented?</li>\n</ol>\n<h3>Conclusion</h3>\n<p>This is not meant to be an exhaustive list of everything to think about concerning onboarding members to a project. Documentation is nice to have, but working with the team to understand what is missing and how to improve it goes a long way to keeping the team happy and productive.</p>\n<p>I highly recommend reviewing the onboarding process from time to time and making sure that it is easy to onboard. You never know when your computer will crash and you need to set up your entire environment again.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    ol: \"ol\",\n    li: \"li\",\n    h3: \"h3\",\n    a: \"a\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"Below are some notes I’ve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Onboarding\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When new members start, do you have processes and documentation in place to make onboarding easy?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Is your process written down?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Add a note for people onboarding continue to improve it when they walk through it. Every time a new members onboards, they should follow the documentation and update it with any missing steps or new errors and resolutions if they come across them.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Environment Setup\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Part of onboarding is getting your environment set up. Usually, a team will have a preferred IDE and environment set up so that it is easy to help each other if there are any problems.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Is the preferred IDE documented?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Are preferred 3rd party plugins that developers install listed and documented somewhere?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ If there is a VPN, are all the VPN details documented?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Is the preferred Git usage documented? IE git-flow etc?\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"README\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Each repository should have a main README that acts as a starting point for people new to the project to read. This should be useful to people who have been at the company for years, all the way to someone new who has just received their laptop:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Does the README have all the steps to:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Download\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Install\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Run\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Deploy\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Test\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Architecture - Is the architecture documented? This doesn’t need to be all documented within the README, but the README should at least link out to external documentation that covers:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Clients, servers, databases, 3rd party systems are documented\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Data flows between systems are documented\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐  API Documentation - How is the API documented? This is similar to the architecture section.\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"If your repo has components, is there a Storybook or similar site to document the interfaces?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"If your repo has web APIs, is there a OpenAPI spec that can be viewed?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Other projects will want to document their APIs as well.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Design System - Similar to the API documentation, if there is a design system that is used or implemented, does your README call that out?\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Documentation - do you have a link to how to get to the documentation?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Storybooks - is there already a live storybook link somewhere? Does your README document how to run the storybook as well?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Building and CI/CD\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If your project is buildable or deployable, do you have documentation on the Build Pipeline and the CI/CD PIipelines? These are important to simplify and document. Someone new to the project should be able to follow the README in the repo to build the application and understand what happens when they push a commit to the repository.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐  Build Pipeline\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Can the app be built in one step?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Is the pipeline modern?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐  CI/CD\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Is there a CI/CD runner?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Is it documented?\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Are there lint guidelines?\", \"\\n\", _jsxs(_components.ol, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"Are they checked on the CI/CD?\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Are there unit tests?\", \"\\n\", _jsxs(_components.ol, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"Are they run on every commit?\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Are there pre-push and pre-commit hooks? You can use Husky to set these up\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Testing\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As mentioned above, running unit, integration, and e2e tests may be part of the CI/CD pipeline. Will new people who onboard be able to follow the repo’s README or some other document in order to understand how to test their changes? If there is code-coverage, how do new members of the team know where to find them?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Testing\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Is there a test pipeline\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Are there unit tests\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Are there automated code coverage reports?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Bundle Sizes\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Make sure tree shaking is happening correctly\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Analyze the bundle size with create-react-app or BundleSizeAnalyzer webpack plugin\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ Performance\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Analyze your web app for pagespeed, lighthouse rating, and \", _jsx(_components.a, {\n          href: \"https://github.com/thecreazy/siteaudit\",\n          children: \"a11y\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"External Services\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Sometimes repositories are self-contained, but more often than not, a repository will pull external information from a service. This might be feature flags from providers like LaunchDarkly, or website content from a Content Management System (CMS). Do new members of the team need API keys for these services? Make sure to document any external services and how to access them.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"☐ CMS\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Are there a lot of text and content that is constantly updated?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Is there a CMS already implemented?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Conclusion\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is not meant to be an exhaustive list of everything to think about concerning onboarding members to a project. Documentation is nice to have, but working with the team to understand what is missing and how to improve it goes a long way to keeping the team happy and productive.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I highly recommend reviewing the onboarding process from time to time and making sure that it is easy to onboard. You never know when your computer will crash and you need to set up your entire environment again.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nBelow are some notes I’ve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.","excerptHTML":"<p>Below are some notes I’ve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"Below are some notes I’ve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["frontend","onboarding","documentation"]},{"slug":"2023-08-12-ensuring-all-of-type","date":"2023-08-12","title":"Forbidden Typescript: ensuring all of a type","frontmatter":{"title":"Forbidden Typescript: ensuring all of a type","tags":["typescript"]},"contentRaw":"\nWhen creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\n\n```tsx\ntype Colors = 'red' | 'green' | 'blue';\n```\n\nThen, throughout our codebase, we can use the `Color` type to ensure functions can only be called with those values:\n\n```tsx\naddColor(name: Colors);\n```\n\nBut, we may want to make sure that when we create a new possible value for the type, we don’t forget to use that value to do some initialization:\n\n```tsx\nfunction initColors() {\n  addColor('red')\n  addColor('green');\n  addColor('blue');\n}\n```\n\nThere are a few ways to do this, one would be to create a record that must contain every color:\n\n```tsx\nconst allColors: Record<Colors, boolean> = {\n    red: true,\n    green: true,\n    blue: true,\n};\n\nfunction initColorsUsingRecord() {\n    (Object.keys(allColors) as Colors[]).forEach((color) => {\n        addColor(color);\n    });\n}\n```\n\nIn the above snippet, we create a record that will have every `Colors` type as a key, and Typescript will complain when we add a new literal type to the `Colors` union and forget to add it to the record.\n\nNotice though that we end up just getting the list of keys in `allColors` as an array anyway, then casting that type to help with the type-hinting for `Object.keys`.\n\nWe can also ensure that we create an array with every value of a given type:\n\n```tsx\n/**\n * Generator function to create functions that will throw typing exceptions when\n * the given array does not contain all values of the type\n */\nfunction ensureAllOf<T>() {\n    return <U extends T[]>(array: U & ([T] extends [U[number]] ? unknown : \"Invalid\")) => array;\n}\n\ntype Color = 'red' | 'green' | 'blue';\nconst ensureAllColors = ensureAllOf<Color>();\nconst colors = ensureAllColors(['red', 'green', 'blue']);\n\nfunction addColor(color: Color) {\n    // just a stub\n}\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color => {\n        addColor(color);\n    });\n}\n```\n\n[Typescript Playground](https://www.typescriptlang.org/play?#code/PQKhCgAIUhxBTAdvATgQwC4HsWQGYCuiAxhgJZaKTaTErybz5GkWIDO1AFppAO5kANoO4osfagE8ADmUQBzSPAAexeNPKVOfLkigwMuyPLIA3JJDQp0kyABMs8ToiwZalDGjmXhkU2kECJ0gsPG4mDBl4fWBwQhJNKiR2AnoAQWEAeTwAHgAVAD4ACgBKSABvKEhq+gxUqhyAVSVlDCQ7TjyAbQBdYqsbAC5IZoAySCKuvJ6WtsQOyC7GrsQCAFsAI1QemYB+SCIAaxc+KmGAIgBJRH9BMjtzkrKAXgLLazRJAG5wAF9wcCRaRMADCWEEOEgz0gAHJ6HYYZAAD6w+T0JCIlEwjaBeAwn7ELRuZKpeAZQRgiEoTjQknpLK5Sk4YolAlE9xUmlKDik8lM6mTOHwBEAGlR6MQMLF2NxMJ6rIB8VYlEsdjs-KKhKpw35ZUq1WqwGAkAAVgR2G40JALQQNn9FSxEpA5GQMPz2I12HJ5ABRHn0UoVKrVLU4dgAOjwOB9aGIXE14MhryDBtTqvViZQCapCtTvwVvyAA)\n\nIn the above example, we have a template `ensureAllOf` that takes a type and spits out a function that takes an array of that type and will throw a typing error if that array does not contain all of the possible values.\n\nIf we add “yellow” to the `Colors` type, then `ensureAllColors` will remind us that we need to add “yellow” to the list of values\n\n## Takeaway\n\nWhile `ensureAllOf` may come in handy in some cases, it is almost always easier to use an enumeration:\n\n```tsx\nenum Color {\n    red = 'red',\n    green = 'green',\n    blue = 'blue'\n}\n\nfunction addColor(color: Color) {\n    console.log('init', color);\n}\n\nconst colors = Object.values(Color);\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color => {\n        addColor(color);\n    });\n}\ninitColorsUsingEnsure();\n```\n\n[Typescript Playground](https://www.typescriptlang.org/play?#code/KYOwrgtgBAwg9gGzgJygbwFBW1ZwAmUAvFAOR76kA0WOA5nqMWQ8KNbdgEYJjDOkefUhgC+GDADMwIAMYAXAJZwQUAIb588JMgAUsxCgBcsQ8gCU6TlAMgAzomAA6JHV2lFIRfOo2z5gG4xCVs7eT8dO2YAeS4AK2AFJwA3NV5gO11tFECJaTklFShPb2zkOwBVO086AFF7MDxdS0wcCJQ7J0kUWrVZAAt9M2IAPis2to0tMyGdXLbRXPES+TLK6pA6hqbAoA)\n\nUsing an enumeration, there is no need to write a type and have to add the new value to the ensureOfAll array.\n","contentHTML":"<p>When creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">type Colors = &#x27;red&#x27; | &#x27;green&#x27; | &#x27;blue&#x27;;\n</code></pre></div>\n<p>Then, throughout our codebase, we can use the <code>Color</code> type to ensure functions can only be called with those values:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">addColor(name: Colors);\n</code></pre></div>\n<p>But, we may want to make sure that when we create a new possible value for the type, we don’t forget to use that value to do some initialization:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">function initColors() {\n  addColor(&#x27;red&#x27;)\n  addColor(&#x27;green&#x27;);\n  addColor(&#x27;blue&#x27;);\n}\n</code></pre></div>\n<p>There are a few ways to do this, one would be to create a record that must contain every color:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">const allColors: Record&lt;Colors, boolean&gt; = {\n    red: true,\n    green: true,\n    blue: true,\n};\n\nfunction initColorsUsingRecord() {\n    (Object.keys(allColors) as Colors[]).forEach((color) =&gt; {\n        addColor(color);\n    });\n}\n</code></pre></div>\n<p>In the above snippet, we create a record that will have every <code>Colors</code> type as a key, and Typescript will complain when we add a new literal type to the <code>Colors</code> union and forget to add it to the record.</p>\n<p>Notice though that we end up just getting the list of keys in <code>allColors</code> as an array anyway, then casting that type to help with the type-hinting for <code>Object.keys</code>.</p>\n<p>We can also ensure that we create an array with every value of a given type:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">/**\n * Generator function to create functions that will throw typing exceptions when\n * the given array does not contain all values of the type\n */\nfunction ensureAllOf&lt;T&gt;() {\n    return &lt;U extends T[]&gt;(array: U &amp; ([T] extends [U[number]] ? unknown : &quot;Invalid&quot;)) =&gt; array;\n}\n\ntype Color = &#x27;red&#x27; | &#x27;green&#x27; | &#x27;blue&#x27;;\nconst ensureAllColors = ensureAllOf&lt;Color&gt;();\nconst colors = ensureAllColors([&#x27;red&#x27;, &#x27;green&#x27;, &#x27;blue&#x27;]);\n\nfunction addColor(color: Color) {\n    // just a stub\n}\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color =&gt; {\n        addColor(color);\n    });\n}\n</code></pre></div>\n<p><a href=\"https://www.typescriptlang.org/play?#code/PQKhCgAIUhxBTAdvATgQwC4HsWQGYCuiAxhgJZaKTaTErybz5GkWIDO1AFppAO5kANoO4osfagE8ADmUQBzSPAAexeNPKVOfLkigwMuyPLIA3JJDQp0kyABMs8ToiwZalDGjmXhkU2kECJ0gsPG4mDBl4fWBwQhJNKiR2AnoAQWEAeTwAHgAVAD4ACgBKSABvKEhq+gxUqhyAVSVlDCQ7TjyAbQBdYqsbAC5IZoAySCKuvJ6WtsQOyC7GrsQCAFsAI1QemYB+SCIAaxc+KmGAIgBJRH9BMjtzkrKAXgLLazRJAG5wAF9wcCRaRMADCWEEOEgz0gAHJ6HYYZAAD6w+T0JCIlEwjaBeAwn7ELRuZKpeAZQRgiEoTjQknpLK5Sk4YolAlE9xUmlKDik8lM6mTOHwBEAGlR6MQMLF2NxMJ6rIB8VYlEsdjs-KKhKpw35ZUq1WqwGAkAAVgR2G40JALQQNn9FSxEpA5GQMPz2I12HJ5ABRHn0UoVKrVLU4dgAOjwOB9aGIXE14MhryDBtTqvViZQCapCtTvwVvyAA\">Typescript Playground</a></p>\n<p>In the above example, we have a template <code>ensureAllOf</code> that takes a type and spits out a function that takes an array of that type and will throw a typing error if that array does not contain all of the possible values.</p>\n<p>If we add “yellow” to the <code>Colors</code> type, then <code>ensureAllColors</code> will remind us that we need to add “yellow” to the list of values</p>\n<h2>Takeaway</h2>\n<p>While <code>ensureAllOf</code> may come in handy in some cases, it is almost always easier to use an enumeration:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">enum Color {\n    red = &#x27;red&#x27;,\n    green = &#x27;green&#x27;,\n    blue = &#x27;blue&#x27;\n}\n\nfunction addColor(color: Color) {\n    console.log(&#x27;init&#x27;, color);\n}\n\nconst colors = Object.values(Color);\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color =&gt; {\n        addColor(color);\n    });\n}\ninitColorsUsingEnsure();\n</code></pre></div>\n<p><a href=\"https://www.typescriptlang.org/play?#code/KYOwrgtgBAwg9gGzgJygbwFBW1ZwAmUAvFAOR76kA0WOA5nqMWQ8KNbdgEYJjDOkefUhgC+GDADMwIAMYAXAJZwQUAIb588JMgAUsxCgBcsQ8gCU6TlAMgAzomAA6JHV2lFIRfOo2z5gG4xCVs7eT8dO2YAeS4AK2AFJwA3NV5gO11tFECJaTklFShPb2zkOwBVO086AFF7MDxdS0wcCJQ7J0kUWrVZAAt9M2IAPis2to0tMyGdXLbRXPES+TLK6pA6hqbAoA\">Typescript Playground</a></p>\n<p>Using an enumeration, there is no need to write a type and have to add the new value to the ensureOfAll array.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    pre: \"pre\",\n    code: \"code\",\n    a: \"a\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"When creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"type Colors = 'red' | 'green' | 'blue';\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Then, throughout our codebase, we can use the \", _jsx(_components.code, {\n        children: \"Color\"\n      }), \" type to ensure functions can only be called with those values:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"addColor(name: Colors);\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But, we may want to make sure that when we create a new possible value for the type, we don’t forget to use that value to do some initialization:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function initColors() {\\n  addColor('red')\\n  addColor('green');\\n  addColor('blue');\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There are a few ways to do this, one would be to create a record that must contain every color:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"const allColors: Record<Colors, boolean> = {\\n    red: true,\\n    green: true,\\n    blue: true,\\n};\\n\\nfunction initColorsUsingRecord() {\\n    (Object.keys(allColors) as Colors[]).forEach((color) => {\\n        addColor(color);\\n    });\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the above snippet, we create a record that will have every \", _jsx(_components.code, {\n        children: \"Colors\"\n      }), \" type as a key, and Typescript will complain when we add a new literal type to the \", _jsx(_components.code, {\n        children: \"Colors\"\n      }), \" union and forget to add it to the record.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Notice though that we end up just getting the list of keys in \", _jsx(_components.code, {\n        children: \"allColors\"\n      }), \" as an array anyway, then casting that type to help with the type-hinting for \", _jsx(_components.code, {\n        children: \"Object.keys\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We can also ensure that we create an array with every value of a given type:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Generator function to create functions that will throw typing exceptions when\\n * the given array does not contain all values of the type\\n */\\nfunction ensureAllOf<T>() {\\n    return <U extends T[]>(array: U & ([T] extends [U[number]] ? unknown : \\\"Invalid\\\")) => array;\\n}\\n\\ntype Color = 'red' | 'green' | 'blue';\\nconst ensureAllColors = ensureAllOf<Color>();\\nconst colors = ensureAllColors(['red', 'green', 'blue']);\\n\\nfunction addColor(color: Color) {\\n    // just a stub\\n}\\n\\nfunction initColorsUsingEnsure() {\\n    colors.forEach(color => {\\n        addColor(color);\\n    });\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/PQKhCgAIUhxBTAdvATgQwC4HsWQGYCuiAxhgJZaKTaTErybz5GkWIDO1AFppAO5kANoO4osfagE8ADmUQBzSPAAexeNPKVOfLkigwMuyPLIA3JJDQp0kyABMs8ToiwZalDGjmXhkU2kECJ0gsPG4mDBl4fWBwQhJNKiR2AnoAQWEAeTwAHgAVAD4ACgBKSABvKEhq+gxUqhyAVSVlDCQ7TjyAbQBdYqsbAC5IZoAySCKuvJ6WtsQOyC7GrsQCAFsAI1QemYB+SCIAaxc+KmGAIgBJRH9BMjtzkrKAXgLLazRJAG5wAF9wcCRaRMADCWEEOEgz0gAHJ6HYYZAAD6w+T0JCIlEwjaBeAwn7ELRuZKpeAZQRgiEoTjQknpLK5Sk4YolAlE9xUmlKDik8lM6mTOHwBEAGlR6MQMLF2NxMJ6rIB8VYlEsdjs-KKhKpw35ZUq1WqwGAkAAVgR2G40JALQQNn9FSxEpA5GQMPz2I12HJ5ABRHn0UoVKrVLU4dgAOjwOB9aGIXE14MhryDBtTqvViZQCapCtTvwVvyAA\",\n        children: \"Typescript Playground\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the above example, we have a template \", _jsx(_components.code, {\n        children: \"ensureAllOf\"\n      }), \" that takes a type and spits out a function that takes an array of that type and will throw a typing error if that array does not contain all of the possible values.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we add “yellow” to the \", _jsx(_components.code, {\n        children: \"Colors\"\n      }), \" type, then \", _jsx(_components.code, {\n        children: \"ensureAllColors\"\n      }), \" will remind us that we need to add “yellow” to the list of values\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaway\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"While \", _jsx(_components.code, {\n        children: \"ensureAllOf\"\n      }), \" may come in handy in some cases, it is almost always easier to use an enumeration:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"enum Color {\\n    red = 'red',\\n    green = 'green',\\n    blue = 'blue'\\n}\\n\\nfunction addColor(color: Color) {\\n    console.log('init', color);\\n}\\n\\nconst colors = Object.values(Color);\\n\\nfunction initColorsUsingEnsure() {\\n    colors.forEach(color => {\\n        addColor(color);\\n    });\\n}\\ninitColorsUsingEnsure();\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/KYOwrgtgBAwg9gGzgJygbwFBW1ZwAmUAvFAOR76kA0WOA5nqMWQ8KNbdgEYJjDOkefUhgC+GDADMwIAMYAXAJZwQUAIb588JMgAUsxCgBcsQ8gCU6TlAMgAzomAA6JHV2lFIRfOo2z5gG4xCVs7eT8dO2YAeS4AK2AFJwA3NV5gO11tFECJaTklFShPb2zkOwBVO086AFF7MDxdS0wcCJQ7J0kUWrVZAAt9M2IAPis2to0tMyGdXLbRXPES+TLK6pA6hqbAoA\",\n        children: \"Typescript Playground\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Using an enumeration, there is no need to write a type and have to add the new value to the ensureOfAll array.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nWhen creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:","excerptHTML":"<p>When creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"When creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-11-smart-contract-security","date":"2023-08-11","title":"Smart Contract Security","frontmatter":{"title":"Smart Contract Security","tags":["ethereum","smart-contracts","security"]},"contentRaw":"\nThe crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it’s important to make sure the Smart Contract is secure and follows best practices.\n\nIn general, the best practices around Smart Contracts are the same for writing secure code in general.\n\n## Keep it Simple\n\nKeep your Smart Contract code simple. Smart Contracts that try to be too clever often have unintended side-effects or functionality. Keeping a Smart Contract simple also means that the surface area for attacks is smaller.\n\n## Write Small Functions\n\nWrite small functions that do one thing. Many Smart Contracts will have many small functions that can be composed together, rather than one large function that does everything. This helps keep the code readable, making it easier to understand and secure.\n\n## Linting\n\nLint your code. Smart Contracts written in Solidity have tools already written that can help catch common errors via linting. The easiest linters to set up just help improve formatting, but some can help you write more secure code by letting your know when functions have been deprecated or marked as insecure.\n\n## Unit Tests\n\nUnit test your code. The best unit tests you can write for Smart Contracts are validating what users shouldn’t be able to do. As an example, make sure unauthorized accounts cannot withdraw assets from your contract. These are sometimes called **negative** tests and they can be even more important than your typical that validate your functions do what you expect them to do. These tests check that they fail in the correct way when misused.\n\n## Scan for Security Vulnerabilities\n\nScan your code for security vulnerabilities. This is pretty self-explanatory. Many Smart Contract toolchains provide scanning tools to check your Smart Contract code.\n\nThere are a few ways to surface security issues in Ethereum Smart Contracts. One way is to use [slither](https://github.com/crytic/slither):\n\n```tsx\nnpm install slither\nslither .\n```\n\nThis may take a while to run, but it will scan the compiles contracts for security issues.\n\n## Compliance\n\nFor Ethereum Smart Contracts, you can also use [slither](https://github.com/crytic/slither) to check the compliance of your ERC20 token or ERC721 contracts. Running this check will verify that your contract implements the expected interfaces of the given contracts.\n\n## Wrapping it Up\n\nSecurity is a major consideration in any application, but Smart Contracts pose a new type of attack vector for malicious users. Smart Contracts often interact with pools of cryptocurrency, NFTs, and other blockchain assets that make them new targets for attackers. It’s important when writing Smart Contracts to always make sure the contract fails correctly, even more-so than completing actions successfully.\n","contentHTML":"<p>The crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it’s important to make sure the Smart Contract is secure and follows best practices.</p>\n<p>In general, the best practices around Smart Contracts are the same for writing secure code in general.</p>\n<h2>Keep it Simple</h2>\n<p>Keep your Smart Contract code simple. Smart Contracts that try to be too clever often have unintended side-effects or functionality. Keeping a Smart Contract simple also means that the surface area for attacks is smaller.</p>\n<h2>Write Small Functions</h2>\n<p>Write small functions that do one thing. Many Smart Contracts will have many small functions that can be composed together, rather than one large function that does everything. This helps keep the code readable, making it easier to understand and secure.</p>\n<h2>Linting</h2>\n<p>Lint your code. Smart Contracts written in Solidity have tools already written that can help catch common errors via linting. The easiest linters to set up just help improve formatting, but some can help you write more secure code by letting your know when functions have been deprecated or marked as insecure.</p>\n<h2>Unit Tests</h2>\n<p>Unit test your code. The best unit tests you can write for Smart Contracts are validating what users shouldn’t be able to do. As an example, make sure unauthorized accounts cannot withdraw assets from your contract. These are sometimes called <strong>negative</strong> tests and they can be even more important than your typical that validate your functions do what you expect them to do. These tests check that they fail in the correct way when misused.</p>\n<h2>Scan for Security Vulnerabilities</h2>\n<p>Scan your code for security vulnerabilities. This is pretty self-explanatory. Many Smart Contract toolchains provide scanning tools to check your Smart Contract code.</p>\n<p>There are a few ways to surface security issues in Ethereum Smart Contracts. One way is to use <a href=\"https://github.com/crytic/slither\">slither</a>:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">npm install slither\nslither .\n</code></pre></div>\n<p>This may take a while to run, but it will scan the compiles contracts for security issues.</p>\n<h2>Compliance</h2>\n<p>For Ethereum Smart Contracts, you can also use <a href=\"https://github.com/crytic/slither\">slither</a> to check the compliance of your ERC20 token or ERC721 contracts. Running this check will verify that your contract implements the expected interfaces of the given contracts.</p>\n<h2>Wrapping it Up</h2>\n<p>Security is a major consideration in any application, but Smart Contracts pose a new type of attack vector for malicious users. Smart Contracts often interact with pools of cryptocurrency, NFTs, and other blockchain assets that make them new targets for attackers. It’s important when writing Smart Contracts to always make sure the contract fails correctly, even more-so than completing actions successfully.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    strong: \"strong\",\n    a: \"a\",\n    pre: \"pre\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"The crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it’s important to make sure the Smart Contract is secure and follows best practices.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In general, the best practices around Smart Contracts are the same for writing secure code in general.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Keep it Simple\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Keep your Smart Contract code simple. Smart Contracts that try to be too clever often have unintended side-effects or functionality. Keeping a Smart Contract simple also means that the surface area for attacks is smaller.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Write Small Functions\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Write small functions that do one thing. Many Smart Contracts will have many small functions that can be composed together, rather than one large function that does everything. This helps keep the code readable, making it easier to understand and secure.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Linting\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Lint your code. Smart Contracts written in Solidity have tools already written that can help catch common errors via linting. The easiest linters to set up just help improve formatting, but some can help you write more secure code by letting your know when functions have been deprecated or marked as insecure.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Unit Tests\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Unit test your code. The best unit tests you can write for Smart Contracts are validating what users shouldn’t be able to do. As an example, make sure unauthorized accounts cannot withdraw assets from your contract. These are sometimes called \", _jsx(_components.strong, {\n        children: \"negative\"\n      }), \" tests and they can be even more important than your typical that validate your functions do what you expect them to do. These tests check that they fail in the correct way when misused.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Scan for Security Vulnerabilities\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Scan your code for security vulnerabilities. This is pretty self-explanatory. Many Smart Contract toolchains provide scanning tools to check your Smart Contract code.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"There are a few ways to surface security issues in Ethereum Smart Contracts. One way is to use \", _jsx(_components.a, {\n        href: \"https://github.com/crytic/slither\",\n        children: \"slither\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"npm install slither\\nslither .\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This may take a while to run, but it will scan the compiles contracts for security issues.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Compliance\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For Ethereum Smart Contracts, you can also use \", _jsx(_components.a, {\n        href: \"https://github.com/crytic/slither\",\n        children: \"slither\"\n      }), \" to check the compliance of your ERC20 token or ERC721 contracts. Running this check will verify that your contract implements the expected interfaces of the given contracts.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Wrapping it Up\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Security is a major consideration in any application, but Smart Contracts pose a new type of attack vector for malicious users. Smart Contracts often interact with pools of cryptocurrency, NFTs, and other blockchain assets that make them new targets for attackers. It’s important when writing Smart Contracts to always make sure the contract fails correctly, even more-so than completing actions successfully.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nThe crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it’s important to make sure the Smart Contract is secure and follows best practices.","excerptHTML":"<p>The crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it’s important to make sure the Smart Contract is secure and follows best practices.</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"The crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it’s important to make sure the Smart Contract is secure and follows best practices.\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["ethereum","smart-contracts","security"]},{"slug":"2023-08-10-get-class","date":"2023-08-10","title":"Forbidden Typescript: Get Class Name","frontmatter":{"title":"Forbidden Typescript: Get Class Name","tags":["typescript"]},"contentRaw":"\nWe don’t get a lot of information using `typeof` in JavaScript or TypeScript. At most, it tells us whether a value is `undefined`, `number`, `string`, or `object`. If you want to get the class name using a function, you can use the following extended version of `classOf` that is originally from “JavaScript: The Definitive Guide”:\n\n```tsx\nfunction classOf(obj: unknown) {\n    if (obj === null) return \"Null\";\n    if (typeof obj === \"undefined\") return \"Undefined\";\n\n    if (typeof obj === 'object') {\n        // Warning: this won't work if your Typescript is minified and class names are mangled.\n        return (obj as object).constructor.name;\n    }\n\n    if (typeof obj === 'function') {\n        // Warning: this won't work if your Typescript is minified and function names are mangled.\n        const possibleName = (obj as CallableFunction).name;\n        if (possibleName) {\n            return possibleName;\n        }\n    }\n\n    return Object.prototype.toString.call(obj).slice(8, -1);\n}\n\nconsole.log(classOf(null)); // \"Null\"\nconsole.log(classOf(undefined)); // \"Undefined\"\nconsole.log(classOf(1)); // \"Number\"\nconsole.log(classOf(\"foobar\")); // \"String\"\nconsole.log(classOf({})); // \"Object\"\nconsole.log(classOf([])); // \"Array\"\nconsole.log(classOf(new Date()))\n\nclass Test {}\nconsole.log(classOf(new Test())); // \"Test\"\n\nfunction test() {}\nconsole.log(classOf(test)); // \"test\"\n\nconsole.log(classOf(function () {})) // \"Function\"\n```\n\n[Playground Link](https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABBANgQwM4YPLABRwBGAVgFyLgDWYcA7mAJSIDeAUIh4jMIgSYgF4hiMCBQomAJwCmUEJKQAiAHJiUigNztO3XlACeAB2lweRYoOGLwAE2nAYYaTcVTZ8pQFUwdh05da2hy6eAbGpojmlgKIAOTm0tCxTGycaYgA9BmIAOpoCo4A5uRQABYwGIi0CLFQVXCSlFw8+nDyiAAqRtIYEJIwhnUViAC2jtwwzohoPsjoWCJoIz3TMqMzhSjOAHRB6TJyCrxRmJEkiVAM2xAIGFCSINAN22BL0lppAL6seyFhJmZ+EIYrFQJBYDUUns0llcvkwEUSuVKtUwLV6o1mohWu0usZev1BlxKmMEQ4pjMbIgwdB4EhXstKvlpOswJsdtDODcwHdEIY4FgYIQtso3oJjvxTgBhNDiNDC6QAMXAtIQVwZ705wR4eH5goVouWUPSJsQBw8fIFGCFIreH1N3y+PzS5qO2HO0G2hkkcCgvu62z9AGV7kVrrKUHxiFcMCgYBBpHgABwAGkQAFoAIwMLTfVjcjBwLbbFBwQp4VCYHD4UTiBg5zLZFRqRT525F6QlssV+bVvC2eyOZz1jSNxCKby+IcuNs8jtd8uVrC4PDZhuw5sjQjSSStgvz0uL3srxTAOBEfKuddNkP9Nl79vFw89qsr5ifEdjxTu4gXB9zp9uyXPsAG0AF1Pw3ABBSRJDQfR-0LQCj1fGtpFoRAABE0CgRN6wYH5gM6Ho6nfWckM7Z9gJXJwMI6Ei8Hw0cN3ou5W1YGkISQXC7kYlhvn3ZCX2XfAeMua9xzE9jBMooDj3wTi6V4FIPyYDdlXBOlFCAA)\n\nThis `classOf` function works for any value, including numbers, strings, booleans, classes, and functions. It will return the best name for that given value that is passed. If the object has a constructor name, that value will be returned. If that value is a function, the name of that function will be returned.\n\n## Takeaways\n\nUnfortunately, during some transpilation steps or code compression, these names get mangled or removed completely, so it’s best not to rely on the class’s actual name directly. Instead `instanceof` should be used, or a static name attribute that cannot be modified.\n","contentHTML":"<p>We don’t get a lot of information using <code>typeof</code> in JavaScript or TypeScript. At most, it tells us whether a value is <code>undefined</code>, <code>number</code>, <code>string</code>, or <code>object</code>. If you want to get the class name using a function, you can use the following extended version of <code>classOf</code> that is originally from “JavaScript: The Definitive Guide”:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">function classOf(obj: unknown) {\n    if (obj === null) return &quot;Null&quot;;\n    if (typeof obj === &quot;undefined&quot;) return &quot;Undefined&quot;;\n\n    if (typeof obj === &#x27;object&#x27;) {\n        // Warning: this won&#x27;t work if your Typescript is minified and class names are mangled.\n        return (obj as object).constructor.name;\n    }\n\n    if (typeof obj === &#x27;function&#x27;) {\n        // Warning: this won&#x27;t work if your Typescript is minified and function names are mangled.\n        const possibleName = (obj as CallableFunction).name;\n        if (possibleName) {\n            return possibleName;\n        }\n    }\n\n    return Object.prototype.toString.call(obj).slice(8, -1);\n}\n\nconsole.log(classOf(null)); // &quot;Null&quot;\nconsole.log(classOf(undefined)); // &quot;Undefined&quot;\nconsole.log(classOf(1)); // &quot;Number&quot;\nconsole.log(classOf(&quot;foobar&quot;)); // &quot;String&quot;\nconsole.log(classOf({})); // &quot;Object&quot;\nconsole.log(classOf([])); // &quot;Array&quot;\nconsole.log(classOf(new Date()))\n\nclass Test {}\nconsole.log(classOf(new Test())); // &quot;Test&quot;\n\nfunction test() {}\nconsole.log(classOf(test)); // &quot;test&quot;\n\nconsole.log(classOf(function () {})) // &quot;Function&quot;\n</code></pre></div>\n<p><a href=\"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABBANgQwM4YPLABRwBGAVgFyLgDWYcA7mAJSIDeAUIh4jMIgSYgF4hiMCBQomAJwCmUEJKQAiAHJiUigNztO3XlACeAB2lweRYoOGLwAE2nAYYaTcVTZ8pQFUwdh05da2hy6eAbGpojmlgKIAOTm0tCxTGycaYgA9BmIAOpoCo4A5uRQABYwGIi0CLFQVXCSlFw8+nDyiAAqRtIYEJIwhnUViAC2jtwwzohoPsjoWCJoIz3TMqMzhSjOAHRB6TJyCrxRmJEkiVAM2xAIGFCSINAN22BL0lppAL6seyFhJmZ+EIYrFQJBYDUUns0llcvkwEUSuVKtUwLV6o1mohWu0usZev1BlxKmMEQ4pjMbIgwdB4EhXstKvlpOswJsdtDODcwHdEIY4FgYIQtso3oJjvxTgBhNDiNDC6QAMXAtIQVwZ705wR4eH5goVouWUPSJsQBw8fIFGCFIreH1N3y+PzS5qO2HO0G2hkkcCgvu62z9AGV7kVrrKUHxiFcMCgYBBpHgABwAGkQAFoAIwMLTfVjcjBwLbbFBwQp4VCYHD4UTiBg5zLZFRqRT525F6QlssV+bVvC2eyOZz1jSNxCKby+IcuNs8jtd8uVrC4PDZhuw5sjQjSSStgvz0uL3srxTAOBEfKuddNkP9Nl79vFw89qsr5ifEdjxTu4gXB9zp9uyXPsAG0AF1Pw3ABBSRJDQfR-0LQCj1fGtpFoRAABE0CgRN6wYH5gM6Ho6nfWckM7Z9gJXJwMI6Ei8Hw0cN3ou5W1YGkISQXC7kYlhvn3ZCX2XfAeMua9xzE9jBMooDj3wTi6V4FIPyYDdlXBOlFCAA\">Playground Link</a></p>\n<p>This <code>classOf</code> function works for any value, including numbers, strings, booleans, classes, and functions. It will return the best name for that given value that is passed. If the object has a constructor name, that value will be returned. If that value is a function, the name of that function will be returned.</p>\n<h2>Takeaways</h2>\n<p>Unfortunately, during some transpilation steps or code compression, these names get mangled or removed completely, so it’s best not to rely on the class’s actual name directly. Instead <code>instanceof</code> should be used, or a static name attribute that cannot be modified.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    pre: \"pre\",\n    a: \"a\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"We don’t get a lot of information using \", _jsx(_components.code, {\n        children: \"typeof\"\n      }), \" in JavaScript or TypeScript. At most, it tells us whether a value is \", _jsx(_components.code, {\n        children: \"undefined\"\n      }), \", \", _jsx(_components.code, {\n        children: \"number\"\n      }), \", \", _jsx(_components.code, {\n        children: \"string\"\n      }), \", or \", _jsx(_components.code, {\n        children: \"object\"\n      }), \". If you want to get the class name using a function, you can use the following extended version of \", _jsx(_components.code, {\n        children: \"classOf\"\n      }), \" that is originally from “JavaScript: The Definitive Guide”:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function classOf(obj: unknown) {\\n    if (obj === null) return \\\"Null\\\";\\n    if (typeof obj === \\\"undefined\\\") return \\\"Undefined\\\";\\n\\n    if (typeof obj === 'object') {\\n        // Warning: this won't work if your Typescript is minified and class names are mangled.\\n        return (obj as object).constructor.name;\\n    }\\n\\n    if (typeof obj === 'function') {\\n        // Warning: this won't work if your Typescript is minified and function names are mangled.\\n        const possibleName = (obj as CallableFunction).name;\\n        if (possibleName) {\\n            return possibleName;\\n        }\\n    }\\n\\n    return Object.prototype.toString.call(obj).slice(8, -1);\\n}\\n\\nconsole.log(classOf(null)); // \\\"Null\\\"\\nconsole.log(classOf(undefined)); // \\\"Undefined\\\"\\nconsole.log(classOf(1)); // \\\"Number\\\"\\nconsole.log(classOf(\\\"foobar\\\")); // \\\"String\\\"\\nconsole.log(classOf({})); // \\\"Object\\\"\\nconsole.log(classOf([])); // \\\"Array\\\"\\nconsole.log(classOf(new Date()))\\n\\nclass Test {}\\nconsole.log(classOf(new Test())); // \\\"Test\\\"\\n\\nfunction test() {}\\nconsole.log(classOf(test)); // \\\"test\\\"\\n\\nconsole.log(classOf(function () {})) // \\\"Function\\\"\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABBANgQwM4YPLABRwBGAVgFyLgDWYcA7mAJSIDeAUIh4jMIgSYgF4hiMCBQomAJwCmUEJKQAiAHJiUigNztO3XlACeAB2lweRYoOGLwAE2nAYYaTcVTZ8pQFUwdh05da2hy6eAbGpojmlgKIAOTm0tCxTGycaYgA9BmIAOpoCo4A5uRQABYwGIi0CLFQVXCSlFw8+nDyiAAqRtIYEJIwhnUViAC2jtwwzohoPsjoWCJoIz3TMqMzhSjOAHRB6TJyCrxRmJEkiVAM2xAIGFCSINAN22BL0lppAL6seyFhJmZ+EIYrFQJBYDUUns0llcvkwEUSuVKtUwLV6o1mohWu0usZev1BlxKmMEQ4pjMbIgwdB4EhXstKvlpOswJsdtDODcwHdEIY4FgYIQtso3oJjvxTgBhNDiNDC6QAMXAtIQVwZ705wR4eH5goVouWUPSJsQBw8fIFGCFIreH1N3y+PzS5qO2HO0G2hkkcCgvu62z9AGV7kVrrKUHxiFcMCgYBBpHgABwAGkQAFoAIwMLTfVjcjBwLbbFBwQp4VCYHD4UTiBg5zLZFRqRT525F6QlssV+bVvC2eyOZz1jSNxCKby+IcuNs8jtd8uVrC4PDZhuw5sjQjSSStgvz0uL3srxTAOBEfKuddNkP9Nl79vFw89qsr5ifEdjxTu4gXB9zp9uyXPsAG0AF1Pw3ABBSRJDQfR-0LQCj1fGtpFoRAABE0CgRN6wYH5gM6Ho6nfWckM7Z9gJXJwMI6Ei8Hw0cN3ou5W1YGkISQXC7kYlhvn3ZCX2XfAeMua9xzE9jBMooDj3wTi6V4FIPyYDdlXBOlFCAA\",\n        children: \"Playground Link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This \", _jsx(_components.code, {\n        children: \"classOf\"\n      }), \" function works for any value, including numbers, strings, booleans, classes, and functions. It will return the best name for that given value that is passed. If the object has a constructor name, that value will be returned. If that value is a function, the name of that function will be returned.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaways\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Unfortunately, during some transpilation steps or code compression, these names get mangled or removed completely, so it’s best not to rely on the class’s actual name directly. Instead \", _jsx(_components.code, {\n        children: \"instanceof\"\n      }), \" should be used, or a static name attribute that cannot be modified.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nWe don’t get a lot of information using `typeof` in JavaScript or TypeScript. At most, it tells us whether a value is `undefined`, `number`, `string`, or `object`. If you want to get the class name using a function, you can use the following extended version of `classOf` that is originally from “JavaScript: The Definitive Guide”:","excerptHTML":"<p>We don’t get a lot of information using <code>typeof</code> in JavaScript or TypeScript. At most, it tells us whether a value is <code>undefined</code>, <code>number</code>, <code>string</code>, or <code>object</code>. If you want to get the class name using a function, you can use the following extended version of <code>classOf</code> that is originally from “JavaScript: The Definitive Guide”:</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"We don’t get a lot of information using \", _jsx(_components.code, {\n      children: \"typeof\"\n    }), \" in JavaScript or TypeScript. At most, it tells us whether a value is \", _jsx(_components.code, {\n      children: \"undefined\"\n    }), \", \", _jsx(_components.code, {\n      children: \"number\"\n    }), \", \", _jsx(_components.code, {\n      children: \"string\"\n    }), \", or \", _jsx(_components.code, {\n      children: \"object\"\n    }), \". If you want to get the class name using a function, you can use the following extended version of \", _jsx(_components.code, {\n      children: \"classOf\"\n    }), \" that is originally from “JavaScript: The Definitive Guide”:\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-09-enumerating-properties","date":"2023-08-09","title":"Forbidden Typescript: Enumerating Properties","frontmatter":{"title":"Forbidden Typescript: Enumerating Properties","tags":["typescript"]},"contentRaw":"\nIn [“JavaScript: The Definitive Guide”](https://amzn.to/3rV5Xov), there are functions described in **6.5 Enumerating Properties** that probably shouldn’t be used in production code because they modify their input parameters: `extend`, `merge`, `restrict`, and `subtract`.\n\nLet’s re-create each one using more modern practices in Typescript that don’t modify the input parameters:\n\n```tsx\n/**\n * Create a new object that returns the properties of target, overwritten with the properties in props\n */\nfunction extend<T extends object, P extends object>(target: T, props: P): T & P {\n    return {...target, ...props};\n}\n```\n\nEven in a more modern implementation, I would never recommend this. It is almost always easier to write `{...a, ...b}` inline and have its meaning be more clear.\n\nNext we have merge, not to be confused with extend:\n\n```tsx\n/**\n * Create a new object that returns all the properties of target and props, but the properties\n * in target are left alone.\n */\nfunction merge<T extends object, P extends object>(target: T, props: P): T & P {\n    return {...props, ...target};\n}\n```\n\nSame thing here, even with a more type-safe implementation, it’s almost always more clear to have an inline spread of `{...b, ...a}`.\n\nA more interesting function implementation is `restrict`:\n\n```tsx\n/**\n * Create a new object that returns all the values in target that also exist in props.\n */\nfunction restrict<P extends object, T extends P>(target: T, props: P): Pick<T, keyof P> {\n    const t: Partial<T> = { ...target };\n\n    for (let key in target) {\n        if (!(key in props)) {\n            delete t[key];\n        }\n    }\n\n    return t as Pick<T, keyof P>;\n}\n\nconst obj1 = { a: 123, b: 222 };\nconst obj2 = { b: 0 };\n\nconsole.log(restrict(obj1, obj2)); // { b: 222 }\n```\n\nHere we end up cloning our target object in order to delete keys from it later. An alternative approach might be to only construct the object with keys in props in the first place. This implementation is at least type-safe and will give you the correct typings for the object returned from `restrict`.\n\nLastly, here is our type-safe version of `subtract`:\n\n```tsx\n/**\n * Create a new object that returns all the values in target that do not exist in props.\n */\nfunction subtract<T extends object, P extends object>(target: T, props: P): Omit<T, keyof P> {\n    const t: Partial<T> = { ...target };\n\n    for (let key in props) {\n        if (key in t) {\n            delete t[key as unknown as keyof T];\n        }\n    }\n\n    return t as Omit<T, keyof P>;\n}\n\nconsole.log(subtract(obj1, obj2)); // { a: 123 }\n```\n\nBoth the `restrict` and `subtract` make use of type assertions to tell the compiler we know the actual types of the objects and keys when we are removing keys. Without these assertions, `t` is still a `Partial<T>`, even after we delete the keys from the object.\n\n## Takeaway\n\nIt’s almost always more clear and more type-safe to merge objects using inline spread notation than trying to use a clever utility. There are cases though, like `restrict` and `subtract` where we can leverage the type system to write safer code. There is always a balance to find when trying to write utilities between making something easier for engineers, and adding additional compile time safety.\n","contentHTML":"<p>In <a href=\"https://amzn.to/3rV5Xov\">“JavaScript: The Definitive Guide”</a>, there are functions described in <strong>6.5 Enumerating Properties</strong> that probably shouldn’t be used in production code because they modify their input parameters: <code>extend</code>, <code>merge</code>, <code>restrict</code>, and <code>subtract</code>.</p>\n<p>Let’s re-create each one using more modern practices in Typescript that don’t modify the input parameters:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">/**\n * Create a new object that returns the properties of target, overwritten with the properties in props\n */\nfunction extend&lt;T extends object, P extends object&gt;(target: T, props: P): T &amp; P {\n    return {...target, ...props};\n}\n</code></pre></div>\n<p>Even in a more modern implementation, I would never recommend this. It is almost always easier to write <code>{...a, ...b}</code> inline and have its meaning be more clear.</p>\n<p>Next we have merge, not to be confused with extend:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">/**\n * Create a new object that returns all the properties of target and props, but the properties\n * in target are left alone.\n */\nfunction merge&lt;T extends object, P extends object&gt;(target: T, props: P): T &amp; P {\n    return {...props, ...target};\n}\n</code></pre></div>\n<p>Same thing here, even with a more type-safe implementation, it’s almost always more clear to have an inline spread of <code>{...b, ...a}</code>.</p>\n<p>A more interesting function implementation is <code>restrict</code>:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">/**\n * Create a new object that returns all the values in target that also exist in props.\n */\nfunction restrict&lt;P extends object, T extends P&gt;(target: T, props: P): Pick&lt;T, keyof P&gt; {\n    const t: Partial&lt;T&gt; = { ...target };\n\n    for (let key in target) {\n        if (!(key in props)) {\n            delete t[key];\n        }\n    }\n\n    return t as Pick&lt;T, keyof P&gt;;\n}\n\nconst obj1 = { a: 123, b: 222 };\nconst obj2 = { b: 0 };\n\nconsole.log(restrict(obj1, obj2)); // { b: 222 }\n</code></pre></div>\n<p>Here we end up cloning our target object in order to delete keys from it later. An alternative approach might be to only construct the object with keys in props in the first place. This implementation is at least type-safe and will give you the correct typings for the object returned from <code>restrict</code>.</p>\n<p>Lastly, here is our type-safe version of <code>subtract</code>:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">/**\n * Create a new object that returns all the values in target that do not exist in props.\n */\nfunction subtract&lt;T extends object, P extends object&gt;(target: T, props: P): Omit&lt;T, keyof P&gt; {\n    const t: Partial&lt;T&gt; = { ...target };\n\n    for (let key in props) {\n        if (key in t) {\n            delete t[key as unknown as keyof T];\n        }\n    }\n\n    return t as Omit&lt;T, keyof P&gt;;\n}\n\nconsole.log(subtract(obj1, obj2)); // { a: 123 }\n</code></pre></div>\n<p>Both the <code>restrict</code> and <code>subtract</code> make use of type assertions to tell the compiler we know the actual types of the objects and keys when we are removing keys. Without these assertions, <code>t</code> is still a <code>Partial&lt;T&gt;</code>, even after we delete the keys from the object.</p>\n<h2>Takeaway</h2>\n<p>It’s almost always more clear and more type-safe to merge objects using inline spread notation than trying to use a clever utility. There are cases though, like <code>restrict</code> and <code>subtract</code> where we can leverage the type system to write safer code. There is always a balance to find when trying to write utilities between making something easier for engineers, and adding additional compile time safety.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    strong: \"strong\",\n    code: \"code\",\n    pre: \"pre\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"In \", _jsx(_components.a, {\n        href: \"https://amzn.to/3rV5Xov\",\n        children: \"“JavaScript: The Definitive Guide”\"\n      }), \", there are functions described in \", _jsx(_components.strong, {\n        children: \"6.5 Enumerating Properties\"\n      }), \" that probably shouldn’t be used in production code because they modify their input parameters: \", _jsx(_components.code, {\n        children: \"extend\"\n      }), \", \", _jsx(_components.code, {\n        children: \"merge\"\n      }), \", \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \", and \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let’s re-create each one using more modern practices in Typescript that don’t modify the input parameters:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns the properties of target, overwritten with the properties in props\\n */\\nfunction extend<T extends object, P extends object>(target: T, props: P): T & P {\\n    return {...target, ...props};\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Even in a more modern implementation, I would never recommend this. It is almost always easier to write \", _jsx(_components.code, {\n        children: \"{...a, ...b}\"\n      }), \" inline and have its meaning be more clear.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Next we have merge, not to be confused with extend:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns all the properties of target and props, but the properties\\n * in target are left alone.\\n */\\nfunction merge<T extends object, P extends object>(target: T, props: P): T & P {\\n    return {...props, ...target};\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Same thing here, even with a more type-safe implementation, it’s almost always more clear to have an inline spread of \", _jsx(_components.code, {\n        children: \"{...b, ...a}\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"A more interesting function implementation is \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns all the values in target that also exist in props.\\n */\\nfunction restrict<P extends object, T extends P>(target: T, props: P): Pick<T, keyof P> {\\n    const t: Partial<T> = { ...target };\\n\\n    for (let key in target) {\\n        if (!(key in props)) {\\n            delete t[key];\\n        }\\n    }\\n\\n    return t as Pick<T, keyof P>;\\n}\\n\\nconst obj1 = { a: 123, b: 222 };\\nconst obj2 = { b: 0 };\\n\\nconsole.log(restrict(obj1, obj2)); // { b: 222 }\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here we end up cloning our target object in order to delete keys from it later. An alternative approach might be to only construct the object with keys in props in the first place. This implementation is at least type-safe and will give you the correct typings for the object returned from \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Lastly, here is our type-safe version of \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns all the values in target that do not exist in props.\\n */\\nfunction subtract<T extends object, P extends object>(target: T, props: P): Omit<T, keyof P> {\\n    const t: Partial<T> = { ...target };\\n\\n    for (let key in props) {\\n        if (key in t) {\\n            delete t[key as unknown as keyof T];\\n        }\\n    }\\n\\n    return t as Omit<T, keyof P>;\\n}\\n\\nconsole.log(subtract(obj1, obj2)); // { a: 123 }\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Both the \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \" make use of type assertions to tell the compiler we know the actual types of the objects and keys when we are removing keys. Without these assertions, \", _jsx(_components.code, {\n        children: \"t\"\n      }), \" is still a \", _jsx(_components.code, {\n        children: \"Partial<T>\"\n      }), \", even after we delete the keys from the object.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaway\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"It’s almost always more clear and more type-safe to merge objects using inline spread notation than trying to use a clever utility. There are cases though, like \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \" where we can leverage the type system to write safer code. There is always a balance to find when trying to write utilities between making something easier for engineers, and adding additional compile time safety.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nIn [“JavaScript: The Definitive Guide”](https://amzn.to/3rV5Xov), there are functions described in **6.5 Enumerating Properties** that probably shouldn’t be used in production code because they modify their input parameters: `extend`, `merge`, `restrict`, and `subtract`.","excerptHTML":"<p>In <a href=\"https://amzn.to/3rV5Xov\">“JavaScript: The Definitive Guide”</a>, there are functions described in <strong>6.5 Enumerating Properties</strong> that probably shouldn’t be used in production code because they modify their input parameters: <code>extend</code>, <code>merge</code>, <code>restrict</code>, and <code>subtract</code>.</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    strong: \"strong\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"In \", _jsx(_components.a, {\n      href: \"https://amzn.to/3rV5Xov\",\n      children: \"“JavaScript: The Definitive Guide”\"\n    }), \", there are functions described in \", _jsx(_components.strong, {\n      children: \"6.5 Enumerating Properties\"\n    }), \" that probably shouldn’t be used in production code because they modify their input parameters: \", _jsx(_components.code, {\n      children: \"extend\"\n    }), \", \", _jsx(_components.code, {\n      children: \"merge\"\n    }), \", \", _jsx(_components.code, {\n      children: \"restrict\"\n    }), \", and \", _jsx(_components.code, {\n      children: \"subtract\"\n    }), \".\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-07-object-create","date":"2023-08-07","title":"Forbidden Typescript: Using Object.create to clone","frontmatter":{"title":"Forbidden Typescript: Using Object.create to clone","tags":["typescript"]},"contentRaw":"\nIn “Javascript: The Definitive Guide” there is an example that uses `Object.inherit` to inherit the prototype change. JavaScript defines a method `Object.create` that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\n\n```tsx\nfunction inherit<T extends object>(obj: T): T {\n    return Object.create(obj);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\nconst myObject = new MyObject(123);\nconst myClone = inherit(myObject);\n```\n\n[Playground Link](https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABDMALApgJxlAPAFUXQA8p0wATAZ0TgCMArdaAPgAp6GAuRfASh6EA3gChE4xJnRQQmJAHlGzKADoIUgIZkOjPgG4RAXxEiIAGw1UaAWQCeiptESiJiAA4g6ZmBEQaeYCAAtnRYBmISEAhUUJgg0HCYbP6IgSFYfM4RruJQqDBUKhqIALx+Bq7GxlFgMYhB9kpOZWDoAO6Idg7KbACMAEwAzPqm0VD1tgDCZgjopchoWDhsDd3QI6O1cGboKjMA5iuNjlD6iAD0585+PAODiNXR27sHR9OzZ5fOj1s7e3CHBrvVoLGIaSDoODATrHZSfK6xEDoERAA)\n\nHowever, we lied. Notice that in the above code, the `myClone` object was created without `a` being initialized.\n\n```tsx\nconsole.log(myObject); // { a: 123 }\nconsole.log(myClone); // {}\nconsole.log(myClone instanceof MyObject); // true\n```\n\nThis creates what is known as a *type-hole*: the Typescript compiler will not report any bugs when we try to use `myClone.a`.  That’s because we used `Object.create` which returns the `any` type. In the above example, if we tried to use `myClone.a` in a case where we expected a `number`, but got `undefined`, we can end up with runtime bugs that should have been caught by the compiler.\n\nWe can make the typings a little more clear by doing the following:\n\n```tsx\nfunction inherit<T extends object>(obj: T): Partial<T> {\n    return Object.create(obj);\n}\n```\n\nNow Typescript will report that the value of `myClone.a` might be undefined.\n\nLet’s improve this a bit more and create an object that inherits and freezes the data in the given object:\n\n```tsx\nfunction inheritAndFreeze<T extends object>(obj: T, values: Partial<T>): Readonly<Partial<T>> {\n    const properties: PropertyDescriptorMap = {};\n\n    Object.keys(obj).forEach((unsafeKey) => {\n        const key = unsafeKey as keyof T;\n        properties[key] = {\n            value: values[key] ?? undefined,\n            writable: false,\n            configurable: false,\n        };\n    })\n\n    return Object.create(obj, properties);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\n\nconst myObject = new MyObject(123);\nconst myClone = inheritAndFreeze(myObject, { a: 123 });\n\nconsole.log(myClone); // { a: 123 }\nmyClone.a = 999; // Would throw \"Cannot assign to read only property 'a' of object '#<MyObject>' \"\n```\n\n[Playground Link](https://www.typescriptlang.org/play?ssl=29&ssc=102&pln=1&pc=1#code/GYVwdgxgLglg9mABDMALApgJxlAgmAEwDFN10AvdAHgBVF0APKdQgZ0TgCMArdaAPgAUXbgC5ENADSIAbgEMANiHStxABTmZYi2vwCU4gEro5BBAoCeVDVpg6a-fogDeAKEQfEEBKyiIADphw-liwKupBIVoWACIqENj+UHCYALJy-ogAvC4AvgDcru6eAPI8fFAAdADW6Baswjx6lcApAKJyEKiCguCscsDoANJ1etlObp5TXj5+tRbZiH0Dw3WIcuzzcMAShdOegcGhMCoA2vMAuouT+9PySuji98qs53VXAPwfS4TowCjoAiSYq3TwAd2wUDknAUj0QwEUrHQwIAkGj0d4wP8AOYgTDQ2HiBEKJHA0EFEGIXJ6IpTUhQPFIMq8aCVBImZiNbjSQ5RMKsPSFXJFCAKDbsVIWZkVFyU-wgGEwCDrcRgEAAW04WEKlMxvkwIGgKUEclVGq1mDGN32UFQMFYlTkizke08wuFrj1fnVUvK0EWYHQYMQkul0EEAEYAEwAZkFntmiB9AGEFAh0IsUBhIfhiKQKOhBD6w1BpM4VYhozGqfGE2BWHBYZU09iixZU+nBYgAPTdkO+ll+ZzCvWN9DNuCtlNpwOOru9yux1wL6fpx2LACcW-yPb7AHU4CAFARELagsGAETJuRgMBwPzimDYpDJRCkUwcMCWAKRUILADkcj-hwOwiDK-4AMRUKGfpQPwwEXkAA)\n\nIf we didn’t mark the return value as `Readonly<Partial<T>>`, and instead just had `Partial<T>` we would once again have a type-hole and `myClone.a = 999;` would be allowed by Typescript, but would throw an exception at runtime because property a is read only as a runtime constraint.\n\n## The Takeaway\n\nLet’s step back and really look at what `inherit` was doing. All it gave us was a template object, and if you read on [MDN about Inheritance and prototype chaining](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain):\n\n> You may also see some legacy code using `[Object.create()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)` to build the inheritance chain. However, because this reassigns the `prototype` property and removes the `[constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor)` property, it can be more error-prone, while performance gains may not be apparent if the constructors haven't created any instances yet.\n\nThe key here is to be wary of using utility functions built into the language that return the `any` type. Be careful what the Typescript constraints are and make sure you don’t have any type-holes when you are using these generic functions.\n","contentHTML":"<p>In “Javascript: The Definitive Guide” there is an example that uses <code>Object.inherit</code> to inherit the prototype change. JavaScript defines a method <code>Object.create</code> that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">function inherit&lt;T extends object&gt;(obj: T): T {\n    return Object.create(obj);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\nconst myObject = new MyObject(123);\nconst myClone = inherit(myObject);\n</code></pre></div>\n<p><a href=\"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABDMALApgJxlAPAFUXQA8p0wATAZ0TgCMArdaAPgAp6GAuRfASh6EA3gChE4xJnRQQmJAHlGzKADoIUgIZkOjPgG4RAXxEiIAGw1UaAWQCeiptESiJiAA4g6ZmBEQaeYCAAtnRYBmISEAhUUJgg0HCYbP6IgSFYfM4RruJQqDBUKhqIALx+Bq7GxlFgMYhB9kpOZWDoAO6Idg7KbACMAEwAzPqm0VD1tgDCZgjopchoWDhsDd3QI6O1cGboKjMA5iuNjlD6iAD0585+PAODiNXR27sHR9OzZ5fOj1s7e3CHBrvVoLGIaSDoODATrHZSfK6xEDoERAA\">Playground Link</a></p>\n<p>However, we lied. Notice that in the above code, the <code>myClone</code> object was created without <code>a</code> being initialized.</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">console.log(myObject); // { a: 123 }\nconsole.log(myClone); // {}\nconsole.log(myClone instanceof MyObject); // true\n</code></pre></div>\n<p>This creates what is known as a <em>type-hole</em>: the Typescript compiler will not report any bugs when we try to use <code>myClone.a</code>.  That’s because we used <code>Object.create</code> which returns the <code>any</code> type. In the above example, if we tried to use <code>myClone.a</code> in a case where we expected a <code>number</code>, but got <code>undefined</code>, we can end up with runtime bugs that should have been caught by the compiler.</p>\n<p>We can make the typings a little more clear by doing the following:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">function inherit&lt;T extends object&gt;(obj: T): Partial&lt;T&gt; {\n    return Object.create(obj);\n}\n</code></pre></div>\n<p>Now Typescript will report that the value of <code>myClone.a</code> might be undefined.</p>\n<p>Let’s improve this a bit more and create an object that inherits and freezes the data in the given object:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-tsx\">function inheritAndFreeze&lt;T extends object&gt;(obj: T, values: Partial&lt;T&gt;): Readonly&lt;Partial&lt;T&gt;&gt; {\n    const properties: PropertyDescriptorMap = {};\n\n    Object.keys(obj).forEach((unsafeKey) =&gt; {\n        const key = unsafeKey as keyof T;\n        properties[key] = {\n            value: values[key] ?? undefined,\n            writable: false,\n            configurable: false,\n        };\n    })\n\n    return Object.create(obj, properties);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\n\nconst myObject = new MyObject(123);\nconst myClone = inheritAndFreeze(myObject, { a: 123 });\n\nconsole.log(myClone); // { a: 123 }\nmyClone.a = 999; // Would throw &quot;Cannot assign to read only property &#x27;a&#x27; of object &#x27;#&lt;MyObject&gt;&#x27; &quot;\n</code></pre></div>\n<p><a href=\"https://www.typescriptlang.org/play?ssl=29&amp;ssc=102&amp;pln=1&amp;pc=1#code/GYVwdgxgLglg9mABDMALApgJxlAgmAEwDFN10AvdAHgBVF0APKdQgZ0TgCMArdaAPgAUXbgC5ENADSIAbgEMANiHStxABTmZYi2vwCU4gEro5BBAoCeVDVpg6a-fogDeAKEQfEEBKyiIADphw-liwKupBIVoWACIqENj+UHCYALJy-ogAvC4AvgDcru6eAPI8fFAAdADW6Baswjx6lcApAKJyEKiCguCscsDoANJ1etlObp5TXj5+tRbZiH0Dw3WIcuzzcMAShdOegcGhMCoA2vMAuouT+9PySuji98qs53VXAPwfS4TowCjoAiSYq3TwAd2wUDknAUj0QwEUrHQwIAkGj0d4wP8AOYgTDQ2HiBEKJHA0EFEGIXJ6IpTUhQPFIMq8aCVBImZiNbjSQ5RMKsPSFXJFCAKDbsVIWZkVFyU-wgGEwCDrcRgEAAW04WEKlMxvkwIGgKUEclVGq1mDGN32UFQMFYlTkizke08wuFrj1fnVUvK0EWYHQYMQkul0EEAEYAEwAZkFntmiB9AGEFAh0IsUBhIfhiKQKOhBD6w1BpM4VYhozGqfGE2BWHBYZU09iixZU+nBYgAPTdkO+ll+ZzCvWN9DNuCtlNpwOOru9yux1wL6fpx2LACcW-yPb7AHU4CAFARELagsGAETJuRgMBwPzimDYpDJRCkUwcMCWAKRUILADkcj-hwOwiDK-4AMRUKGfpQPwwEXkAA\">Playground Link</a></p>\n<p>If we didn’t mark the return value as <code>Readonly&lt;Partial&lt;T&gt;&gt;</code>, and instead just had <code>Partial&lt;T&gt;</code> we would once again have a type-hole and <code>myClone.a = 999;</code> would be allowed by Typescript, but would throw an exception at runtime because property a is read only as a runtime constraint.</p>\n<h2>The Takeaway</h2>\n<p>Let’s step back and really look at what <code>inherit</code> was doing. All it gave us was a template object, and if you read on <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain\">MDN about Inheritance and prototype chaining</a>:</p>\n<blockquote class=\"border-l-4 border-gray-300 pl-4\">\n<p>You may also see some legacy code using <code>[Object.create()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)</code> to build the inheritance chain. However, because this reassigns the <code>prototype</code> property and removes the <code>[constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor)</code> property, it can be more error-prone, while performance gains may not be apparent if the constructors haven&#x27;t created any instances yet.</p>\n</blockquote>\n<p>The key here is to be wary of using utility functions built into the language that return the <code>any</code> type. Be careful what the Typescript constraints are and make sure you don’t have any type-holes when you are using these generic functions.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    pre: \"pre\",\n    a: \"a\",\n    em: \"em\",\n    h2: \"h2\",\n    blockquote: \"blockquote\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"In “Javascript: The Definitive Guide” there is an example that uses \", _jsx(_components.code, {\n        children: \"Object.inherit\"\n      }), \" to inherit the prototype change. JavaScript defines a method \", _jsx(_components.code, {\n        children: \"Object.create\"\n      }), \" that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function inherit<T extends object>(obj: T): T {\\n    return Object.create(obj);\\n}\\n\\nclass MyObject {\\n    public a: number;\\n\\n    constructor(a: number) {\\n        this.a = a;\\n    }\\n}\\nconst myObject = new MyObject(123);\\nconst myClone = inherit(myObject);\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABDMALApgJxlAPAFUXQA8p0wATAZ0TgCMArdaAPgAp6GAuRfASh6EA3gChE4xJnRQQmJAHlGzKADoIUgIZkOjPgG4RAXxEiIAGw1UaAWQCeiptESiJiAA4g6ZmBEQaeYCAAtnRYBmISEAhUUJgg0HCYbP6IgSFYfM4RruJQqDBUKhqIALx+Bq7GxlFgMYhB9kpOZWDoAO6Idg7KbACMAEwAzPqm0VD1tgDCZgjopchoWDhsDd3QI6O1cGboKjMA5iuNjlD6iAD0585+PAODiNXR27sHR9OzZ5fOj1s7e3CHBrvVoLGIaSDoODATrHZSfK6xEDoERAA\",\n        children: \"Playground Link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"However, we lied. Notice that in the above code, the \", _jsx(_components.code, {\n        children: \"myClone\"\n      }), \" object was created without \", _jsx(_components.code, {\n        children: \"a\"\n      }), \" being initialized.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"console.log(myObject); // { a: 123 }\\nconsole.log(myClone); // {}\\nconsole.log(myClone instanceof MyObject); // true\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This creates what is known as a \", _jsx(_components.em, {\n        children: \"type-hole\"\n      }), \": the Typescript compiler will not report any bugs when we try to use \", _jsx(_components.code, {\n        children: \"myClone.a\"\n      }), \".  That’s because we used \", _jsx(_components.code, {\n        children: \"Object.create\"\n      }), \" which returns the \", _jsx(_components.code, {\n        children: \"any\"\n      }), \" type. In the above example, if we tried to use \", _jsx(_components.code, {\n        children: \"myClone.a\"\n      }), \" in a case where we expected a \", _jsx(_components.code, {\n        children: \"number\"\n      }), \", but got \", _jsx(_components.code, {\n        children: \"undefined\"\n      }), \", we can end up with runtime bugs that should have been caught by the compiler.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We can make the typings a little more clear by doing the following:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function inherit<T extends object>(obj: T): Partial<T> {\\n    return Object.create(obj);\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now Typescript will report that the value of \", _jsx(_components.code, {\n        children: \"myClone.a\"\n      }), \" might be undefined.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let’s improve this a bit more and create an object that inherits and freezes the data in the given object:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function inheritAndFreeze<T extends object>(obj: T, values: Partial<T>): Readonly<Partial<T>> {\\n    const properties: PropertyDescriptorMap = {};\\n\\n    Object.keys(obj).forEach((unsafeKey) => {\\n        const key = unsafeKey as keyof T;\\n        properties[key] = {\\n            value: values[key] ?? undefined,\\n            writable: false,\\n            configurable: false,\\n        };\\n    })\\n\\n    return Object.create(obj, properties);\\n}\\n\\nclass MyObject {\\n    public a: number;\\n\\n    constructor(a: number) {\\n        this.a = a;\\n    }\\n}\\n\\nconst myObject = new MyObject(123);\\nconst myClone = inheritAndFreeze(myObject, { a: 123 });\\n\\nconsole.log(myClone); // { a: 123 }\\nmyClone.a = 999; // Would throw \\\"Cannot assign to read only property 'a' of object '#<MyObject>' \\\"\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?ssl=29&ssc=102&pln=1&pc=1#code/GYVwdgxgLglg9mABDMALApgJxlAgmAEwDFN10AvdAHgBVF0APKdQgZ0TgCMArdaAPgAUXbgC5ENADSIAbgEMANiHStxABTmZYi2vwCU4gEro5BBAoCeVDVpg6a-fogDeAKEQfEEBKyiIADphw-liwKupBIVoWACIqENj+UHCYALJy-ogAvC4AvgDcru6eAPI8fFAAdADW6Baswjx6lcApAKJyEKiCguCscsDoANJ1etlObp5TXj5+tRbZiH0Dw3WIcuzzcMAShdOegcGhMCoA2vMAuouT+9PySuji98qs53VXAPwfS4TowCjoAiSYq3TwAd2wUDknAUj0QwEUrHQwIAkGj0d4wP8AOYgTDQ2HiBEKJHA0EFEGIXJ6IpTUhQPFIMq8aCVBImZiNbjSQ5RMKsPSFXJFCAKDbsVIWZkVFyU-wgGEwCDrcRgEAAW04WEKlMxvkwIGgKUEclVGq1mDGN32UFQMFYlTkizke08wuFrj1fnVUvK0EWYHQYMQkul0EEAEYAEwAZkFntmiB9AGEFAh0IsUBhIfhiKQKOhBD6w1BpM4VYhozGqfGE2BWHBYZU09iixZU+nBYgAPTdkO+ll+ZzCvWN9DNuCtlNpwOOru9yux1wL6fpx2LACcW-yPb7AHU4CAFARELagsGAETJuRgMBwPzimDYpDJRCkUwcMCWAKRUILADkcj-hwOwiDK-4AMRUKGfpQPwwEXkAA\",\n        children: \"Playground Link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we didn’t mark the return value as \", _jsx(_components.code, {\n        children: \"Readonly<Partial<T>>\"\n      }), \", and instead just had \", _jsx(_components.code, {\n        children: \"Partial<T>\"\n      }), \" we would once again have a type-hole and \", _jsx(_components.code, {\n        children: \"myClone.a = 999;\"\n      }), \" would be allowed by Typescript, but would throw an exception at runtime because property a is read only as a runtime constraint.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"The Takeaway\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Let’s step back and really look at what \", _jsx(_components.code, {\n        children: \"inherit\"\n      }), \" was doing. All it gave us was a template object, and if you read on \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain\",\n        children: \"MDN about Inheritance and prototype chaining\"\n      }), \":\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"You may also see some legacy code using \", _jsx(_components.code, {\n          children: \"[Object.create()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\"\n        }), \" to build the inheritance chain. However, because this reassigns the \", _jsx(_components.code, {\n          children: \"prototype\"\n        }), \" property and removes the \", _jsx(_components.code, {\n          children: \"[constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor)\"\n        }), \" property, it can be more error-prone, while performance gains may not be apparent if the constructors haven't created any instances yet.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The key here is to be wary of using utility functions built into the language that return the \", _jsx(_components.code, {\n        children: \"any\"\n      }), \" type. Be careful what the Typescript constraints are and make sure you don’t have any type-holes when you are using these generic functions.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nIn “Javascript: The Definitive Guide” there is an example that uses `Object.inherit` to inherit the prototype change. JavaScript defines a method `Object.create` that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:","excerptHTML":"<p>In “Javascript: The Definitive Guide” there is an example that uses <code>Object.inherit</code> to inherit the prototype change. JavaScript defines a method <code>Object.create</code> that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"In “Javascript: The Definitive Guide” there is an example that uses \", _jsx(_components.code, {\n      children: \"Object.inherit\"\n    }), \" to inherit the prototype change. JavaScript defines a method \", _jsx(_components.code, {\n      children: \"Object.create\"\n    }), \" that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-06-data-on-the-wire","date":"2023-08-06","title":"Data on the Wire","frontmatter":{"title":"Data on the Wire","tags":["architecture"]},"contentRaw":"\nBack when [Meteor](https://www.meteor.com/) was in vogue, they popularized the concept of “Data on the wire”. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\n\n> Data on the wire refers mostly to the way that Meteor forms a websocket connection to the server on page load and then transfers the data needed over that connection.\n>\n> The websocket is a live connection and as the data changes, the updates are automatically pushed over the wire and the client updates in real time. (Similar to how many people can edit the same document simultaneously in Google Docs and see each others changes in real time)\n>\n\n- [coagmano on Stackoverflow](https://stackoverflow.com/questions/48512242/in-meteor-what-does-data-on-the-wire-mean)\n\nThis idea was pretty interesting: a UI could always be considered up to date even if another client created a new row in the database. This is because Meteor would listen to the changelog of the MongoDB it was connected to, and then if a client was subscribed to the dataset that change belonged it, Meteor would push that change over the connected websocket.\n\nData on the wire enabled clients to stay up-to-date with any changes and create an amazing experience for users who would see changes instantly. For developers, this was also a huge win for prototyping applications.\n\nBut the problem with data on the wire is that the client can subscribe to a dataset with additional MongoDB filters, but the server now needs to keep track of what clients are subscribed to what subset of data.\n\nIf we start with a dataset `A`, and a user creates a new item `i`, then we know that if a user is subscribed to dataset `A`, we can just send the changes for `i` via a websocket.\n\n```mermaid\nsequenceDiagram\n    Client->>Server: Subscribe to dataset A\n    MongoDB-->>Server: New item i was inserted into A\n    Server-->>Client: Push new item i via websocket\n```\n\nBut if we want to start scaling our servers up, then we must broadcast any change to dataset `A` to every service, and then each service must check if any websocket is subscribed to `A`:\n\n```mermaid\ngraph LR\n  MongoDB --> Server1\n  Client --> Server2\n  MongoDB --> Server2\n  MongoDB --> Server3 \n```\n\n(Technically, each server would either read from the MongoDB change stream, or have a service push an event to them that is listening to the change stream)\n\nNow, each Service needs to additionally check if the item `i` meets any additional filter criteria that each subscriber may have for dataset `A`.\n\nAs datasets grow and filters become more computationally expensive, this can cause a lot of processing and memory burden for each Server.\n\nThis is such a problem that it is even called out in the Meteor documentation: **Scaling Updates**.\n\n> As previously mentioned, Meteor uses MongoDB’s Oplog to identify which changes to apply to which publication. Each change to the database is processed by every Meteor server, so frequent changes can result in high CPU usage across the board. At the same time, your database will come under higher load as all your servers keep fetching data from the oplog.\n>\n\nI’ve just thought about this recently since I had a conversation about keeping UI’s up-to-date with realtime data based on subscribing to that dataset via a websocket and it sounded eerily familiar to problems I have seen in the past.\n\nIn fact, similarly, I’ve seen trouble with GraphQL Subscriptions having similar issues, since each server node now needs to identify when to push data back to a subscriber:\n\n> GraphQL Subscriptions (GQLS) are a mechanism which allow clients to subscribe to changes in a piece of data from the server, and get notified whenever that data changes.\n>\n\n[The relay spec](https://relay.dev/docs/v13.0.0/guided-tour/updating-data/graphql-subscriptions/) makes no mention of how a server might do this though. There is a handy tutorial by LogRocket on implementing a NodeJS server to handle subscriptions though: [GraphQL Subscriptions with NodeJS and Express](https://blog.logrocket.com/graphql-subscriptions-nodejs-express/).\n\nBut if you look at the diagrams, they seem awfully familiar…\n","contentHTML":"<p>Back when <a href=\"https://www.meteor.com/\">Meteor</a> was in vogue, they popularized the concept of “Data on the wire”. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.</p>\n<blockquote class=\"border-l-4 border-gray-300 pl-4\">\n<p>Data on the wire refers mostly to the way that Meteor forms a websocket connection to the server on page load and then transfers the data needed over that connection.</p>\n<p>The websocket is a live connection and as the data changes, the updates are automatically pushed over the wire and the client updates in real time. (Similar to how many people can edit the same document simultaneously in Google Docs and see each others changes in real time)</p>\n</blockquote>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/48512242/in-meteor-what-does-data-on-the-wire-mean\">coagmano on Stackoverflow</a></li>\n</ul>\n<p>This idea was pretty interesting: a UI could always be considered up to date even if another client created a new row in the database. This is because Meteor would listen to the changelog of the MongoDB it was connected to, and then if a client was subscribed to the dataset that change belonged it, Meteor would push that change over the connected websocket.</p>\n<p>Data on the wire enabled clients to stay up-to-date with any changes and create an amazing experience for users who would see changes instantly. For developers, this was also a huge win for prototyping applications.</p>\n<p>But the problem with data on the wire is that the client can subscribe to a dataset with additional MongoDB filters, but the server now needs to keep track of what clients are subscribed to what subset of data.</p>\n<p>If we start with a dataset <code>A</code>, and a user creates a new item <code>i</code>, then we know that if a user is subscribed to dataset <code>A</code>, we can just send the changes for <code>i</code> via a websocket.</p>\n<div class=\"py-8 [&amp;_svg]:m-auto\"><div class=\"mermaid\" data-mermaid-src=\"sequenceDiagram\n    Client-&gt;&gt;Server: Subscribe to dataset A\n    MongoDB--&gt;&gt;Server: New item i was inserted into A\n    Server--&gt;&gt;Client: Push new item i via websocket\">sequenceDiagram\n    Client-&gt;&gt;Server: Subscribe to dataset A\n    MongoDB--&gt;&gt;Server: New item i was inserted into A\n    Server--&gt;&gt;Client: Push new item i via websocket</div></div>\n<p>But if we want to start scaling our servers up, then we must broadcast any change to dataset <code>A</code> to every service, and then each service must check if any websocket is subscribed to <code>A</code>:</p>\n<div class=\"py-8 [&amp;_svg]:m-auto\"><div class=\"mermaid\" data-mermaid-src=\"graph LR\n  MongoDB --&gt; Server1\n  Client --&gt; Server2\n  MongoDB --&gt; Server2\n  MongoDB --&gt; Server3 \">graph LR\n  MongoDB --&gt; Server1\n  Client --&gt; Server2\n  MongoDB --&gt; Server2\n  MongoDB --&gt; Server3 </div></div>\n<p>(Technically, each server would either read from the MongoDB change stream, or have a service push an event to them that is listening to the change stream)</p>\n<p>Now, each Service needs to additionally check if the item <code>i</code> meets any additional filter criteria that each subscriber may have for dataset <code>A</code>.</p>\n<p>As datasets grow and filters become more computationally expensive, this can cause a lot of processing and memory burden for each Server.</p>\n<p>This is such a problem that it is even called out in the Meteor documentation: <strong>Scaling Updates</strong>.</p>\n<blockquote class=\"border-l-4 border-gray-300 pl-4\">\n<p>As previously mentioned, Meteor uses MongoDB’s Oplog to identify which changes to apply to which publication. Each change to the database is processed by every Meteor server, so frequent changes can result in high CPU usage across the board. At the same time, your database will come under higher load as all your servers keep fetching data from the oplog.</p>\n</blockquote>\n<p>I’ve just thought about this recently since I had a conversation about keeping UI’s up-to-date with realtime data based on subscribing to that dataset via a websocket and it sounded eerily familiar to problems I have seen in the past.</p>\n<p>In fact, similarly, I’ve seen trouble with GraphQL Subscriptions having similar issues, since each server node now needs to identify when to push data back to a subscriber:</p>\n<blockquote class=\"border-l-4 border-gray-300 pl-4\">\n<p>GraphQL Subscriptions (GQLS) are a mechanism which allow clients to subscribe to changes in a piece of data from the server, and get notified whenever that data changes.</p>\n</blockquote>\n<p><a href=\"https://relay.dev/docs/v13.0.0/guided-tour/updating-data/graphql-subscriptions/\">The relay spec</a> makes no mention of how a server might do this though. There is a handy tutorial by LogRocket on implementing a NodeJS server to handle subscriptions though: <a href=\"https://blog.logrocket.com/graphql-subscriptions-nodejs-express/\">GraphQL Subscriptions with NodeJS and Express</a>.</p>\n<p>But if you look at the diagrams, they seem awfully familiar…</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    blockquote: \"blockquote\",\n    ul: \"ul\",\n    li: \"li\",\n    code: \"code\",\n    strong: \"strong\"\n  }, props.components), {Mermaid} = _components;\n  if (!Mermaid) _missingMdxReference(\"Mermaid\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Back when \", _jsx(_components.a, {\n        href: \"https://www.meteor.com/\",\n        children: \"Meteor\"\n      }), \" was in vogue, they popularized the concept of “Data on the wire”. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"Data on the wire refers mostly to the way that Meteor forms a websocket connection to the server on page load and then transfers the data needed over that connection.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The websocket is a live connection and as the data changes, the updates are automatically pushed over the wire and the client updates in real time. (Similar to how many people can edit the same document simultaneously in Google Docs and see each others changes in real time)\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://stackoverflow.com/questions/48512242/in-meteor-what-does-data-on-the-wire-mean\",\n          children: \"coagmano on Stackoverflow\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This idea was pretty interesting: a UI could always be considered up to date even if another client created a new row in the database. This is because Meteor would listen to the changelog of the MongoDB it was connected to, and then if a client was subscribed to the dataset that change belonged it, Meteor would push that change over the connected websocket.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Data on the wire enabled clients to stay up-to-date with any changes and create an amazing experience for users who would see changes instantly. For developers, this was also a huge win for prototyping applications.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But the problem with data on the wire is that the client can subscribe to a dataset with additional MongoDB filters, but the server now needs to keep track of what clients are subscribed to what subset of data.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we start with a dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \", and a user creates a new item \", _jsx(_components.code, {\n        children: \"i\"\n      }), \", then we know that if a user is subscribed to dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \", we can just send the changes for \", _jsx(_components.code, {\n        children: \"i\"\n      }), \" via a websocket.\"]\n    }), \"\\n\", _jsx(Mermaid, {\n      chart: \"sequenceDiagram\\n    Client->>Server: Subscribe to dataset A\\n    MongoDB-->>Server: New item i was inserted into A\\n    Server-->>Client: Push new item i via websocket\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"But if we want to start scaling our servers up, then we must broadcast any change to dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \" to every service, and then each service must check if any websocket is subscribed to \", _jsx(_components.code, {\n        children: \"A\"\n      }), \":\"]\n    }), \"\\n\", _jsx(Mermaid, {\n      chart: \"graph LR\\n  MongoDB --> Server1\\n  Client --> Server2\\n  MongoDB --> Server2\\n  MongoDB --> Server3 \"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(Technically, each server would either read from the MongoDB change stream, or have a service push an event to them that is listening to the change stream)\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now, each Service needs to additionally check if the item \", _jsx(_components.code, {\n        children: \"i\"\n      }), \" meets any additional filter criteria that each subscriber may have for dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As datasets grow and filters become more computationally expensive, this can cause a lot of processing and memory burden for each Server.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This is such a problem that it is even called out in the Meteor documentation: \", _jsx(_components.strong, {\n        children: \"Scaling Updates\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"As previously mentioned, Meteor uses MongoDB’s Oplog to identify which changes to apply to which publication. Each change to the database is processed by every Meteor server, so frequent changes can result in high CPU usage across the board. At the same time, your database will come under higher load as all your servers keep fetching data from the oplog.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I’ve just thought about this recently since I had a conversation about keeping UI’s up-to-date with realtime data based on subscribing to that dataset via a websocket and it sounded eerily familiar to problems I have seen in the past.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In fact, similarly, I’ve seen trouble with GraphQL Subscriptions having similar issues, since each server node now needs to identify when to push data back to a subscriber:\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"GraphQL Subscriptions (GQLS) are a mechanism which allow clients to subscribe to changes in a piece of data from the server, and get notified whenever that data changes.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"https://relay.dev/docs/v13.0.0/guided-tour/updating-data/graphql-subscriptions/\",\n        children: \"The relay spec\"\n      }), \" makes no mention of how a server might do this though. There is a handy tutorial by LogRocket on implementing a NodeJS server to handle subscriptions though: \", _jsx(_components.a, {\n        href: \"https://blog.logrocket.com/graphql-subscriptions-nodejs-express/\",\n        children: \"GraphQL Subscriptions with NodeJS and Express\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But if you look at the diagrams, they seem awfully familiar…\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","excerptRaw":"\nBack when [Meteor](https://www.meteor.com/) was in vogue, they popularized the concept of “Data on the wire”. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.","excerptHTML":"<p>Back when <a href=\"https://www.meteor.com/\">Meteor</a> was in vogue, they popularized the concept of “Data on the wire”. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"Back when \", _jsx(_components.a, {\n      href: \"https://www.meteor.com/\",\n      children: \"Meteor\"\n    }), \" was in vogue, they popularized the concept of “Data on the wire”. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["architecture"]},{"slug":"2023-07-26-component-library-checklist","date":"2023-07-26","title":"Component Library Checklist","frontmatter":{"title":"Component Library Checklist","tags":["component library","checklist"]},"contentRaw":"\nThe following is a checklist I like to use to ensure I'm covering all the bases when building a component library. It's a work in progress, but I hope it can be useful to others.\n\n## Visual Language\n\n- [ ]  Color\n  - [ ]  Palettes, by category\n  - [ ]  Dark mode\n- [ ]  Typography\n  - [ ]  Headings\n  - [ ]  Text\n  - [ ]  Paragraph\n  - [ ]  Lead paragraphs\n  - [ ]  Readable text\n- [ ]  Iconography\n  - [ ]  Icons\n  - [ ]  Meaning\n- [ ]  Space\n  - [ ]  Units / measurements\n\n## Text\n\n- [ ]  Block quote\n- [ ]  Unordered list\n- [ ]  Ordered list\n- [ ]  Internal link\n- [ ]  External link\n- [ ]  Code\n\n## Buttons\n\n- [ ]  Buttons\n  - [ ]  Primary\n  - [ ]  Secondary\n  - [ ]  Button groups\n  - [ ]  Menu buttons\n  - [ ]  Split buttons\n  - [ ]  Floating action button\n  - [ ]  Brand buttons (Google, FB, Discord)\n\n## Forms\n\n- [ ]  Form controls\n  - [ ]  Text input\n  - [ ]  Email/number/other variant inputs\n  - [ ]  Multi-line text area\n  - [ ]  Radio and radio group\n  - [ ]  Checkbox and checkbox group\n  - [ ]  Select\n  - [ ]  File upload\n  - [ ]  Label\n  - [ ]  Required label\n  - [ ]  Switch\n  - [ ]  Slider\n  - [ ]  Calendar picker\n  - [ ]  Rich text editor\n- [ ]  Form structure\n\n## Layout\n\n- [ ]  Divider\n- [ ]  Box\n- [ ]  Marketing grid\n- [ ]  App grid\n- [ ]  Page transitions\n- [ ]  Resopnsive breakpoints\n\n## Content\n\n- [ ]  Image\n- [ ]  Avatar\n- [ ]  Code block\n- [ ]  Footnotes\n- [ ]  Thumbnails\n- [ ]  Video\n- [ ]  Map widget\n\n## UI Components\n\n- [ ]  Alerts\n- [ ]  Accordion\n- [ ]  Back to top\n- [ ]  Badges/tags/chips/pills\n- [ ]  Breadcrumbs\n- [ ]  Caption\n- [ ]  Cards\n  - [ ]  Panel\n  - [ ]  Callout\n- [ ]  Chat\n- [ ]  Comments\n- [ ]  Tables\n  - [ ]  Data table\n  - [ ]  Property table\n- [ ]  Drawer\n- [ ]  Filters\n- [ ]  Footer\n- [ ]  Header\n- [ ]  Error (standard error handler)\n- [ ]  Loading / spinner / shimmer\n- [ ]  Toast\n- [ ]  Notification / badge (dot)\n- [ ]  Modal\n- [ ]  Pagination\n- [ ]  Popover\n- [ ]  Progress bar\n- [ ]  Search\n- [ ]  Sidebar\n- [ ]  Sort by\n- [ ]  Tabs\n- [ ]  Tooltips\n\n## Navigation\n\n- [ ]  Action bar / toolbar\n- [ ]  Main menu / Megamenu\n- [ ]  Inline menu\n\n## Marketing\n\n- [ ]  Contact us\n- [ ]  Cookie notification\n- [ ]  Hero billboard\n- [ ]  Hero carousel\n- [ ]  Legend\n- [ ]  Pull quote\n- [ ]  Ratings\n- [ ]  Reviews\n- [ ]  Social networking\n- [ ]  Status (alpha, beta)\n- [ ]  Tips / tutorial\n\n## UI Patterns\n\n- [ ]  Authentication\n- [ ]  Create account\n- [ ]  Permissions\n- [ ]  Purchase/checkout\n- [ ]  Settings\n- [ ]  Site / app structure\n","contentHTML":"<p>The following is a checklist I like to use to ensure I&#x27;m covering all the bases when building a component library. It&#x27;s a work in progress, but I hope it can be useful to others.</p>\n<h2>Visual Language</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Color<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Palettes, by category</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Dark mode</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Typography<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Headings</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Text</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Paragraph</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Lead paragraphs</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Readable text</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Iconography<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Icons</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Meaning</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Space<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Units / measurements</li>\n</ul>\n</li>\n</ul>\n<h2>Text</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Block quote</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Unordered list</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Ordered list</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Internal link</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> External link</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Code</li>\n</ul>\n<h2>Buttons</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Buttons<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Primary</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Secondary</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Button groups</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Menu buttons</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Split buttons</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Floating action button</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Brand buttons (Google, FB, Discord)</li>\n</ul>\n</li>\n</ul>\n<h2>Forms</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Form controls<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Text input</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Email/number/other variant inputs</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Multi-line text area</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Radio and radio group</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Checkbox and checkbox group</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Select</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> File upload</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Label</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Required label</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Switch</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Slider</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Calendar picker</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Rich text editor</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Form structure</li>\n</ul>\n<h2>Layout</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Divider</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Box</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Marketing grid</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> App grid</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Page transitions</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Resopnsive breakpoints</li>\n</ul>\n<h2>Content</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Image</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Avatar</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Code block</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Footnotes</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Thumbnails</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Video</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Map widget</li>\n</ul>\n<h2>UI Components</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Alerts</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Accordion</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Back to top</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Badges/tags/chips/pills</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Breadcrumbs</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Caption</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Cards<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Panel</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Callout</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Chat</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Comments</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Tables<!-- -->\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Data table</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Property table</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Drawer</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Filters</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Footer</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Header</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Error (standard error handler)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Loading / spinner / shimmer</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Toast</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Notification / badge (dot)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Modal</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Pagination</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Popover</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Progress bar</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Search</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Sidebar</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Sort by</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Tabs</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Tooltips</li>\n</ul>\n<h2>Navigation</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Action bar / toolbar</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Main menu / Megamenu</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Inline menu</li>\n</ul>\n<h2>Marketing</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Contact us</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Cookie notification</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Hero billboard</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Hero carousel</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Legend</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Pull quote</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Ratings</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Reviews</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Social networking</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Status (alpha, beta)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Tips / tutorial</li>\n</ul>\n<h2>UI Patterns</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Authentication</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Create account</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Permissions</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Purchase/checkout</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Settings</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled=\"\"/> <!-- --> Site / app structure</li>\n</ul>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    ul: \"ul\",\n    li: \"li\",\n    input: \"input\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"The following is a checklist I like to use to ensure I'm covering all the bases when building a component library. It's a work in progress, but I hope it can be useful to others.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Visual Language\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Color\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Palettes, by category\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Dark mode\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Typography\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Headings\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Text\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Paragraph\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Lead paragraphs\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Readable text\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Iconography\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Icons\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Meaning\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Space\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Units / measurements\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Text\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Block quote\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Unordered list\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Ordered list\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Internal link\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" External link\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Code\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Buttons\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Buttons\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Primary\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Secondary\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Button groups\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Menu buttons\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Split buttons\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Floating action button\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Brand buttons (Google, FB, Discord)\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Forms\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Form controls\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Text input\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Email/number/other variant inputs\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Multi-line text area\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Radio and radio group\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Checkbox and checkbox group\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Select\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" File upload\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Label\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Required label\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Switch\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Slider\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Calendar picker\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Rich text editor\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Form structure\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Layout\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Divider\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Box\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Marketing grid\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" App grid\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Page transitions\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Resopnsive breakpoints\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Content\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Image\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Avatar\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Code block\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Footnotes\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Thumbnails\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Video\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Map widget\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"UI Components\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Alerts\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Accordion\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Back to top\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Badges/tags/chips/pills\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Breadcrumbs\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Caption\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Cards\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Panel\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Callout\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Chat\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Comments\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Tables\", \"\\n\", _jsxs(_components.ul, {\n          className: \"contains-task-list\",\n          children: [\"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Data table\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            className: \"task-list-item\",\n            children: [_jsx(_components.input, {\n              type: \"checkbox\",\n              disabled: true\n            }), \" \", \" Property table\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Drawer\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Filters\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Footer\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Header\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Error (standard error handler)\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Loading / spinner / shimmer\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Toast\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Notification / badge (dot)\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Modal\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Pagination\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Popover\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Progress bar\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Search\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Sidebar\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Sort by\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Tabs\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Tooltips\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Navigation\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Action bar / toolbar\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Main menu / Megamenu\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Inline menu\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Marketing\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Contact us\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Cookie notification\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Hero billboard\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Hero carousel\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Legend\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Pull quote\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Ratings\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Reviews\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Social networking\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Status (alpha, beta)\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Tips / tutorial\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"UI Patterns\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      className: \"contains-task-list\",\n      children: [\"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Authentication\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Create account\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Permissions\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Purchase/checkout\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Settings\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        className: \"task-list-item\",\n        children: [_jsx(_components.input, {\n          type: \"checkbox\",\n          disabled: true\n        }), \" \", \" Site / app structure\"]\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nThe following is a checklist I like to use to ensure I'm covering all the bases when building a component library. It's a work in progress, but I hope it can be useful to others.","excerptHTML":"<p>The following is a checklist I like to use to ensure I&#x27;m covering all the bases when building a component library. It&#x27;s a work in progress, but I hope it can be useful to others.</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"The following is a checklist I like to use to ensure I'm covering all the bases when building a component library. It's a work in progress, but I hope it can be useful to others.\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["component library","checklist"]},{"slug":"2023-07-24-tsc-debugging","date":"2023-07-24","title":"Debugging slow tsc","frontmatter":{"title":"Debugging slow tsc","tags":["typescript"]},"contentRaw":"\nI was working on a project and I noticed the `tsc` check that we ran on pre-commit hooks had become dramatically slower. I was seeing near instant times to type check the entire project go to agonizingly slow minutes to check the project. I was able to narrow the range of commits to some change we made within a month window. I’m sure I could have narrowed it down by continuing to git bisect and re-running `time npx tsc`, but it was much easier to just check out main and try out the following:\n\n```bash\n# remove any pre-built definitions to get a good baseline\nrm -r .tsBuildInfo\n\n# Get some baseline stats\ntime npx tsc\n```\n\nI was seeing values around (times have been modified for blogging purposes):\n\n```bash\nreal 1m30.000s\nuser 2m0.000s\nsys 0m3.000s\n```\n\nAfter running the baseline trace, I could analyze the `tsc` trace and use a nifty tool called `analyze-trace` that will report hotspots:\n\n```bash\nnpm i -g @typescript/analyze-trace\n\nnpx tsc --generateTrace ./.trace\nnpx analyze-trace ./.trace\n```\n\nThis command will spit out which files are hotspots in your codebase. To my surprise, I was seeing build outputs from webpack as a hotspot.\n\nTurns out the `tsconfig.json` had been slightly modified and accidentally included the build folder. Adding the build folder to the excludes entry sped up the tsc command by quite a bit:\n\n```bash\nreal 0m30.000s\nuser 0m47.000s\nsys 0m2.000s\n```\n\nNot only did the trace help me identify the major hotspot in the code, but also\nindicated some additional areas that I could improve upon going forward.\n","contentHTML":"<p>I was working on a project and I noticed the <code>tsc</code> check that we ran on pre-commit hooks had become dramatically slower. I was seeing near instant times to type check the entire project go to agonizingly slow minutes to check the project. I was able to narrow the range of commits to some change we made within a month window. I’m sure I could have narrowed it down by continuing to git bisect and re-running <code>time npx tsc</code>, but it was much easier to just check out main and try out the following:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-bash\"># remove any pre-built definitions to get a good baseline\nrm -r .tsBuildInfo\n\n# Get some baseline stats\ntime npx tsc\n</code></pre></div>\n<p>I was seeing values around (times have been modified for blogging purposes):</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-bash\">real 1m30.000s\nuser 2m0.000s\nsys 0m3.000s\n</code></pre></div>\n<p>After running the baseline trace, I could analyze the <code>tsc</code> trace and use a nifty tool called <code>analyze-trace</code> that will report hotspots:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-bash\">npm i -g @typescript/analyze-trace\n\nnpx tsc --generateTrace ./.trace\nnpx analyze-trace ./.trace\n</code></pre></div>\n<p>This command will spit out which files are hotspots in your codebase. To my surprise, I was seeing build outputs from webpack as a hotspot.</p>\n<p>Turns out the <code>tsconfig.json</code> had been slightly modified and accidentally included the build folder. Adding the build folder to the excludes entry sped up the tsc command by quite a bit:</p>\n<div class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"><pre><code class=\"language-bash\">real 0m30.000s\nuser 0m47.000s\nsys 0m2.000s\n</code></pre></div>\n<p>Not only did the trace help me identify the major hotspot in the code, but also\nindicated some additional areas that I could improve upon going forward.</p>","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    pre: \"pre\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"I was working on a project and I noticed the \", _jsx(_components.code, {\n        children: \"tsc\"\n      }), \" check that we ran on pre-commit hooks had become dramatically slower. I was seeing near instant times to type check the entire project go to agonizingly slow minutes to check the project. I was able to narrow the range of commits to some change we made within a month window. I’m sure I could have narrowed it down by continuing to git bisect and re-running \", _jsx(_components.code, {\n        children: \"time npx tsc\"\n      }), \", but it was much easier to just check out main and try out the following:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"# remove any pre-built definitions to get a good baseline\\nrm -r .tsBuildInfo\\n\\n# Get some baseline stats\\ntime npx tsc\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I was seeing values around (times have been modified for blogging purposes):\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"real 1m30.000s\\nuser 2m0.000s\\nsys 0m3.000s\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"After running the baseline trace, I could analyze the \", _jsx(_components.code, {\n        children: \"tsc\"\n      }), \" trace and use a nifty tool called \", _jsx(_components.code, {\n        children: \"analyze-trace\"\n      }), \" that will report hotspots:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"npm i -g @typescript/analyze-trace\\n\\nnpx tsc --generateTrace ./.trace\\nnpx analyze-trace ./.trace\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This command will spit out which files are hotspots in your codebase. To my surprise, I was seeing build outputs from webpack as a hotspot.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Turns out the \", _jsx(_components.code, {\n        children: \"tsconfig.json\"\n      }), \" had been slightly modified and accidentally included the build folder. Adding the build folder to the excludes entry sped up the tsc command by quite a bit:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"real 0m30.000s\\nuser 0m47.000s\\nsys 0m2.000s\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Not only did the trace help me identify the major hotspot in the code, but also\\nindicated some additional areas that I could improve upon going forward.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nI was working on a project and I noticed the `tsc` check that we ran on pre-commit hooks had become dramatically slower. I was seeing near instant times to type check the entire project go to agonizingly slow minutes to check the project. I was able to narrow the range of commits to some change we made within a month window. I’m sure I could have narrowed it down by continuing to git bisect and re-running `time npx tsc`, but it was much easier to just check out main and try out the following:","excerptHTML":"<p>I was working on a project and I noticed the <code>tsc</code> check that we ran on pre-commit hooks had become dramatically slower. I was seeing near instant times to type check the entire project go to agonizingly slow minutes to check the project. I was able to narrow the range of commits to some change we made within a month window. I’m sure I could have narrowed it down by continuing to git bisect and re-running <code>time npx tsc</code>, but it was much easier to just check out main and try out the following:</p>","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"I was working on a project and I noticed the \", _jsx(_components.code, {\n      children: \"tsc\"\n    }), \" check that we ran on pre-commit hooks had become dramatically slower. I was seeing near instant times to type check the entire project go to agonizingly slow minutes to check the project. I was able to narrow the range of commits to some change we made within a month window. I’m sure I could have narrowed it down by continuing to git bisect and re-running \", _jsx(_components.code, {\n      children: \"time npx tsc\"\n    }), \", but it was much easier to just check out main and try out the following:\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]}],"hasNextPage":false,"hasPreviousPage":true},"__N_SSG":true}