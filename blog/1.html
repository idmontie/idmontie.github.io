<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf8"/><title>Blog Page <!-- -->1<!-- --> - idmontie&#x27;s Portfolio</title><meta name="description" content="Latest blog posts"/><meta name="next-head-count" content="4"/><script>
                        try {
                            const storage = window && window.localStorage;
                            if (
                                storage.getItem("color-theme") === "dark" ||
                                (!("color-theme" in storage) &&
                                    window.matchMedia("(prefers-color-scheme: dark)").matches)
                            ) {
                                document.documentElement.classList.add("dark");
                            } else {
                                document.documentElement.classList.remove("dark");
                            }
                        } catch (e) {
                            console.error(e);
                        }
                        </script><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/e3a1fdb20d955547.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e3a1fdb20d955547.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f5a48affa2e5582e.js" defer=""></script><script src="/_next/static/chunks/framework-dfd14d7ce6600b03.js" defer=""></script><script src="/_next/static/chunks/main-3412f4325dfb32ac.js" defer=""></script><script src="/_next/static/chunks/pages/_app-16c6de052764dd01.js" defer=""></script><script src="/_next/static/chunks/2e6ef0e3-e0509ad90a52e50d.js" defer=""></script><script src="/_next/static/chunks/956-14a634a4f6c953dc.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpage%5D-bc0ce0e5778fbd51.js" defer=""></script><script src="/_next/static/gEVTUNzVunNOiSnIwtpBI/_buildManifest.js" defer=""></script><script src="/_next/static/gEVTUNzVunNOiSnIwtpBI/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Open+Sans:wght@300;400;700&display=swap">@font-face{font-family:'Merriweather';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l521wRpXA.woff) format('woff')}@font-face{font-family:'Merriweather';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-440qyriQwlOrhSvowK_l5OeA.woff) format('woff')}@font-face{font-family:'Merriweather';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l52xwNpXA.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Merriweather';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l521wRZVcf6hPvhPUWH.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Merriweather';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l521wRZXMf6hPvhPUWH.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Merriweather';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l521wRZV8f6hPvhPUWH.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Merriweather';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l521wRZVsf6hPvhPUWH.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Merriweather';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l521wRZWMf6hPvhPQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Merriweather';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-440qyriQwlOrhSvowK_l5-cSZMdeX3rsHo.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Merriweather';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-440qyriQwlOrhSvowK_l5-eCZMdeX3rsHo.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Merriweather';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-440qyriQwlOrhSvowK_l5-cyZMdeX3rsHo.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Merriweather';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-440qyriQwlOrhSvowK_l5-ciZMdeX3rsHo.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Merriweather';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-440qyriQwlOrhSvowK_l5-fCZMdeX3rg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Merriweather';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l52xwNZVcf6hPvhPUWH.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Merriweather';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l52xwNZXMf6hPvhPUWH.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Merriweather';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l52xwNZV8f6hPvhPUWH.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Merriweather';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l52xwNZVsf6hPvhPUWH.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Merriweather';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/merriweather/v30/u-4n0qyriQwlOrhSvowK_l52xwNZWMf6hPvhPQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="leading-base bg-white text-lg antialiased dark:bg-gray-900 dark:text-white"><div id="__next"><nav class="flex items-center p-3"><div class="flex-1 space-x-4"><a class="" href="/">Home</a><a class="" href="/blog">Blog</a><a class="" href="/blog/tag">Tags</a><a class="" href="/portfolio">Portfolio</a></div><div class="flex flex-1 justify-end"><label for="toggle" class="relative flex w-fit cursor-pointer items-center">üåë<input type="checkbox" id="toggle" class="sr-only"/><div class="
                        relative
                        h-6
                        w-11
                        rounded-full
                        border-2
                    
                        after:absolute
                        after:h-5
                        after:w-5
                        after:rounded-full
                        after:border
                        after:border-gray-300
                        after:bg-white
                        after:shadow-sm
                        after:transition
                     
                            border-gray-200
                            bg-gray-200
                            dark:border-gray-700
                            dark:bg-gray-700
                        "></div>‚òÄÔ∏è</label></div></nav><div class="relative overflow-hidden pb-4"><div class="mx-auto flex w-full max-w-screen-md flex-col items-center"><main class="app max-w-full"><div><div class="px-4"><header><h1 class="my-8 text-center text-3xl font-bold dark:text-white md:text-5xl">Blog Page <!-- -->1</h1></header><div class="space-y-6"><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-19-localization"><h2 class="text-2xl font-bold">Enforcing Localization through Types</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>When building web applications, enforcing that strings be localized to the user‚Äôs preferred language can sometimes be achieved via lint rules. But what if we could enforce proper localization using types in Typescript?</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-19-localization">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-17-feature-context"><h2 class="text-2xl font-bold">Feature Contexts</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>A common pattern in larger application when trying to track feature usage is to try to namespace events. For example, you might have a button that you want to track clicks on. For the sake of this article, we will use the <code>data-track</code> attribute on elements to track their usage, but you can imagine this works with any tracking implementation where you may need to explicitly call a tracking function (e.g. <code>track(namespace)</code>).</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-17-feature-context">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-14-partial-objects"><h2 class="text-2xl font-bold">Forbidden Typescript: full/partial objects</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>When trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn‚Äôt know that the object is complete:</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-14-partial-objects">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-13-reviewing-frontend-applications"><h2 class="text-2xl font-bold">Reviewing Your Frontend Applications</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>Below are some notes I‚Äôve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-13-reviewing-frontend-applications">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-12-ensuring-all-of-type"><h2 class="text-2xl font-bold">Forbidden Typescript: ensuring all of a type</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>When creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-12-ensuring-all-of-type">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-11-smart-contract-security"><h2 class="text-2xl font-bold">Smart Contract Security</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>The crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it‚Äôs important to make sure the Smart Contract is secure and follows best practices.</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-11-smart-contract-security">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-10-get-class"><h2 class="text-2xl font-bold">Forbidden Typescript: Get Class Name</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>We don‚Äôt get a lot of information using <code>typeof</code> in JavaScript or TypeScript. At most, it tells us whether a value is <code>undefined</code>, <code>number</code>, <code>string</code>, or <code>object</code>. If you want to get the class name using a function, you can use the following extended version of <code>classOf</code> that is originally from ‚ÄúJavaScript: The Definitive Guide‚Äù:</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-10-get-class">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-09-enumerating-properties"><h2 class="text-2xl font-bold">Forbidden Typescript: Enumerating Properties</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>In <a href="https://amzn.to/3rV5Xov">‚ÄúJavaScript: The Definitive Guide‚Äù</a>, there are functions described in <strong>6.5 Enumerating Properties</strong> that probably shouldn‚Äôt be used in production code because they modify their input parameters: <code>extend</code>, <code>merge</code>, <code>restrict</code>, and <code>subtract</code>.</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-09-enumerating-properties">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-07-object-create"><h2 class="text-2xl font-bold">Forbidden Typescript: Using Object.create to clone</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>In ‚ÄúJavascript: The Definitive Guide‚Äù there is an example that uses <code>Object.inherit</code> to inherit the prototype change. JavaScript defines a method <code>Object.create</code> that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-07-object-create">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div><div class="overflow-visible rounded-lg bg-white shadow-lg dark:bg-gray-800"><div class="p-4"><a href="/blog/post/2023-08-06-data-on-the-wire"><h2 class="text-2xl font-bold">Data on the Wire</h2></a><div class="py-2 text-sm"></div><div class="prose dark:prose-dark py-4"><div><div><p>Back when <a href="https://www.meteor.com/">Meteor</a> was in vogue, they popularized the concept of ‚ÄúData on the wire‚Äù. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.</p></div></div></div><div class="pt-2"><a href="/blog/post/2023-08-06-data-on-the-wire">Continue reading<span class="ml-2">‚Üí</span></a></div></div></div></div><div><div></div><div><a href="/blog/2">Older posts &gt;</a></div></div></div></div></main></div></div><footer class="width-full border-top bg-gray-light my-4 p-4"><div class="flex-justify-between flex px-3 text-gray-700 dark:text-gray-300"><div class="flex flex-1 flex-row gap-6"><div>Like this blog and portfolio? Check it out on<!-- --> <a href="https://github.com/idmontie/idmontie.github.io" target="_blank" rel="noopener noreferrer">Github</a></div><div>|</div><div><a href="/rss.xml" target="_blank" rel="noopener noreferrer">RSS Feed</a></div></div><div class="flex self-end"><button>Back to top</button></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"slug":"2023-08-19-localization","date":"2023-08-19","title":"Enforcing Localization through Types","frontmatter":{"title":"Enforcing Localization through Types","tags":["typescript","react"]},"contentRaw":"\nWhen building web applications, enforcing that strings be localized to the user‚Äôs preferred language can sometimes be achieved via lint rules. But what if we could enforce proper localization using types in Typescript?\n\n## Defining a Localized Type\n\nTypescript doesn‚Äôt natively provide an [Opaque type](https://en.wikipedia.org/wiki/Opaque_data_type) that we can use to define a string that has already been localized. If the data looks like a string, Typescript will consider it a string. We can however use utility types that simulate opaque types, like the Opaque definition in [type-fest](https://github.com/sindresorhus/type-fest):\n\n```tsx\nimport { Opaque } from 'type-fest';\n\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\n```\n\n[Playground example](https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAbzgeTAQwI4FcCmcC+cAZlBCHAOQwCeYOAtETgM4wUDcAUJzXXADIQAxmgA2wAF44AJgGUYUYADsA5nAC8KdNhwAeCoJHipchcpUUANHFaLVAPnZA)\n\nHere is a short example where we create a localized string and try to use a raw string and our localized string in a function:\n\n```tsx\nimport { Opaque } from 'type-fest';\n\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\n\nfunction createLocalizedString(s: string): LocalizedString {\n    return s as LocalizedString;\n}\n\nfunction example(s: LocalizedString) {\n    return s;\n}\n\nconsole.log(example('test')); // Will throw a type error\nconsole.log(example(createLocalizedString('test'))); // Works correctly\n```\n\n[Playground example](https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAbzgeTAQwI4FcCmcC+cAZlBCHAOQwCeYOAtETgM4wUDcAUJzXXADIQAxmgA2wAF44AJgGUYUYADsA5nAC8KdNhwAeCoJHipchcpUUANHFaLVAPi6ciWJUJjAISuEKg40MDiGYpIy8nYqABTMAFw2ZqoAlHHBxmEJagiccDlwfjBYUN7McGglqaGmEVz43C5uHl5wOAAeaOCiONEpwiEm4eaJiNm5+YXFNdxCXswQnQB0ohBRre1gnZFULGyJiVzTSrMLSyttHV2+-oEV-RmbgawUu3tAA)\n\nNow we have a type that we can use in our function and components to denote that we expect an already localized string to be used.\n\n## Enforcing in Components\n\nThe simplest way we can enforce that strings have already been localized is by using the type in our component‚Äôs props interface:\n\n```tsx\n\ninterface ButtonProps {\n  label: LocalizedString;\n}\n\nfunction Button(props: ButtonProps) {\n  return \u003cbutton\u003e{props.label}\u003c/button\u003e;\n}\n```\n\nNow if we try to use that component without a localized string, we get an error:\n\n```tsx\nimport React from 'react';\nimport { Opaque } from 'type-fest';\n\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\n\nfunction createLocalizedString(s: string): LocalizedString {\n    return s as LocalizedString;\n}\n\ninterface ButtonProps {\n  label: LocalizedString;\n}\n\nfunction Button(props: ButtonProps) {\n  return \u003cbutton\u003e{props.label}\u003c/button\u003e;\n}\n\nfunction Example() {\n    return (\n        \u003c\u003e\n            \u003cButton label=\"Test\" /\u003e\n            \u003cButton label={createLocalizedString(\"Test\")} /\u003e\n        \u003c/\u003e\n    );\n}\n```\n\n[Playground example](https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAJQKYEMDG8BmUIjgcilQ3wG4AoUSWOAbzgHkwUBHAVyTgF85tcCYATzBIAtJiQBnGGXLkhIuABkIaFABtgALyQATAMowowAHYBzOAF5GzdkgA8+FWs06DR02fwAaONOPmAHwU5JhsJhjAECZwaEQoMEjOGtp6hgFmABSSAFx+HuYAlHnJrmkFFrTkcDVwRDBsUDGScCgtpanuGRRccqaJUJjonABCbDAw0QAKOGAtVTXqKABGSOolqilu6Z49cmERMFExYxPRmWCzuXCnkyYzEHOFdNV1SA1NcPbL43eBtJdHpIAHRLVbqLj2AD0PzOJmC5F6oXCkWicAAogAPFDgdRITLPBa1eqNGKZV61Wr2QIUyl0+y3NFgtaWABEABUpDBWXAoTS6QKvoyYsz1JZaHFUIkOtsKpkOVzWYUeHzaZTofzaoUekA)\n\n## Localizing Strings\n\nSo far, we‚Äôve been using a utility `createLocalizedString` to create and use the LocalizedString type. This utility is only really practical in unit tests. For real applications, we‚Äôll want to use a translation function from [react-i18next](https://github.com/i18next/react-i18next) or [next-i18next](https://github.com/i18next/next-i18next) to do the heavy lifting. Then we just wrap the translation functions that are provided in order to use our type:\n\n```tsx\nimport React, { useCallback } from 'react';\nimport { Opaque } from 'type-fest';\nimport { useTranslation } from 'react-i18next';\n\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\n\nfunction createLocalizedString(s: string): LocalizedString {\n    return s as LocalizedString;\n}\n\ninterface ButtonProps {\n  label: LocalizedString;\n}\n\nfunction Button(props: ButtonProps) {\n  return \u003cbutton\u003e{props.label}\u003c/button\u003e;\n}\n\nfunction useLocalizedTranslation() {\n    const { t : originalTranslate } = useTranslation();\n\n    const t = useCallback((key: string, defaultString: string) =\u003e {\n        return originalTranslate(key, defaultString) as LocalizedString;\n    }, [originalTranslate]);\n\n    return { t };\n}\n\nfunction Example() {\n    const { t } = useLocalizedTranslation();\n    return (\n        \u003c\u003e\n            \u003cButton label={t(\"test\", \"Test\")} /\u003e\n        \u003c/\u003e\n    );\n}\n```\n\n[Playground example](https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAJQKYEMDGMA0cDecCuAzkgMIoA25ARugNZwC+cAZlBCHAORSoacDcAKFCRYuOAHkwKAI74kjFmw6cYATzBIAtMySEYA4eGjw8RJABUoKAHaFyKGMAg3Frdlx7oYW4AEYADhskAA8DIUF1TTgAGQg0CmAALyQAEwBlGChgGwBzOABeSWk5JAAeTjiE8mS0zOy8zmx9BtyAPgjmfBsMZ1c0LxgkKsSUjKyc3IAKQgAuOBbJgEp5kZqx+sncQThduB4YfChXQjgUU7Xa8dahBkFhGyGoZnQFACF8GBgXAAU2MFOOB2cAcVCQ5FW8VGdQmeVu9y6PScLjgHy+LimYH+c1Rn2+Nj+EABS22uwOR1cZSoeJcbRwWKJhAAdKDwQwygB6anomwdQR3QSI3oo8yXMZWWz2Rx9KYkoF7OBoFz6cTwebQYC5HIUCV2BxDRRFcy6qXImyyiIKpV2eDwI3EMiUGhoWhTKa0JBqeaLPLYVJIF74cgwTZ5b2w3IkgptUkKvbk45wDVamw66x6xxId2ev0BlBBkMRknnWJQ9Ywm7A3YMbAAbWT2vIJv1SAAuktLfGkIdE3h4Ax4YLusLXABREIocDkLNyquK5WmOD9woEYhitLN6UYjtzhOuKZzhVlNqHuO7Mpo-EglBg8gFHAwKYAIiG+if2CfFj0MCfSyYHJPM9zwAucdwYIA)\n\nHere we use `useTranslation` from `react-i18next` and wrap the `t` translation function that is returned to override the type it gives us.\n\nNow when engineers go to use the Button component, they will know they need a LocalizedString, and the most straightforward way to get it will be to use the i18next utilities that we also provide.\n","contentHTML":"\u003cp\u003eWhen building web applications, enforcing that strings be localized to the user‚Äôs preferred language can sometimes be achieved via lint rules. But what if we could enforce proper localization using types in Typescript?\u003c/p\u003e\n\u003ch2\u003eDefining a Localized Type\u003c/h2\u003e\n\u003cp\u003eTypescript doesn‚Äôt natively provide an \u003ca href=\"https://en.wikipedia.org/wiki/Opaque_data_type\"\u003eOpaque type\u003c/a\u003e that we can use to define a string that has already been localized. If the data looks like a string, Typescript will consider it a string. We can however use utility types that simulate opaque types, like the Opaque definition in \u003ca href=\"https://github.com/sindresorhus/type-fest\"\u003etype-fest\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport { Opaque } from \u0026#x27;type-fest\u0026#x27;;\n\ntype LocalizedString = Opaque\u0026lt;\u0026#x27;LocalizedString\u0026#x27;, string\u0026gt;;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAbzgeTAQwI4FcCmcC+cAZlBCHAOQwCeYOAtETgM4wUDcAUJzXXADIQAxmgA2wAF44AJgGUYUYADsA5nAC8KdNhwAeCoJHipchcpUUANHFaLVAPnZA\"\u003ePlayground example\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHere is a short example where we create a localized string and try to use a raw string and our localized string in a function:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport { Opaque } from \u0026#x27;type-fest\u0026#x27;;\n\ntype LocalizedString = Opaque\u0026lt;\u0026#x27;LocalizedString\u0026#x27;, string\u0026gt;;\n\nfunction createLocalizedString(s: string): LocalizedString {\n    return s as LocalizedString;\n}\n\nfunction example(s: LocalizedString) {\n    return s;\n}\n\nconsole.log(example(\u0026#x27;test\u0026#x27;)); // Will throw a type error\nconsole.log(example(createLocalizedString(\u0026#x27;test\u0026#x27;))); // Works correctly\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAbzgeTAQwI4FcCmcC+cAZlBCHAOQwCeYOAtETgM4wUDcAUJzXXADIQAxmgA2wAF44AJgGUYUYADsA5nAC8KdNhwAeCoJHipchcpUUANHFaLVAPi6ciWJUJjAISuEKg40MDiGYpIy8nYqABTMAFw2ZqoAlHHBxmEJagiccDlwfjBYUN7McGglqaGmEVz43C5uHl5wOAAeaOCiONEpwiEm4eaJiNm5+YXFNdxCXswQnQB0ohBRre1gnZFULGyJiVzTSrMLSyttHV2+-oEV-RmbgawUu3tAA\"\u003ePlayground example\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eNow we have a type that we can use in our function and components to denote that we expect an already localized string to be used.\u003c/p\u003e\n\u003ch2\u003eEnforcing in Components\u003c/h2\u003e\n\u003cp\u003eThe simplest way we can enforce that strings have already been localized is by using the type in our component‚Äôs props interface:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e\ninterface ButtonProps {\n  label: LocalizedString;\n}\n\nfunction Button(props: ButtonProps) {\n  return \u0026lt;button\u0026gt;{props.label}\u0026lt;/button\u0026gt;;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow if we try to use that component without a localized string, we get an error:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport React from \u0026#x27;react\u0026#x27;;\nimport { Opaque } from \u0026#x27;type-fest\u0026#x27;;\n\ntype LocalizedString = Opaque\u0026lt;\u0026#x27;LocalizedString\u0026#x27;, string\u0026gt;;\n\nfunction createLocalizedString(s: string): LocalizedString {\n    return s as LocalizedString;\n}\n\ninterface ButtonProps {\n  label: LocalizedString;\n}\n\nfunction Button(props: ButtonProps) {\n  return \u0026lt;button\u0026gt;{props.label}\u0026lt;/button\u0026gt;;\n}\n\nfunction Example() {\n    return (\n        \u0026lt;\u0026gt;\n            \u0026lt;Button label=\u0026quot;Test\u0026quot; /\u0026gt;\n            \u0026lt;Button label={createLocalizedString(\u0026quot;Test\u0026quot;)} /\u0026gt;\n        \u0026lt;/\u0026gt;\n    );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAJQKYEMDG8BmUIjgcilQ3wG4AoUSWOAbzgHkwUBHAVyTgF85tcCYATzBIAtJiQBnGGXLkhIuABkIaFABtgALyQATAMowowAHYBzOAF5GzdkgA8+FWs06DR02fwAaONOPmAHwU5JhsJhjAECZwaEQoMEjOGtp6hgFmABSSAFx+HuYAlHnJrmkFFrTkcDVwRDBsUDGScCgtpanuGRRccqaJUJjonABCbDAw0QAKOGAtVTXqKABGSOolqilu6Z49cmERMFExYxPRmWCzuXCnkyYzEHOFdNV1SA1NcPbL43eBtJdHpIAHRLVbqLj2AD0PzOJmC5F6oXCkWicAAogAPFDgdRITLPBa1eqNGKZV61Wr2QIUyl0+y3NFgtaWABEABUpDBWXAoTS6QKvoyYsz1JZaHFUIkOtsKpkOVzWYUeHzaZTofzaoUekA\"\u003ePlayground example\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eLocalizing Strings\u003c/h2\u003e\n\u003cp\u003eSo far, we‚Äôve been using a utility \u003ccode\u003ecreateLocalizedString\u003c/code\u003e to create and use the LocalizedString type. This utility is only really practical in unit tests. For real applications, we‚Äôll want to use a translation function from \u003ca href=\"https://github.com/i18next/react-i18next\"\u003ereact-i18next\u003c/a\u003e or \u003ca href=\"https://github.com/i18next/next-i18next\"\u003enext-i18next\u003c/a\u003e to do the heavy lifting. Then we just wrap the translation functions that are provided in order to use our type:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport React, { useCallback } from \u0026#x27;react\u0026#x27;;\nimport { Opaque } from \u0026#x27;type-fest\u0026#x27;;\nimport { useTranslation } from \u0026#x27;react-i18next\u0026#x27;;\n\ntype LocalizedString = Opaque\u0026lt;\u0026#x27;LocalizedString\u0026#x27;, string\u0026gt;;\n\nfunction createLocalizedString(s: string): LocalizedString {\n    return s as LocalizedString;\n}\n\ninterface ButtonProps {\n  label: LocalizedString;\n}\n\nfunction Button(props: ButtonProps) {\n  return \u0026lt;button\u0026gt;{props.label}\u0026lt;/button\u0026gt;;\n}\n\nfunction useLocalizedTranslation() {\n    const { t : originalTranslate } = useTranslation();\n\n    const t = useCallback((key: string, defaultString: string) =\u0026gt; {\n        return originalTranslate(key, defaultString) as LocalizedString;\n    }, [originalTranslate]);\n\n    return { t };\n}\n\nfunction Example() {\n    const { t } = useLocalizedTranslation();\n    return (\n        \u0026lt;\u0026gt;\n            \u0026lt;Button label={t(\u0026quot;test\u0026quot;, \u0026quot;Test\u0026quot;)} /\u0026gt;\n        \u0026lt;/\u0026gt;\n    );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAJQKYEMDGMA0cDecCuAzkgMIoA25ARugNZwC+cAZlBCHAORSoacDcAKFCRYuOAHkwKAI74kjFmw6cYATzBIAtMySEYA4eGjw8RJABUoKAHaFyKGMAg3Frdlx7oYW4AEYADhskAA8DIUF1TTgAGQg0CmAALyQAEwBlGChgGwBzOABeSWk5JAAeTjiE8mS0zOy8zmx9BtyAPgjmfBsMZ1c0LxgkKsSUjKyc3IAKQgAuOBbJgEp5kZqx+sncQThduB4YfChXQjgUU7Xa8dahBkFhGyGoZnQFACF8GBgXAAU2MFOOB2cAcVCQ5FW8VGdQmeVu9y6PScLjgHy+LimYH+c1Rn2+Nj+EABS22uwOR1cZSoeJcbRwWKJhAAdKDwQwygB6anomwdQR3QSI3oo8yXMZWWz2Rx9KYkoF7OBoFz6cTwebQYC5HIUCV2BxDRRFcy6qXImyyiIKpV2eDwI3EMiUGhoWhTKa0JBqeaLPLYVJIF74cgwTZ5b2w3IkgptUkKvbk45wDVamw66x6xxId2ev0BlBBkMRknnWJQ9Ywm7A3YMbAAbWT2vIJv1SAAuktLfGkIdE3h4Ax4YLusLXABREIocDkLNyquK5WmOD9woEYhitLN6UYjtzhOuKZzhVlNqHuO7Mpo-EglBg8gFHAwKYAIiG+if2CfFj0MCfSyYHJPM9zwAucdwYIA\"\u003ePlayground example\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHere we use \u003ccode\u003euseTranslation\u003c/code\u003e from \u003ccode\u003ereact-i18next\u003c/code\u003e and wrap the \u003ccode\u003et\u003c/code\u003e translation function that is returned to override the type it gives us.\u003c/p\u003e\n\u003cp\u003eNow when engineers go to use the Button component, they will know they need a LocalizedString, and the most straightforward way to get it will be to use the i18next utilities that we also provide.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    a: \"a\",\n    pre: \"pre\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"When building web applications, enforcing that strings be localized to the user‚Äôs preferred language can sometimes be achieved via lint rules. But what if we could enforce proper localization using types in Typescript?\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Defining a Localized Type\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Typescript doesn‚Äôt natively provide an \", _jsx(_components.a, {\n        href: \"https://en.wikipedia.org/wiki/Opaque_data_type\",\n        children: \"Opaque type\"\n      }), \" that we can use to define a string that has already been localized. If the data looks like a string, Typescript will consider it a string. We can however use utility types that simulate opaque types, like the Opaque definition in \", _jsx(_components.a, {\n        href: \"https://github.com/sindresorhus/type-fest\",\n        children: \"type-fest\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import { Opaque } from 'type-fest';\\n\\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAbzgeTAQwI4FcCmcC+cAZlBCHAOQwCeYOAtETgM4wUDcAUJzXXADIQAxmgA2wAF44AJgGUYUYADsA5nAC8KdNhwAeCoJHipchcpUUANHFaLVAPnZA\",\n        children: \"Playground example\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here is a short example where we create a localized string and try to use a raw string and our localized string in a function:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import { Opaque } from 'type-fest';\\n\\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\\n\\nfunction createLocalizedString(s: string): LocalizedString {\\n    return s as LocalizedString;\\n}\\n\\nfunction example(s: LocalizedString) {\\n    return s;\\n}\\n\\nconsole.log(example('test')); // Will throw a type error\\nconsole.log(example(createLocalizedString('test'))); // Works correctly\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAbzgeTAQwI4FcCmcC+cAZlBCHAOQwCeYOAtETgM4wUDcAUJzXXADIQAxmgA2wAF44AJgGUYUYADsA5nAC8KdNhwAeCoJHipchcpUUANHFaLVAPi6ciWJUJjAISuEKg40MDiGYpIy8nYqABTMAFw2ZqoAlHHBxmEJagiccDlwfjBYUN7McGglqaGmEVz43C5uHl5wOAAeaOCiONEpwiEm4eaJiNm5+YXFNdxCXswQnQB0ohBRre1gnZFULGyJiVzTSrMLSyttHV2+-oEV-RmbgawUu3tAA\",\n        children: \"Playground example\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now we have a type that we can use in our function and components to denote that we expect an already localized string to be used.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Enforcing in Components\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The simplest way we can enforce that strings have already been localized is by using the type in our component‚Äôs props interface:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"\\ninterface ButtonProps {\\n  label: LocalizedString;\\n}\\n\\nfunction Button(props: ButtonProps) {\\n  return \u003cbutton\u003e{props.label}\u003c/button\u003e;\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now if we try to use that component without a localized string, we get an error:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import React from 'react';\\nimport { Opaque } from 'type-fest';\\n\\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\\n\\nfunction createLocalizedString(s: string): LocalizedString {\\n    return s as LocalizedString;\\n}\\n\\ninterface ButtonProps {\\n  label: LocalizedString;\\n}\\n\\nfunction Button(props: ButtonProps) {\\n  return \u003cbutton\u003e{props.label}\u003c/button\u003e;\\n}\\n\\nfunction Example() {\\n    return (\\n        \u003c\u003e\\n            \u003cButton label=\\\"Test\\\" /\u003e\\n            \u003cButton label={createLocalizedString(\\\"Test\\\")} /\u003e\\n        \u003c/\u003e\\n    );\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAJQKYEMDG8BmUIjgcilQ3wG4AoUSWOAbzgHkwUBHAVyTgF85tcCYATzBIAtJiQBnGGXLkhIuABkIaFABtgALyQATAMowowAHYBzOAF5GzdkgA8+FWs06DR02fwAaONOPmAHwU5JhsJhjAECZwaEQoMEjOGtp6hgFmABSSAFx+HuYAlHnJrmkFFrTkcDVwRDBsUDGScCgtpanuGRRccqaJUJjonABCbDAw0QAKOGAtVTXqKABGSOolqilu6Z49cmERMFExYxPRmWCzuXCnkyYzEHOFdNV1SA1NcPbL43eBtJdHpIAHRLVbqLj2AD0PzOJmC5F6oXCkWicAAogAPFDgdRITLPBa1eqNGKZV61Wr2QIUyl0+y3NFgtaWABEABUpDBWXAoTS6QKvoyYsz1JZaHFUIkOtsKpkOVzWYUeHzaZTofzaoUekA\",\n        children: \"Playground example\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Localizing Strings\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"So far, we‚Äôve been using a utility \", _jsx(_components.code, {\n        children: \"createLocalizedString\"\n      }), \" to create and use the LocalizedString type. This utility is only really practical in unit tests. For real applications, we‚Äôll want to use a translation function from \", _jsx(_components.a, {\n        href: \"https://github.com/i18next/react-i18next\",\n        children: \"react-i18next\"\n      }), \" or \", _jsx(_components.a, {\n        href: \"https://github.com/i18next/next-i18next\",\n        children: \"next-i18next\"\n      }), \" to do the heavy lifting. Then we just wrap the translation functions that are provided in order to use our type:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import React, { useCallback } from 'react';\\nimport { Opaque } from 'type-fest';\\nimport { useTranslation } from 'react-i18next';\\n\\ntype LocalizedString = Opaque\u003c'LocalizedString', string\u003e;\\n\\nfunction createLocalizedString(s: string): LocalizedString {\\n    return s as LocalizedString;\\n}\\n\\ninterface ButtonProps {\\n  label: LocalizedString;\\n}\\n\\nfunction Button(props: ButtonProps) {\\n  return \u003cbutton\u003e{props.label}\u003c/button\u003e;\\n}\\n\\nfunction useLocalizedTranslation() {\\n    const { t : originalTranslate } = useTranslation();\\n\\n    const t = useCallback((key: string, defaultString: string) =\u003e {\\n        return originalTranslate(key, defaultString) as LocalizedString;\\n    }, [originalTranslate]);\\n\\n    return { t };\\n}\\n\\nfunction Example() {\\n    const { t } = useLocalizedTranslation();\\n    return (\\n        \u003c\u003e\\n            \u003cButton label={t(\\\"test\\\", \\\"Test\\\")} /\u003e\\n        \u003c/\u003e\\n    );\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAJQKYEMDGMA0cDecCuAzkgMIoA25ARugNZwC+cAZlBCHAORSoacDcAKFCRYuOAHkwKAI74kjFmw6cYATzBIAtMySEYA4eGjw8RJABUoKAHaFyKGMAg3Frdlx7oYW4AEYADhskAA8DIUF1TTgAGQg0CmAALyQAEwBlGChgGwBzOABeSWk5JAAeTjiE8mS0zOy8zmx9BtyAPgjmfBsMZ1c0LxgkKsSUjKyc3IAKQgAuOBbJgEp5kZqx+sncQThduB4YfChXQjgUU7Xa8dahBkFhGyGoZnQFACF8GBgXAAU2MFOOB2cAcVCQ5FW8VGdQmeVu9y6PScLjgHy+LimYH+c1Rn2+Nj+EABS22uwOR1cZSoeJcbRwWKJhAAdKDwQwygB6anomwdQR3QSI3oo8yXMZWWz2Rx9KYkoF7OBoFz6cTwebQYC5HIUCV2BxDRRFcy6qXImyyiIKpV2eDwI3EMiUGhoWhTKa0JBqeaLPLYVJIF74cgwTZ5b2w3IkgptUkKvbk45wDVamw66x6xxId2ev0BlBBkMRknnWJQ9Ywm7A3YMbAAbWT2vIJv1SAAuktLfGkIdE3h4Ax4YLusLXABREIocDkLNyquK5WmOD9woEYhitLN6UYjtzhOuKZzhVlNqHuO7Mpo-EglBg8gFHAwKYAIiG+if2CfFj0MCfSyYHJPM9zwAucdwYIA\",\n        children: \"Playground example\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here we use \", _jsx(_components.code, {\n        children: \"useTranslation\"\n      }), \" from \", _jsx(_components.code, {\n        children: \"react-i18next\"\n      }), \" and wrap the \", _jsx(_components.code, {\n        children: \"t\"\n      }), \" translation function that is returned to override the type it gives us.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now when engineers go to use the Button component, they will know they need a LocalizedString, and the most straightforward way to get it will be to use the i18next utilities that we also provide.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nWhen building web applications, enforcing that strings be localized to the user‚Äôs preferred language can sometimes be achieved via lint rules. But what if we could enforce proper localization using types in Typescript?","excerptHTML":"\u003cp\u003eWhen building web applications, enforcing that strings be localized to the user‚Äôs preferred language can sometimes be achieved via lint rules. But what if we could enforce proper localization using types in Typescript?\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"When building web applications, enforcing that strings be localized to the user‚Äôs preferred language can sometimes be achieved via lint rules. But what if we could enforce proper localization using types in Typescript?\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript","react"]},{"slug":"2023-08-17-feature-context","date":"2023-08-17","title":"Feature Contexts","frontmatter":{"title":"Feature Contexts","tags":["typescript","react"]},"contentRaw":"\nA common pattern in larger application when trying to track feature usage is to try to namespace events. For example, you might have a button that you want to track clicks on. For the sake of this article, we will use the `data-track` attribute on elements to track their usage, but you can imagine this works with any tracking implementation where you may need to explicitly call a tracking function (e.g. `track(namespace)`).\n\n## Simple Example\n\nAs requests to start tracking user events come up, typically the easiest way is to just hard code the tracking namespaces:\n\n```tsx\n\u003cbutton data-track=\"chat.form.send\"\u003eSend\u003cbutton\u003e\n```\n\nAnd as the tracking grows, these might get moved to a separate file and a constant/enumeration:\n\n```tsx\nconst ChatTracking = {\n  send: 'chat.form.send',\n  attachMedia: 'chat.form.attachMedia',\n  edit: 'chat.messages.edit',\n  delete: 'chat.messages.delete',\n} as const;\n\n// usage\n\n\u003cbutton data-track={ChatTracking.send}\u003eSend\u003c/button\u003e\n```\n\nWe have a lot of string duplication here. We might be tempted to use template strings or some other way of creating the string, but it doesn‚Äôt end up reducing any of the duplication.\n\n## Passing Namespaces\n\nAs the application grows more complex, an engineer working on another set of features ends up wanting to re-use the chat form from above. It already has some additional animation and composes together the component library widgets, why not re-use it in the context of forums.\n\nExcept now the `data-track` attribute has to be passed in as a prop:\n\n```mermaid\ngraph TD\n  Forums --\u003e ChatForm\n  Chat --\u003e ChatForm\n  ChatForm --\u003e SendButton\n  SendButton --\u003e Button\n\n```\n\nThe Forums usage ends up adding its own tracking attribute, but ends up having to prop-drill down the namespace from the Forums components, through the ChatForm, to the SendButton component.\n\n## Using Context\n\nInstead, what if we wrap our features in some Context component that helps us track where our components are being used. Then we can just build up the tracking namespace based on where the component is in the feature tree, rather than having to keep track of long namespace strings.\n\nFirst let‚Äôs build a context in React:\n\n**FeatureContext.tsx**\n\n```tsx\nimport { createContext } from 'react';\n\n/**\n * Context for tracking features\n */\nexport const FeatureContext = createContext\u003cstring[]\u003e([]);\n```\n\nThen we‚Äôll create a helper component that we can use throughout the application:\n\n**Feature.tsx**\n\n```tsx\nimport type { ReactNode } from 'react';\nimport { useContext, useMemo } from 'react';\nimport { FeatureContext } from './FeatureContext';\n\nexport interface FeatureProps {\n    readonly name: string;\n    readonly children: ReactNode;\n    readonly topLevel?: boolean;\n}\n\nexport function Feature({\n    name,\n    children,\n    topLevel,\n}: FeatureProps): JSX.Element {\n    const parentContext = useContext(FeatureContext);\n\n    const currentContext = useMemo(() =\u003e {\n        if (topLevel === true) {\n            return [name];\n        }\n        return [...parentContext, name];\n    }, [parentContext, name, topLevel]);\n\n    return (\n        \u003cFeatureContext.Provider value={currentContext}\u003e\n            {children}\n        \u003c/FeatureContext.Provider\u003e\n    );\n}\n```\n\nUsage of this component would look like:\n\n```tsx\nfunction Forums() {\n  return (\n    \u003cFeature name=\"forums\"\u003e\n      \u003cChatForm /\u003e\n    \u003c/Feature\u003e\n  );\n}\n\nfunction Chat() {\n  return (\n    \u003cFeature name=\"chat\"\u003e\n      \u003cChatForm /\u003e\n    \u003c/Feature\u003e\n  );\n}\n\nfunction ChatForm() {\n  return (\n    \u003cFeature name=\"form\"\u003e\n      \u003cSendButton /\u003e\n    \u003c/Feature\u003e\n  );\n}\n\n```\n\nThen, in SendButton, when we actually need to use the feature context, we construct the namespace:\n\n**SendButton.tsx**\n\n```tsx\nfunction SendButton() {\n  const featureContext = useContext(FeatureContext);\n\n  return (\n    \u003cbutton data-track={[...featureContext, 'send'].join('.')}\u003eSend\u003c/button\u003e\n  );\n}\n```\n\nNote: the above example has been simplified for this article‚Äôs sake. Typically some utility for reading the context, joining the namespaces, and memoizing the value would be provided.\n\nNo additional props are needed, and the Feature components can be used throughout the application as a standard mechanism for building up feature namespaces.\n\n## Conclusion\n\nRather than trying to alleviate string duplication and prop-drilling as separate problems, we can leverage React Context to solve both problems at the same time and leverage context to determine where we are in a feature tree. Not only does the Feature context help with constructing the data-track attributes, but it now provides a consistent mechanism that we can use throughout the application to let components know the feature namespace they are currently in without the parent components prop-drilling the namespace down to every component.\n","contentHTML":"\u003cp\u003eA common pattern in larger application when trying to track feature usage is to try to namespace events. For example, you might have a button that you want to track clicks on. For the sake of this article, we will use the \u003ccode\u003edata-track\u003c/code\u003e attribute on elements to track their usage, but you can imagine this works with any tracking implementation where you may need to explicitly call a tracking function (e.g. \u003ccode\u003etrack(namespace)\u003c/code\u003e).\u003c/p\u003e\n\u003ch2\u003eSimple Example\u003c/h2\u003e\n\u003cp\u003eAs requests to start tracking user events come up, typically the easiest way is to just hard code the tracking namespaces:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e\u0026lt;button data-track=\u0026quot;chat.form.send\u0026quot;\u0026gt;Send\u0026lt;button\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd as the tracking grows, these might get moved to a separate file and a constant/enumeration:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econst ChatTracking = {\n  send: \u0026#x27;chat.form.send\u0026#x27;,\n  attachMedia: \u0026#x27;chat.form.attachMedia\u0026#x27;,\n  edit: \u0026#x27;chat.messages.edit\u0026#x27;,\n  delete: \u0026#x27;chat.messages.delete\u0026#x27;,\n} as const;\n\n// usage\n\n\u0026lt;button data-track={ChatTracking.send}\u0026gt;Send\u0026lt;/button\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe have a lot of string duplication here. We might be tempted to use template strings or some other way of creating the string, but it doesn‚Äôt end up reducing any of the duplication.\u003c/p\u003e\n\u003ch2\u003ePassing Namespaces\u003c/h2\u003e\n\u003cp\u003eAs the application grows more complex, an engineer working on another set of features ends up wanting to re-use the chat form from above. It already has some additional animation and composes together the component library widgets, why not re-use it in the context of forums.\u003c/p\u003e\n\u003cp\u003eExcept now the \u003ccode\u003edata-track\u003c/code\u003e attribute has to be passed in as a prop:\u003c/p\u003e\n\u003cdiv class=\"py-8 [\u0026amp;_svg]:m-auto\"\u003e\u003cdiv class=\"mermaid\" data-mermaid-src=\"graph TD\n  Forums --\u0026gt; ChatForm\n  Chat --\u0026gt; ChatForm\n  ChatForm --\u0026gt; SendButton\n  SendButton --\u0026gt; Button\n\"\u003egraph TD\n  Forums --\u0026gt; ChatForm\n  Chat --\u0026gt; ChatForm\n  ChatForm --\u0026gt; SendButton\n  SendButton --\u0026gt; Button\n\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eThe Forums usage ends up adding its own tracking attribute, but ends up having to prop-drill down the namespace from the Forums components, through the ChatForm, to the SendButton component.\u003c/p\u003e\n\u003ch2\u003eUsing Context\u003c/h2\u003e\n\u003cp\u003eInstead, what if we wrap our features in some Context component that helps us track where our components are being used. Then we can just build up the tracking namespace based on where the component is in the feature tree, rather than having to keep track of long namespace strings.\u003c/p\u003e\n\u003cp\u003eFirst let‚Äôs build a context in React:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eFeatureContext.tsx\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport { createContext } from \u0026#x27;react\u0026#x27;;\n\n/**\n * Context for tracking features\n */\nexport const FeatureContext = createContext\u0026lt;string[]\u0026gt;([]);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen we‚Äôll create a helper component that we can use throughout the application:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eFeature.tsx\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport type { ReactNode } from \u0026#x27;react\u0026#x27;;\nimport { useContext, useMemo } from \u0026#x27;react\u0026#x27;;\nimport { FeatureContext } from \u0026#x27;./FeatureContext\u0026#x27;;\n\nexport interface FeatureProps {\n    readonly name: string;\n    readonly children: ReactNode;\n    readonly topLevel?: boolean;\n}\n\nexport function Feature({\n    name,\n    children,\n    topLevel,\n}: FeatureProps): JSX.Element {\n    const parentContext = useContext(FeatureContext);\n\n    const currentContext = useMemo(() =\u0026gt; {\n        if (topLevel === true) {\n            return [name];\n        }\n        return [...parentContext, name];\n    }, [parentContext, name, topLevel]);\n\n    return (\n        \u0026lt;FeatureContext.Provider value={currentContext}\u0026gt;\n            {children}\n        \u0026lt;/FeatureContext.Provider\u0026gt;\n    );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eUsage of this component would look like:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003efunction Forums() {\n  return (\n    \u0026lt;Feature name=\u0026quot;forums\u0026quot;\u0026gt;\n      \u0026lt;ChatForm /\u0026gt;\n    \u0026lt;/Feature\u0026gt;\n  );\n}\n\nfunction Chat() {\n  return (\n    \u0026lt;Feature name=\u0026quot;chat\u0026quot;\u0026gt;\n      \u0026lt;ChatForm /\u0026gt;\n    \u0026lt;/Feature\u0026gt;\n  );\n}\n\nfunction ChatForm() {\n  return (\n    \u0026lt;Feature name=\u0026quot;form\u0026quot;\u0026gt;\n      \u0026lt;SendButton /\u0026gt;\n    \u0026lt;/Feature\u0026gt;\n  );\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen, in SendButton, when we actually need to use the feature context, we construct the namespace:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSendButton.tsx\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003efunction SendButton() {\n  const featureContext = useContext(FeatureContext);\n\n  return (\n    \u0026lt;button data-track={[...featureContext, \u0026#x27;send\u0026#x27;].join(\u0026#x27;.\u0026#x27;)}\u0026gt;Send\u0026lt;/button\u0026gt;\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNote: the above example has been simplified for this article‚Äôs sake. Typically some utility for reading the context, joining the namespaces, and memoizing the value would be provided.\u003c/p\u003e\n\u003cp\u003eNo additional props are needed, and the Feature components can be used throughout the application as a standard mechanism for building up feature namespaces.\u003c/p\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eRather than trying to alleviate string duplication and prop-drilling as separate problems, we can leverage React Context to solve both problems at the same time and leverage context to determine where we are in a feature tree. Not only does the Feature context help with constructing the data-track attributes, but it now provides a consistent mechanism that we can use throughout the application to let components know the feature namespace they are currently in without the parent components prop-drilling the namespace down to every component.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    h2: \"h2\",\n    pre: \"pre\",\n    strong: \"strong\"\n  }, props.components), {Mermaid} = _components;\n  if (!Mermaid) _missingMdxReference(\"Mermaid\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"A common pattern in larger application when trying to track feature usage is to try to namespace events. For example, you might have a button that you want to track clicks on. For the sake of this article, we will use the \", _jsx(_components.code, {\n        children: \"data-track\"\n      }), \" attribute on elements to track their usage, but you can imagine this works with any tracking implementation where you may need to explicitly call a tracking function (e.g. \", _jsx(_components.code, {\n        children: \"track(namespace)\"\n      }), \").\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Simple Example\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As requests to start tracking user events come up, typically the easiest way is to just hard code the tracking namespaces:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"\u003cbutton data-track=\\\"chat.form.send\\\"\u003eSend\u003cbutton\u003e\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"And as the tracking grows, these might get moved to a separate file and a constant/enumeration:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"const ChatTracking = {\\n  send: 'chat.form.send',\\n  attachMedia: 'chat.form.attachMedia',\\n  edit: 'chat.messages.edit',\\n  delete: 'chat.messages.delete',\\n} as const;\\n\\n// usage\\n\\n\u003cbutton data-track={ChatTracking.send}\u003eSend\u003c/button\u003e\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We have a lot of string duplication here. We might be tempted to use template strings or some other way of creating the string, but it doesn‚Äôt end up reducing any of the duplication.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Passing Namespaces\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As the application grows more complex, an engineer working on another set of features ends up wanting to re-use the chat form from above. It already has some additional animation and composes together the component library widgets, why not re-use it in the context of forums.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Except now the \", _jsx(_components.code, {\n        children: \"data-track\"\n      }), \" attribute has to be passed in as a prop:\"]\n    }), \"\\n\", _jsx(Mermaid, {\n      chart: \"graph TD\\n  Forums --\u003e ChatForm\\n  Chat --\u003e ChatForm\\n  ChatForm --\u003e SendButton\\n  SendButton --\u003e Button\\n\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The Forums usage ends up adding its own tracking attribute, but ends up having to prop-drill down the namespace from the Forums components, through the ChatForm, to the SendButton component.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Using Context\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Instead, what if we wrap our features in some Context component that helps us track where our components are being used. Then we can just build up the tracking namespace based on where the component is in the feature tree, rather than having to keep track of long namespace strings.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"First let‚Äôs build a context in React:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"FeatureContext.tsx\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import { createContext } from 'react';\\n\\n/**\\n * Context for tracking features\\n */\\nexport const FeatureContext = createContext\u003cstring[]\u003e([]);\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Then we‚Äôll create a helper component that we can use throughout the application:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Feature.tsx\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"import type { ReactNode } from 'react';\\nimport { useContext, useMemo } from 'react';\\nimport { FeatureContext } from './FeatureContext';\\n\\nexport interface FeatureProps {\\n    readonly name: string;\\n    readonly children: ReactNode;\\n    readonly topLevel?: boolean;\\n}\\n\\nexport function Feature({\\n    name,\\n    children,\\n    topLevel,\\n}: FeatureProps): JSX.Element {\\n    const parentContext = useContext(FeatureContext);\\n\\n    const currentContext = useMemo(() =\u003e {\\n        if (topLevel === true) {\\n            return [name];\\n        }\\n        return [...parentContext, name];\\n    }, [parentContext, name, topLevel]);\\n\\n    return (\\n        \u003cFeatureContext.Provider value={currentContext}\u003e\\n            {children}\\n        \u003c/FeatureContext.Provider\u003e\\n    );\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Usage of this component would look like:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function Forums() {\\n  return (\\n    \u003cFeature name=\\\"forums\\\"\u003e\\n      \u003cChatForm /\u003e\\n    \u003c/Feature\u003e\\n  );\\n}\\n\\nfunction Chat() {\\n  return (\\n    \u003cFeature name=\\\"chat\\\"\u003e\\n      \u003cChatForm /\u003e\\n    \u003c/Feature\u003e\\n  );\\n}\\n\\nfunction ChatForm() {\\n  return (\\n    \u003cFeature name=\\\"form\\\"\u003e\\n      \u003cSendButton /\u003e\\n    \u003c/Feature\u003e\\n  );\\n}\\n\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Then, in SendButton, when we actually need to use the feature context, we construct the namespace:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"SendButton.tsx\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function SendButton() {\\n  const featureContext = useContext(FeatureContext);\\n\\n  return (\\n    \u003cbutton data-track={[...featureContext, 'send'].join('.')}\u003eSend\u003c/button\u003e\\n  );\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Note: the above example has been simplified for this article‚Äôs sake. Typically some utility for reading the context, joining the namespaces, and memoizing the value would be provided.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"No additional props are needed, and the Feature components can be used throughout the application as a standard mechanism for building up feature namespaces.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Conclusion\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Rather than trying to alleviate string duplication and prop-drilling as separate problems, we can leverage React Context to solve both problems at the same time and leverage context to determine where we are in a feature tree. Not only does the Feature context help with constructing the data-track attributes, but it now provides a consistent mechanism that we can use throughout the application to let components know the feature namespace they are currently in without the parent components prop-drilling the namespace down to every component.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","excerptRaw":"\nA common pattern in larger application when trying to track feature usage is to try to namespace events. For example, you might have a button that you want to track clicks on. For the sake of this article, we will use the `data-track` attribute on elements to track their usage, but you can imagine this works with any tracking implementation where you may need to explicitly call a tracking function (e.g. `track(namespace)`).","excerptHTML":"\u003cp\u003eA common pattern in larger application when trying to track feature usage is to try to namespace events. For example, you might have a button that you want to track clicks on. For the sake of this article, we will use the \u003ccode\u003edata-track\u003c/code\u003e attribute on elements to track their usage, but you can imagine this works with any tracking implementation where you may need to explicitly call a tracking function (e.g. \u003ccode\u003etrack(namespace)\u003c/code\u003e).\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"A common pattern in larger application when trying to track feature usage is to try to namespace events. For example, you might have a button that you want to track clicks on. For the sake of this article, we will use the \", _jsx(_components.code, {\n      children: \"data-track\"\n    }), \" attribute on elements to track their usage, but you can imagine this works with any tracking implementation where you may need to explicitly call a tracking function (e.g. \", _jsx(_components.code, {\n      children: \"track(namespace)\"\n    }), \").\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript","react"]},{"slug":"2023-08-14-partial-objects","date":"2023-08-14","title":"Forbidden Typescript: full/partial objects","frontmatter":{"title":"Forbidden Typescript: full/partial objects","tags":["typescript"]},"contentRaw":"\nWhen trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn‚Äôt know that the object is complete:\n\n```tsx\n/**\n * An example interface to demonstrate\n */\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial\u003cKnownCodes\u003e = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key in ['code1', 'code2', 'code3']) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes as KnownCodes;\n}\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n```\n\nIn the above example, we know that `knownCodes` will have all the keys will have values for the interface `KnownCodes`. However, Typescript can‚Äôt infer that, so we have to cast the value.\n\nAs the function gets more complex with additional feature work, this can become brittle and lead to some type-holes where we may have accidentally forgotten to set a key.\n\nOne way to get around this is to use an assert:\n\n```tsx\ntype RequireAll\u003cT\u003e = {\n  [K in keyof T]-?: T[K];\n};\n\nfunction ensureAllRequired\u003cT\u003e(obj: Partial\u003cT\u003e, template: RequireAll\u003cT\u003e): asserts obj is T {\n  for (const key in template) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial\u003cKnownCodes\u003e = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of ['code1', 'code2']) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  ensureAllRequired(knownCodes, TEMPALTE_CODES);\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n```\n\n[Playground link](https://www.typescriptlang.org/play?#code/C4TwDgpgBAShCOBXAlgJwgQQDZYDwBUA+KAXigG8AoKKAbQGkpkA7KAawhAHsAzKfALoBaAPwAufgwEBuSgF9ZlHomYBjYMi6sIzAM6J02LHCRoIAEwKEAFFwBGAKwkAFAIaoNrvEQA0UYBAAtmBYrgESJiiGOFYAlBKuuroQHrpQ9g5MafgU1FA8XKhQ1qpausDsnEysAcGhAbG5NDTIfLaOtBwgAqQkZCrmEDwsFo1Uzc3AABaoXADuUMwQCwCiqLOo1gAGALLISSwA5lDopujmUGCzkB4gEgAk5F1y1VCPAFIAygDyAHIAdOVUEdWiB2g5YnItrFZBM5Hl4fDKCwAqgeK5VNB6Mx5swAMJcQZpcZQUqDACMEmYiECdhSsNJhIgACYqTS6ahZABIMkQADMbNp9PklEopT0FXwKx2zgwABkpQB9PHfAAiK0+EmxuIJRNITUZFIkQnJPjyvNZUBNZpovIFVtNIqUKnUmlYqnQYQgADUvIgILoAGKFbVzfFM3TWeJQUPhvUk8Xldg4sO6gMudyePCxtO6YhkcgKUU0AD0JagAElWK4ThAvFAIAAPVx1CB+aYB6BdNKBVwgRmBaA8WaBKC6LiD9IdooZCDqPJl9JFJuo5j18xhVx5ApFEplCpddJ8WgAcl55JPfjPTOZJ4EYzyzTYKbjAc6VUSlW4fBzEZ6ZHMEA10CZBVF9LB-WsLoYQRYsGz0AxMBwSIzHMKCX1zPwpRleUlRVdVPhgvJ0GAAxWGfHUI1kJEPTrAJwP9IMQwwiMo0URdPlIux8kKfwpmgJsWxCCBnTUDQtCgQDgNAhiICgzgJCBI4xlrUjUFYAAGKAiyAA)\n\nThe above code does a **************runtime************** check that the object has all the keys that are defined in the template. This ensure that any missing keys are caught as well.\n\nI have seen other examples online where only the object is passed in, but this ends up not working if the keys are not defined in the object:\n\n```tsx\n\nfunction ensureAllRequired\u003cT\u003e(obj: Partial\u003cT\u003e): asserts obj is T {\n  for (const key in obj) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\n```\n\nThe above will let any empty object partial to pass the assert.\n\n## Takeaway\n\nThis ends up being a lot of work to do a runtime check to improve our typings, which I‚Äôm not sure is the best approach. Most of the time when we construct objects from an empty object, it‚Äôs difficult to ensure that the full object has been safely created.\n\nSince we have to create a template object anyway, it is almost always simpler to do the following:\n\n```tsx\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes = { ...TEMPALTE_CODES };\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of ['code1', 'code2', 'code3']) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n```\n\n[Playground link](https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgNIgPYHcQGEMAmEAzsgN4BQyyChEAjAFzIgCuAtgEbQDcVNdAEzM2XXv1pEAzCI7cofAL4UKtEMTDIAKgFEAsgAUAggBldAfVwB5ACI6Ays3TY8dUgF5yEuk2QBaegAabyJhfyCQiBlw4OUKGFYQBDBgDBAaKAg4SAA1OAAbVhIAMQwoZxx8ImIACgBKJ0xKty9qNQ1kAGsm12rkTzJkADoR3UNTC2s7e2RFPn4AegXkAEl0uGRMguQIAA84dgAHfIhA5DAACxIUTogAT1J2ODuBdhQYKAx2ZGIvlAxLtBkBhOAArCDJRbLMo7XaQKAgbYEbJwfgwGE1dqaW4vDAwZAAbQA5JIGESziShOTkJTpESALp1VrUajdFxVEgEnHIOCkHF4tA9DnEen9ZAEO6I9jABB5QoQGo4up8ahxaiZMCsBFdIVuJQqBBbXIFIrEUrlXXVerzJbIeyazjIdFQc5XWEHY4QeKJZKpdISqUyuVFRX3ZgaKCgADmTMGGq16QADLM+EA)\n\nHere we take the easy way out and clone the template and then built the object from there. Even if we forget to add a key (like `code3`) to our list of keys or its missing from our external data that we are using, we will be guaranteed that the return value is the correct shape and types.\n","contentHTML":"\u003cp\u003eWhen trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn‚Äôt know that the object is complete:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e/**\n * An example interface to demonstrate\n */\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial\u0026lt;KnownCodes\u0026gt; = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key in [\u0026#x27;code1\u0026#x27;, \u0026#x27;code2\u0026#x27;, \u0026#x27;code3\u0026#x27;]) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes as KnownCodes;\n}\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn the above example, we know that \u003ccode\u003eknownCodes\u003c/code\u003e will have all the keys will have values for the interface \u003ccode\u003eKnownCodes\u003c/code\u003e. However, Typescript can‚Äôt infer that, so we have to cast the value.\u003c/p\u003e\n\u003cp\u003eAs the function gets more complex with additional feature work, this can become brittle and lead to some type-holes where we may have accidentally forgotten to set a key.\u003c/p\u003e\n\u003cp\u003eOne way to get around this is to use an assert:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003etype RequireAll\u0026lt;T\u0026gt; = {\n  [K in keyof T]-?: T[K];\n};\n\nfunction ensureAllRequired\u0026lt;T\u0026gt;(obj: Partial\u0026lt;T\u0026gt;, template: RequireAll\u0026lt;T\u0026gt;): asserts obj is T {\n  for (const key in template) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\ninterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes: Partial\u0026lt;KnownCodes\u0026gt; = {};\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of [\u0026#x27;code1\u0026#x27;, \u0026#x27;code2\u0026#x27;]) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  ensureAllRequired(knownCodes, TEMPALTE_CODES);\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/C4TwDgpgBAShCOBXAlgJwgQQDZYDwBUA+KAXigG8AoKKAbQGkpkA7KAawhAHsAzKfALoBaAPwAufgwEBuSgF9ZlHomYBjYMi6sIzAM6J02LHCRoIAEwKEAFFwBGAKwkAFAIaoNrvEQA0UYBAAtmBYrgESJiiGOFYAlBKuuroQHrpQ9g5MafgU1FA8XKhQ1qpausDsnEysAcGhAbG5NDTIfLaOtBwgAqQkZCrmEDwsFo1Uzc3AABaoXADuUMwQCwCiqLOo1gAGALLISSwA5lDopujmUGCzkB4gEgAk5F1y1VCPAFIAygDyAHIAdOVUEdWiB2g5YnItrFZBM5Hl4fDKCwAqgeK5VNB6Mx5swAMJcQZpcZQUqDACMEmYiECdhSsNJhIgACYqTS6ahZABIMkQADMbNp9PklEopT0FXwKx2zgwABkpQB9PHfAAiK0+EmxuIJRNITUZFIkQnJPjyvNZUBNZpovIFVtNIqUKnUmlYqnQYQgADUvIgILoAGKFbVzfFM3TWeJQUPhvUk8Xldg4sO6gMudyePCxtO6YhkcgKUU0AD0JagAElWK4ThAvFAIAAPVx1CB+aYB6BdNKBVwgRmBaA8WaBKC6LiD9IdooZCDqPJl9JFJuo5j18xhVx5ApFEplCpddJ8WgAcl55JPfjPTOZJ4EYzyzTYKbjAc6VUSlW4fBzEZ6ZHMEA10CZBVF9LB-WsLoYQRYsGz0AxMBwSIzHMKCX1zPwpRleUlRVdVPhgvJ0GAAxWGfHUI1kJEPTrAJwP9IMQwwiMo0URdPlIux8kKfwpmgJsWxCCBnTUDQtCgQDgNAhiICgzgJCBI4xlrUjUFYAAGKAiyAA\"\u003ePlayground link\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe above code does a \u003cstrong\u003e\u003cstrong\u003e\u003cstrong\u003e\u003cstrong\u003e\u003cstrong\u003e\u003cstrong\u003e\u003cstrong\u003eruntime\u003c/strong\u003e\u003c/strong\u003e\u003c/strong\u003e\u003c/strong\u003e\u003c/strong\u003e\u003c/strong\u003e\u003c/strong\u003e check that the object has all the keys that are defined in the template. This ensure that any missing keys are caught as well.\u003c/p\u003e\n\u003cp\u003eI have seen other examples online where only the object is passed in, but this ends up not working if the keys are not defined in the object:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e\nfunction ensureAllRequired\u0026lt;T\u0026gt;(obj: Partial\u0026lt;T\u0026gt;): asserts obj is T {\n  for (const key in obj) {\n    if (obj[key] === undefined) {\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\n    }\n  }\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe above will let any empty object partial to pass the assert.\u003c/p\u003e\n\u003ch2\u003eTakeaway\u003c/h2\u003e\n\u003cp\u003eThis ends up being a lot of work to do a runtime check to improve our typings, which I‚Äôm not sure is the best approach. Most of the time when we construct objects from an empty object, it‚Äôs difficult to ensure that the full object has been safely created.\u003c/p\u003e\n\u003cp\u003eSince we have to create a template object anyway, it is almost always simpler to do the following:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003einterface KnownCodes {\n  code1: number;\n  code2: number;\n  code3: number;\n}\n\nconst TEMPALTE_CODES: KnownCodes = {\n  code1: -1,\n  code2: -1,\n  code3: -1,\n}\n\nfunction createValuesForKnownCodes(): KnownCodes {\n  const knownCodes = { ...TEMPALTE_CODES };\n\n  // In a real example, these keys may come from some other object\n  // or external data\n  for (const key of [\u0026#x27;code1\u0026#x27;, \u0026#x27;code2\u0026#x27;, \u0026#x27;code3\u0026#x27;]) {\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\n  }\n\n  return knownCodes;\n}\n\ncreateValuesForKnownCodes();\n\n// Stub for the example\nfunction dynamicValue(key: string) { return 0 };\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgNIgPYHcQGEMAmEAzsgN4BQyyChEAjAFzIgCuAtgEbQDcVNdAEzM2XXv1pEAzCI7cofAL4UKtEMTDIAKgFEAsgAUAggBldAfVwB5ACI6Ays3TY8dUgF5yEuk2QBaegAabyJhfyCQiBlw4OUKGFYQBDBgDBAaKAg4SAA1OAAbVhIAMQwoZxx8ImIACgBKJ0xKty9qNQ1kAGsm12rkTzJkADoR3UNTC2s7e2RFPn4AegXkAEl0uGRMguQIAA84dgAHfIhA5DAACxIUTogAT1J2ODuBdhQYKAx2ZGIvlAxLtBkBhOAArCDJRbLMo7XaQKAgbYEbJwfgwGE1dqaW4vDAwZAAbQA5JIGESziShOTkJTpESALp1VrUajdFxVEgEnHIOCkHF4tA9DnEen9ZAEO6I9jABB5QoQGo4up8ahxaiZMCsBFdIVuJQqBBbXIFIrEUrlXXVerzJbIeyazjIdFQc5XWEHY4QeKJZKpdISqUyuVFRX3ZgaKCgADmTMGGq16QADLM+EA\"\u003ePlayground link\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHere we take the easy way out and clone the template and then built the object from there. Even if we forget to add a key (like \u003ccode\u003ecode3\u003c/code\u003e) to our list of keys or its missing from our external data that we are using, we will be guaranteed that the return value is the correct shape and types.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    pre: \"pre\",\n    code: \"code\",\n    a: \"a\",\n    strong: \"strong\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"When trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn‚Äôt know that the object is complete:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * An example interface to demonstrate\\n */\\ninterface KnownCodes {\\n  code1: number;\\n  code2: number;\\n  code3: number;\\n}\\n\\nfunction createValuesForKnownCodes(): KnownCodes {\\n  const knownCodes: Partial\u003cKnownCodes\u003e = {};\\n\\n  // In a real example, these keys may come from some other object\\n  // or external data\\n  for (const key in ['code1', 'code2', 'code3']) {\\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\\n  }\\n\\n  return knownCodes as KnownCodes;\\n}\\n\\n// Stub for the example\\nfunction dynamicValue(key: string) { return 0 };\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the above example, we know that \", _jsx(_components.code, {\n        children: \"knownCodes\"\n      }), \" will have all the keys will have values for the interface \", _jsx(_components.code, {\n        children: \"KnownCodes\"\n      }), \". However, Typescript can‚Äôt infer that, so we have to cast the value.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As the function gets more complex with additional feature work, this can become brittle and lead to some type-holes where we may have accidentally forgotten to set a key.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"One way to get around this is to use an assert:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"type RequireAll\u003cT\u003e = {\\n  [K in keyof T]-?: T[K];\\n};\\n\\nfunction ensureAllRequired\u003cT\u003e(obj: Partial\u003cT\u003e, template: RequireAll\u003cT\u003e): asserts obj is T {\\n  for (const key in template) {\\n    if (obj[key] === undefined) {\\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\\n    }\\n  }\\n}\\n\\ninterface KnownCodes {\\n  code1: number;\\n  code2: number;\\n  code3: number;\\n}\\n\\nconst TEMPALTE_CODES: KnownCodes = {\\n  code1: -1,\\n  code2: -1,\\n  code3: -1,\\n}\\n\\nfunction createValuesForKnownCodes(): KnownCodes {\\n  const knownCodes: Partial\u003cKnownCodes\u003e = {};\\n\\n  // In a real example, these keys may come from some other object\\n  // or external data\\n  for (const key of ['code1', 'code2']) {\\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\\n  }\\n\\n  ensureAllRequired(knownCodes, TEMPALTE_CODES);\\n\\n  return knownCodes;\\n}\\n\\ncreateValuesForKnownCodes();\\n\\n// Stub for the example\\nfunction dynamicValue(key: string) { return 0 };\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/C4TwDgpgBAShCOBXAlgJwgQQDZYDwBUA+KAXigG8AoKKAbQGkpkA7KAawhAHsAzKfALoBaAPwAufgwEBuSgF9ZlHomYBjYMi6sIzAM6J02LHCRoIAEwKEAFFwBGAKwkAFAIaoNrvEQA0UYBAAtmBYrgESJiiGOFYAlBKuuroQHrpQ9g5MafgU1FA8XKhQ1qpausDsnEysAcGhAbG5NDTIfLaOtBwgAqQkZCrmEDwsFo1Uzc3AABaoXADuUMwQCwCiqLOo1gAGALLISSwA5lDopujmUGCzkB4gEgAk5F1y1VCPAFIAygDyAHIAdOVUEdWiB2g5YnItrFZBM5Hl4fDKCwAqgeK5VNB6Mx5swAMJcQZpcZQUqDACMEmYiECdhSsNJhIgACYqTS6ahZABIMkQADMbNp9PklEopT0FXwKx2zgwABkpQB9PHfAAiK0+EmxuIJRNITUZFIkQnJPjyvNZUBNZpovIFVtNIqUKnUmlYqnQYQgADUvIgILoAGKFbVzfFM3TWeJQUPhvUk8Xldg4sO6gMudyePCxtO6YhkcgKUU0AD0JagAElWK4ThAvFAIAAPVx1CB+aYB6BdNKBVwgRmBaA8WaBKC6LiD9IdooZCDqPJl9JFJuo5j18xhVx5ApFEplCpddJ8WgAcl55JPfjPTOZJ4EYzyzTYKbjAc6VUSlW4fBzEZ6ZHMEA10CZBVF9LB-WsLoYQRYsGz0AxMBwSIzHMKCX1zPwpRleUlRVdVPhgvJ0GAAxWGfHUI1kJEPTrAJwP9IMQwwiMo0URdPlIux8kKfwpmgJsWxCCBnTUDQtCgQDgNAhiICgzgJCBI4xlrUjUFYAAGKAiyAA\",\n        children: \"Playground link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The above code does a \", _jsx(_components.strong, {\n        children: _jsx(_components.strong, {\n          children: _jsx(_components.strong, {\n            children: _jsx(_components.strong, {\n              children: _jsx(_components.strong, {\n                children: _jsx(_components.strong, {\n                  children: _jsx(_components.strong, {\n                    children: \"runtime\"\n                  })\n                })\n              })\n            })\n          })\n        })\n      }), \" check that the object has all the keys that are defined in the template. This ensure that any missing keys are caught as well.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I have seen other examples online where only the object is passed in, but this ends up not working if the keys are not defined in the object:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"\\nfunction ensureAllRequired\u003cT\u003e(obj: Partial\u003cT\u003e): asserts obj is T {\\n  for (const key in obj) {\\n    if (obj[key] === undefined) {\\n      throw new Error(`Missing required property: ${key} in ${JSON.stringify(obj)}`);\\n    }\\n  }\\n}\\n\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The above will let any empty object partial to pass the assert.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaway\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This ends up being a lot of work to do a runtime check to improve our typings, which I‚Äôm not sure is the best approach. Most of the time when we construct objects from an empty object, it‚Äôs difficult to ensure that the full object has been safely created.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Since we have to create a template object anyway, it is almost always simpler to do the following:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"interface KnownCodes {\\n  code1: number;\\n  code2: number;\\n  code3: number;\\n}\\n\\nconst TEMPALTE_CODES: KnownCodes = {\\n  code1: -1,\\n  code2: -1,\\n  code3: -1,\\n}\\n\\nfunction createValuesForKnownCodes(): KnownCodes {\\n  const knownCodes = { ...TEMPALTE_CODES };\\n\\n  // In a real example, these keys may come from some other object\\n  // or external data\\n  for (const key of ['code1', 'code2', 'code3']) {\\n     knownCodes[key as keyof KnownCodes] = dynamicValue(key);\\n  }\\n\\n  return knownCodes;\\n}\\n\\ncreateValuesForKnownCodes();\\n\\n// Stub for the example\\nfunction dynamicValue(key: string) { return 0 };\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgNIgPYHcQGEMAmEAzsgN4BQyyChEAjAFzIgCuAtgEbQDcVNdAEzM2XXv1pEAzCI7cofAL4UKtEMTDIAKgFEAsgAUAggBldAfVwB5ACI6Ays3TY8dUgF5yEuk2QBaegAabyJhfyCQiBlw4OUKGFYQBDBgDBAaKAg4SAA1OAAbVhIAMQwoZxx8ImIACgBKJ0xKty9qNQ1kAGsm12rkTzJkADoR3UNTC2s7e2RFPn4AegXkAEl0uGRMguQIAA84dgAHfIhA5DAACxIUTogAT1J2ODuBdhQYKAx2ZGIvlAxLtBkBhOAArCDJRbLMo7XaQKAgbYEbJwfgwGE1dqaW4vDAwZAAbQA5JIGESziShOTkJTpESALp1VrUajdFxVEgEnHIOCkHF4tA9DnEen9ZAEO6I9jABB5QoQGo4up8ahxaiZMCsBFdIVuJQqBBbXIFIrEUrlXXVerzJbIeyazjIdFQc5XWEHY4QeKJZKpdISqUyuVFRX3ZgaKCgADmTMGGq16QADLM+EA\",\n        children: \"Playground link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here we take the easy way out and clone the template and then built the object from there. Even if we forget to add a key (like \", _jsx(_components.code, {\n        children: \"code3\"\n      }), \") to our list of keys or its missing from our external data that we are using, we will be guaranteed that the return value is the correct shape and types.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nWhen trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn‚Äôt know that the object is complete:","excerptHTML":"\u003cp\u003eWhen trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn‚Äôt know that the object is complete:\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"When trying to be as type-safe as possible in Typescript, there are times when you may have to dynamically construct an object. You know as a programmer that all the keys will have values, but because you have to dynamically construct the values, the type system doesn‚Äôt know that the object is complete:\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-13-reviewing-frontend-applications","date":"2023-08-13","title":"Reviewing Your Frontend Applications","frontmatter":{"title":"Reviewing Your Frontend Applications","tags":["frontend","onboarding","documentation"]},"contentRaw":"\nBelow are some notes I‚Äôve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\n\n## Onboarding\n\nWhen new members start, do you have processes and documentation in place to make onboarding easy?\n\n‚òê Is your process written down?\n\n‚òê Add a note for people onboarding continue to improve it when they walk through it. Every time a new members onboards, they should follow the documentation and update it with any missing steps or new errors and resolutions if they come across them.\n\n## Environment Setup\n\nPart of onboarding is getting your environment set up. Usually, a team will have a preferred IDE and environment set up so that it is easy to help each other if there are any problems.\n\n‚òê Is the preferred IDE documented?\n\n‚òê Are preferred 3rd party plugins that developers install listed and documented somewhere?\n\n‚òê If there is a VPN, are all the VPN details documented?\n\n‚òê Is the preferred Git usage documented? IE git-flow etc?\n\n## README\n\nEach repository should have a main README that acts as a starting point for people new to the project to read. This should be useful to people who have been at the company for years, all the way to someone new who has just received their laptop:\n\n‚òê Does the README have all the steps to:\n\n1. Download\n2. Install\n3. Run\n4. Deploy\n5. Test\n\n‚òê Architecture - Is the architecture documented? This doesn‚Äôt need to be all documented within the README, but the README should at least link out to external documentation that covers:\n\n1. Clients, servers, databases, 3rd party systems are documented\n2. Data flows between systems are documented\n\n‚òê  API Documentation - How is the API documented? This is similar to the architecture section.\n\n1. If your repo has components, is there a Storybook or similar site to document the interfaces?\n2. If your repo has web APIs, is there a OpenAPI spec that can be viewed?\n3. Other projects will want to document their APIs as well.\n\n‚òê Design System - Similar to the API documentation, if there is a design system that is used or implemented, does your README call that out?\n\n1. Documentation - do you have a link to how to get to the documentation?\n2. Storybooks - is there already a live storybook link somewhere? Does your README document how to run the storybook as well?\n\n### Building and CI/CD\n\nIf your project is buildable or deployable, do you have documentation on the Build Pipeline and the CI/CD PIipelines? These are important to simplify and document. Someone new to the project should be able to follow the README in the repo to build the application and understand what happens when they push a commit to the repository.\n\n‚òê  Build Pipeline\n\n1. Can the app be built in one step?\n2. Is the pipeline modern?\n\n‚òê  CI/CD\n\n1. Is there a CI/CD runner?\n2. Is it documented?\n3. Are there lint guidelines?\n    1. Are they checked on the CI/CD?\n4. Are there unit tests?\n    1. Are they run on every commit?\n5. Are there pre-push and pre-commit hooks? You can use Husky to set these up\n\n### Testing\n\nAs mentioned above, running unit, integration, and e2e tests may be part of the CI/CD pipeline. Will new people who onboard be able to follow the repo‚Äôs README or some other document in order to understand how to test their changes? If there is code-coverage, how do new members of the team know where to find them?\n\n‚òê Testing\n\n1. Is there a test pipeline\n2. Are there unit tests\n3. Are there automated code coverage reports?\n\n‚òê Bundle Sizes\n\n1. Make sure tree shaking is happening correctly\n2. Analyze the bundle size with create-react-app or BundleSizeAnalyzer webpack plugin\n\n‚òê Performance\n\n1. Analyze your web app for pagespeed, lighthouse rating, and [a11y](https://github.com/thecreazy/siteaudit)\n\n### External Services\n\nSometimes repositories are self-contained, but more often than not, a repository will pull external information from a service. This might be feature flags from providers like LaunchDarkly, or website content from a Content Management System (CMS). Do new members of the team need API keys for these services? Make sure to document any external services and how to access them.\n\n‚òê CMS\n\n1. Are there a lot of text and content that is constantly updated?\n2. Is there a CMS already implemented?\n\n### Conclusion\n\nThis is not meant to be an exhaustive list of everything to think about concerning onboarding members to a project. Documentation is nice to have, but working with the team to understand what is missing and how to improve it goes a long way to keeping the team happy and productive.\n\nI highly recommend reviewing the onboarding process from time to time and making sure that it is easy to onboard. You never know when your computer will crash and you need to set up your entire environment again.\n","contentHTML":"\u003cp\u003eBelow are some notes I‚Äôve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\u003c/p\u003e\n\u003ch2\u003eOnboarding\u003c/h2\u003e\n\u003cp\u003eWhen new members start, do you have processes and documentation in place to make onboarding easy?\u003c/p\u003e\n\u003cp\u003e‚òê Is your process written down?\u003c/p\u003e\n\u003cp\u003e‚òê Add a note for people onboarding continue to improve it when they walk through it. Every time a new members onboards, they should follow the documentation and update it with any missing steps or new errors and resolutions if they come across them.\u003c/p\u003e\n\u003ch2\u003eEnvironment Setup\u003c/h2\u003e\n\u003cp\u003ePart of onboarding is getting your environment set up. Usually, a team will have a preferred IDE and environment set up so that it is easy to help each other if there are any problems.\u003c/p\u003e\n\u003cp\u003e‚òê Is the preferred IDE documented?\u003c/p\u003e\n\u003cp\u003e‚òê Are preferred 3rd party plugins that developers install listed and documented somewhere?\u003c/p\u003e\n\u003cp\u003e‚òê If there is a VPN, are all the VPN details documented?\u003c/p\u003e\n\u003cp\u003e‚òê Is the preferred Git usage documented? IE git-flow etc?\u003c/p\u003e\n\u003ch2\u003eREADME\u003c/h2\u003e\n\u003cp\u003eEach repository should have a main README that acts as a starting point for people new to the project to read. This should be useful to people who have been at the company for years, all the way to someone new who has just received their laptop:\u003c/p\u003e\n\u003cp\u003e‚òê Does the README have all the steps to:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eDownload\u003c/li\u003e\n\u003cli\u003eInstall\u003c/li\u003e\n\u003cli\u003eRun\u003c/li\u003e\n\u003cli\u003eDeploy\u003c/li\u003e\n\u003cli\u003eTest\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e‚òê Architecture - Is the architecture documented? This doesn‚Äôt need to be all documented within the README, but the README should at least link out to external documentation that covers:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eClients, servers, databases, 3rd party systems are documented\u003c/li\u003e\n\u003cli\u003eData flows between systems are documented\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e‚òê  API Documentation - How is the API documented? This is similar to the architecture section.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eIf your repo has components, is there a Storybook or similar site to document the interfaces?\u003c/li\u003e\n\u003cli\u003eIf your repo has web APIs, is there a OpenAPI spec that can be viewed?\u003c/li\u003e\n\u003cli\u003eOther projects will want to document their APIs as well.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e‚òê Design System - Similar to the API documentation, if there is a design system that is used or implemented, does your README call that out?\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eDocumentation - do you have a link to how to get to the documentation?\u003c/li\u003e\n\u003cli\u003eStorybooks - is there already a live storybook link somewhere? Does your README document how to run the storybook as well?\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eBuilding and CI/CD\u003c/h3\u003e\n\u003cp\u003eIf your project is buildable or deployable, do you have documentation on the Build Pipeline and the CI/CD PIipelines? These are important to simplify and document. Someone new to the project should be able to follow the README in the repo to build the application and understand what happens when they push a commit to the repository.\u003c/p\u003e\n\u003cp\u003e‚òê  Build Pipeline\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCan the app be built in one step?\u003c/li\u003e\n\u003cli\u003eIs the pipeline modern?\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e‚òê  CI/CD\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eIs there a CI/CD runner?\u003c/li\u003e\n\u003cli\u003eIs it documented?\u003c/li\u003e\n\u003cli\u003eAre there lint guidelines?\u003c!-- --\u003e\n\u003col\u003e\n\u003cli\u003eAre they checked on the CI/CD?\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eAre there unit tests?\u003c!-- --\u003e\n\u003col\u003e\n\u003cli\u003eAre they run on every commit?\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eAre there pre-push and pre-commit hooks? You can use Husky to set these up\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eTesting\u003c/h3\u003e\n\u003cp\u003eAs mentioned above, running unit, integration, and e2e tests may be part of the CI/CD pipeline. Will new people who onboard be able to follow the repo‚Äôs README or some other document in order to understand how to test their changes? If there is code-coverage, how do new members of the team know where to find them?\u003c/p\u003e\n\u003cp\u003e‚òê Testing\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eIs there a test pipeline\u003c/li\u003e\n\u003cli\u003eAre there unit tests\u003c/li\u003e\n\u003cli\u003eAre there automated code coverage reports?\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e‚òê Bundle Sizes\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eMake sure tree shaking is happening correctly\u003c/li\u003e\n\u003cli\u003eAnalyze the bundle size with create-react-app or BundleSizeAnalyzer webpack plugin\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e‚òê Performance\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eAnalyze your web app for pagespeed, lighthouse rating, and \u003ca href=\"https://github.com/thecreazy/siteaudit\"\u003ea11y\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eExternal Services\u003c/h3\u003e\n\u003cp\u003eSometimes repositories are self-contained, but more often than not, a repository will pull external information from a service. This might be feature flags from providers like LaunchDarkly, or website content from a Content Management System (CMS). Do new members of the team need API keys for these services? Make sure to document any external services and how to access them.\u003c/p\u003e\n\u003cp\u003e‚òê CMS\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eAre there a lot of text and content that is constantly updated?\u003c/li\u003e\n\u003cli\u003eIs there a CMS already implemented?\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eConclusion\u003c/h3\u003e\n\u003cp\u003eThis is not meant to be an exhaustive list of everything to think about concerning onboarding members to a project. Documentation is nice to have, but working with the team to understand what is missing and how to improve it goes a long way to keeping the team happy and productive.\u003c/p\u003e\n\u003cp\u003eI highly recommend reviewing the onboarding process from time to time and making sure that it is easy to onboard. You never know when your computer will crash and you need to set up your entire environment again.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    ol: \"ol\",\n    li: \"li\",\n    h3: \"h3\",\n    a: \"a\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"Below are some notes I‚Äôve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Onboarding\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When new members start, do you have processes and documentation in place to make onboarding easy?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Is your process written down?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Add a note for people onboarding continue to improve it when they walk through it. Every time a new members onboards, they should follow the documentation and update it with any missing steps or new errors and resolutions if they come across them.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Environment Setup\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Part of onboarding is getting your environment set up. Usually, a team will have a preferred IDE and environment set up so that it is easy to help each other if there are any problems.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Is the preferred IDE documented?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Are preferred 3rd party plugins that developers install listed and documented somewhere?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê If there is a VPN, are all the VPN details documented?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Is the preferred Git usage documented? IE git-flow etc?\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"README\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Each repository should have a main README that acts as a starting point for people new to the project to read. This should be useful to people who have been at the company for years, all the way to someone new who has just received their laptop:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Does the README have all the steps to:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Download\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Install\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Run\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Deploy\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Test\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Architecture - Is the architecture documented? This doesn‚Äôt need to be all documented within the README, but the README should at least link out to external documentation that covers:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Clients, servers, databases, 3rd party systems are documented\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Data flows between systems are documented\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê  API Documentation - How is the API documented? This is similar to the architecture section.\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"If your repo has components, is there a Storybook or similar site to document the interfaces?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"If your repo has web APIs, is there a OpenAPI spec that can be viewed?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Other projects will want to document their APIs as well.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Design System - Similar to the API documentation, if there is a design system that is used or implemented, does your README call that out?\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Documentation - do you have a link to how to get to the documentation?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Storybooks - is there already a live storybook link somewhere? Does your README document how to run the storybook as well?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Building and CI/CD\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If your project is buildable or deployable, do you have documentation on the Build Pipeline and the CI/CD PIipelines? These are important to simplify and document. Someone new to the project should be able to follow the README in the repo to build the application and understand what happens when they push a commit to the repository.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê  Build Pipeline\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Can the app be built in one step?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Is the pipeline modern?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê  CI/CD\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Is there a CI/CD runner?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Is it documented?\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Are there lint guidelines?\", \"\\n\", _jsxs(_components.ol, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"Are they checked on the CI/CD?\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Are there unit tests?\", \"\\n\", _jsxs(_components.ol, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"Are they run on every commit?\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Are there pre-push and pre-commit hooks? You can use Husky to set these up\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Testing\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As mentioned above, running unit, integration, and e2e tests may be part of the CI/CD pipeline. Will new people who onboard be able to follow the repo‚Äôs README or some other document in order to understand how to test their changes? If there is code-coverage, how do new members of the team know where to find them?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Testing\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Is there a test pipeline\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Are there unit tests\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Are there automated code coverage reports?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Bundle Sizes\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Make sure tree shaking is happening correctly\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Analyze the bundle size with create-react-app or BundleSizeAnalyzer webpack plugin\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê Performance\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Analyze your web app for pagespeed, lighthouse rating, and \", _jsx(_components.a, {\n          href: \"https://github.com/thecreazy/siteaudit\",\n          children: \"a11y\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"External Services\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Sometimes repositories are self-contained, but more often than not, a repository will pull external information from a service. This might be feature flags from providers like LaunchDarkly, or website content from a Content Management System (CMS). Do new members of the team need API keys for these services? Make sure to document any external services and how to access them.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"‚òê CMS\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Are there a lot of text and content that is constantly updated?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Is there a CMS already implemented?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Conclusion\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is not meant to be an exhaustive list of everything to think about concerning onboarding members to a project. Documentation is nice to have, but working with the team to understand what is missing and how to improve it goes a long way to keeping the team happy and productive.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I highly recommend reviewing the onboarding process from time to time and making sure that it is easy to onboard. You never know when your computer will crash and you need to set up your entire environment again.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nBelow are some notes I‚Äôve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.","excerptHTML":"\u003cp\u003eBelow are some notes I‚Äôve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"Below are some notes I‚Äôve taken from setting up new code repositories and onboarding new team members. Hopefully they can help improve your current documentation and notes to make onboarding a smooth process.\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["frontend","onboarding","documentation"]},{"slug":"2023-08-12-ensuring-all-of-type","date":"2023-08-12","title":"Forbidden Typescript: ensuring all of a type","frontmatter":{"title":"Forbidden Typescript: ensuring all of a type","tags":["typescript"]},"contentRaw":"\nWhen creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\n\n```tsx\ntype Colors = 'red' | 'green' | 'blue';\n```\n\nThen, throughout our codebase, we can use the `Color` type to ensure functions can only be called with those values:\n\n```tsx\naddColor(name: Colors);\n```\n\nBut, we may want to make sure that when we create a new possible value for the type, we don‚Äôt forget to use that value to do some initialization:\n\n```tsx\nfunction initColors() {\n  addColor('red')\n  addColor('green');\n  addColor('blue');\n}\n```\n\nThere are a few ways to do this, one would be to create a record that must contain every color:\n\n```tsx\nconst allColors: Record\u003cColors, boolean\u003e = {\n    red: true,\n    green: true,\n    blue: true,\n};\n\nfunction initColorsUsingRecord() {\n    (Object.keys(allColors) as Colors[]).forEach((color) =\u003e {\n        addColor(color);\n    });\n}\n```\n\nIn the above snippet, we create a record that will have every `Colors` type as a key, and Typescript will complain when we add a new literal type to the `Colors` union and forget to add it to the record.\n\nNotice though that we end up just getting the list of keys in `allColors` as an array anyway, then casting that type to help with the type-hinting for `Object.keys`.\n\nWe can also ensure that we create an array with every value of a given type:\n\n```tsx\n/**\n * Generator function to create functions that will throw typing exceptions when\n * the given array does not contain all values of the type\n */\nfunction ensureAllOf\u003cT\u003e() {\n    return \u003cU extends T[]\u003e(array: U \u0026 ([T] extends [U[number]] ? unknown : \"Invalid\")) =\u003e array;\n}\n\ntype Color = 'red' | 'green' | 'blue';\nconst ensureAllColors = ensureAllOf\u003cColor\u003e();\nconst colors = ensureAllColors(['red', 'green', 'blue']);\n\nfunction addColor(color: Color) {\n    // just a stub\n}\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color =\u003e {\n        addColor(color);\n    });\n}\n```\n\n[Typescript Playground](https://www.typescriptlang.org/play?#code/PQKhCgAIUhxBTAdvATgQwC4HsWQGYCuiAxhgJZaKTaTErybz5GkWIDO1AFppAO5kANoO4osfagE8ADmUQBzSPAAexeNPKVOfLkigwMuyPLIA3JJDQp0kyABMs8ToiwZalDGjmXhkU2kECJ0gsPG4mDBl4fWBwQhJNKiR2AnoAQWEAeTwAHgAVAD4ACgBKSABvKEhq+gxUqhyAVSVlDCQ7TjyAbQBdYqsbAC5IZoAySCKuvJ6WtsQOyC7GrsQCAFsAI1QemYB+SCIAaxc+KmGAIgBJRH9BMjtzkrKAXgLLazRJAG5wAF9wcCRaRMADCWEEOEgz0gAHJ6HYYZAAD6w+T0JCIlEwjaBeAwn7ELRuZKpeAZQRgiEoTjQknpLK5Sk4YolAlE9xUmlKDik8lM6mTOHwBEAGlR6MQMLF2NxMJ6rIB8VYlEsdjs-KKhKpw35ZUq1WqwGAkAAVgR2G40JALQQNn9FSxEpA5GQMPz2I12HJ5ABRHn0UoVKrVLU4dgAOjwOB9aGIXE14MhryDBtTqvViZQCapCtTvwVvyAA)\n\nIn the above example, we have a template `ensureAllOf` that takes a type and spits out a function that takes an array of that type and will throw a typing error if that array does not contain all of the possible values.\n\nIf we add ‚Äúyellow‚Äù to the `Colors` type, then `ensureAllColors` will remind us that we need to add ‚Äúyellow‚Äù to the list of values\n\n## Takeaway\n\nWhile `ensureAllOf` may come in handy in some cases, it is almost always easier to use an enumeration:\n\n```tsx\nenum Color {\n    red = 'red',\n    green = 'green',\n    blue = 'blue'\n}\n\nfunction addColor(color: Color) {\n    console.log('init', color);\n}\n\nconst colors = Object.values(Color);\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color =\u003e {\n        addColor(color);\n    });\n}\ninitColorsUsingEnsure();\n```\n\n[Typescript Playground](https://www.typescriptlang.org/play?#code/KYOwrgtgBAwg9gGzgJygbwFBW1ZwAmUAvFAOR76kA0WOA5nqMWQ8KNbdgEYJjDOkefUhgC+GDADMwIAMYAXAJZwQUAIb588JMgAUsxCgBcsQ8gCU6TlAMgAzomAA6JHV2lFIRfOo2z5gG4xCVs7eT8dO2YAeS4AK2AFJwA3NV5gO11tFECJaTklFShPb2zkOwBVO086AFF7MDxdS0wcCJQ7J0kUWrVZAAt9M2IAPis2to0tMyGdXLbRXPES+TLK6pA6hqbAoA)\n\nUsing an enumeration, there is no need to write a type and have to add the new value to the ensureOfAll array.\n","contentHTML":"\u003cp\u003eWhen creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003etype Colors = \u0026#x27;red\u0026#x27; | \u0026#x27;green\u0026#x27; | \u0026#x27;blue\u0026#x27;;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen, throughout our codebase, we can use the \u003ccode\u003eColor\u003c/code\u003e type to ensure functions can only be called with those values:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eaddColor(name: Colors);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBut, we may want to make sure that when we create a new possible value for the type, we don‚Äôt forget to use that value to do some initialization:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003efunction initColors() {\n  addColor(\u0026#x27;red\u0026#x27;)\n  addColor(\u0026#x27;green\u0026#x27;);\n  addColor(\u0026#x27;blue\u0026#x27;);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThere are a few ways to do this, one would be to create a record that must contain every color:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econst allColors: Record\u0026lt;Colors, boolean\u0026gt; = {\n    red: true,\n    green: true,\n    blue: true,\n};\n\nfunction initColorsUsingRecord() {\n    (Object.keys(allColors) as Colors[]).forEach((color) =\u0026gt; {\n        addColor(color);\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn the above snippet, we create a record that will have every \u003ccode\u003eColors\u003c/code\u003e type as a key, and Typescript will complain when we add a new literal type to the \u003ccode\u003eColors\u003c/code\u003e union and forget to add it to the record.\u003c/p\u003e\n\u003cp\u003eNotice though that we end up just getting the list of keys in \u003ccode\u003eallColors\u003c/code\u003e as an array anyway, then casting that type to help with the type-hinting for \u003ccode\u003eObject.keys\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eWe can also ensure that we create an array with every value of a given type:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e/**\n * Generator function to create functions that will throw typing exceptions when\n * the given array does not contain all values of the type\n */\nfunction ensureAllOf\u0026lt;T\u0026gt;() {\n    return \u0026lt;U extends T[]\u0026gt;(array: U \u0026amp; ([T] extends [U[number]] ? unknown : \u0026quot;Invalid\u0026quot;)) =\u0026gt; array;\n}\n\ntype Color = \u0026#x27;red\u0026#x27; | \u0026#x27;green\u0026#x27; | \u0026#x27;blue\u0026#x27;;\nconst ensureAllColors = ensureAllOf\u0026lt;Color\u0026gt;();\nconst colors = ensureAllColors([\u0026#x27;red\u0026#x27;, \u0026#x27;green\u0026#x27;, \u0026#x27;blue\u0026#x27;]);\n\nfunction addColor(color: Color) {\n    // just a stub\n}\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color =\u0026gt; {\n        addColor(color);\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/PQKhCgAIUhxBTAdvATgQwC4HsWQGYCuiAxhgJZaKTaTErybz5GkWIDO1AFppAO5kANoO4osfagE8ADmUQBzSPAAexeNPKVOfLkigwMuyPLIA3JJDQp0kyABMs8ToiwZalDGjmXhkU2kECJ0gsPG4mDBl4fWBwQhJNKiR2AnoAQWEAeTwAHgAVAD4ACgBKSABvKEhq+gxUqhyAVSVlDCQ7TjyAbQBdYqsbAC5IZoAySCKuvJ6WtsQOyC7GrsQCAFsAI1QemYB+SCIAaxc+KmGAIgBJRH9BMjtzkrKAXgLLazRJAG5wAF9wcCRaRMADCWEEOEgz0gAHJ6HYYZAAD6w+T0JCIlEwjaBeAwn7ELRuZKpeAZQRgiEoTjQknpLK5Sk4YolAlE9xUmlKDik8lM6mTOHwBEAGlR6MQMLF2NxMJ6rIB8VYlEsdjs-KKhKpw35ZUq1WqwGAkAAVgR2G40JALQQNn9FSxEpA5GQMPz2I12HJ5ABRHn0UoVKrVLU4dgAOjwOB9aGIXE14MhryDBtTqvViZQCapCtTvwVvyAA\"\u003eTypescript Playground\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIn the above example, we have a template \u003ccode\u003eensureAllOf\u003c/code\u003e that takes a type and spits out a function that takes an array of that type and will throw a typing error if that array does not contain all of the possible values.\u003c/p\u003e\n\u003cp\u003eIf we add ‚Äúyellow‚Äù to the \u003ccode\u003eColors\u003c/code\u003e type, then \u003ccode\u003eensureAllColors\u003c/code\u003e will remind us that we need to add ‚Äúyellow‚Äù to the list of values\u003c/p\u003e\n\u003ch2\u003eTakeaway\u003c/h2\u003e\n\u003cp\u003eWhile \u003ccode\u003eensureAllOf\u003c/code\u003e may come in handy in some cases, it is almost always easier to use an enumeration:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eenum Color {\n    red = \u0026#x27;red\u0026#x27;,\n    green = \u0026#x27;green\u0026#x27;,\n    blue = \u0026#x27;blue\u0026#x27;\n}\n\nfunction addColor(color: Color) {\n    console.log(\u0026#x27;init\u0026#x27;, color);\n}\n\nconst colors = Object.values(Color);\n\nfunction initColorsUsingEnsure() {\n    colors.forEach(color =\u0026gt; {\n        addColor(color);\n    });\n}\ninitColorsUsingEnsure();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/KYOwrgtgBAwg9gGzgJygbwFBW1ZwAmUAvFAOR76kA0WOA5nqMWQ8KNbdgEYJjDOkefUhgC+GDADMwIAMYAXAJZwQUAIb588JMgAUsxCgBcsQ8gCU6TlAMgAzomAA6JHV2lFIRfOo2z5gG4xCVs7eT8dO2YAeS4AK2AFJwA3NV5gO11tFECJaTklFShPb2zkOwBVO086AFF7MDxdS0wcCJQ7J0kUWrVZAAt9M2IAPis2to0tMyGdXLbRXPES+TLK6pA6hqbAoA\"\u003eTypescript Playground\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eUsing an enumeration, there is no need to write a type and have to add the new value to the ensureOfAll array.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    pre: \"pre\",\n    code: \"code\",\n    a: \"a\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"When creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"type Colors = 'red' | 'green' | 'blue';\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Then, throughout our codebase, we can use the \", _jsx(_components.code, {\n        children: \"Color\"\n      }), \" type to ensure functions can only be called with those values:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"addColor(name: Colors);\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But, we may want to make sure that when we create a new possible value for the type, we don‚Äôt forget to use that value to do some initialization:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function initColors() {\\n  addColor('red')\\n  addColor('green');\\n  addColor('blue');\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There are a few ways to do this, one would be to create a record that must contain every color:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"const allColors: Record\u003cColors, boolean\u003e = {\\n    red: true,\\n    green: true,\\n    blue: true,\\n};\\n\\nfunction initColorsUsingRecord() {\\n    (Object.keys(allColors) as Colors[]).forEach((color) =\u003e {\\n        addColor(color);\\n    });\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the above snippet, we create a record that will have every \", _jsx(_components.code, {\n        children: \"Colors\"\n      }), \" type as a key, and Typescript will complain when we add a new literal type to the \", _jsx(_components.code, {\n        children: \"Colors\"\n      }), \" union and forget to add it to the record.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Notice though that we end up just getting the list of keys in \", _jsx(_components.code, {\n        children: \"allColors\"\n      }), \" as an array anyway, then casting that type to help with the type-hinting for \", _jsx(_components.code, {\n        children: \"Object.keys\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We can also ensure that we create an array with every value of a given type:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Generator function to create functions that will throw typing exceptions when\\n * the given array does not contain all values of the type\\n */\\nfunction ensureAllOf\u003cT\u003e() {\\n    return \u003cU extends T[]\u003e(array: U \u0026 ([T] extends [U[number]] ? unknown : \\\"Invalid\\\")) =\u003e array;\\n}\\n\\ntype Color = 'red' | 'green' | 'blue';\\nconst ensureAllColors = ensureAllOf\u003cColor\u003e();\\nconst colors = ensureAllColors(['red', 'green', 'blue']);\\n\\nfunction addColor(color: Color) {\\n    // just a stub\\n}\\n\\nfunction initColorsUsingEnsure() {\\n    colors.forEach(color =\u003e {\\n        addColor(color);\\n    });\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/PQKhCgAIUhxBTAdvATgQwC4HsWQGYCuiAxhgJZaKTaTErybz5GkWIDO1AFppAO5kANoO4osfagE8ADmUQBzSPAAexeNPKVOfLkigwMuyPLIA3JJDQp0kyABMs8ToiwZalDGjmXhkU2kECJ0gsPG4mDBl4fWBwQhJNKiR2AnoAQWEAeTwAHgAVAD4ACgBKSABvKEhq+gxUqhyAVSVlDCQ7TjyAbQBdYqsbAC5IZoAySCKuvJ6WtsQOyC7GrsQCAFsAI1QemYB+SCIAaxc+KmGAIgBJRH9BMjtzkrKAXgLLazRJAG5wAF9wcCRaRMADCWEEOEgz0gAHJ6HYYZAAD6w+T0JCIlEwjaBeAwn7ELRuZKpeAZQRgiEoTjQknpLK5Sk4YolAlE9xUmlKDik8lM6mTOHwBEAGlR6MQMLF2NxMJ6rIB8VYlEsdjs-KKhKpw35ZUq1WqwGAkAAVgR2G40JALQQNn9FSxEpA5GQMPz2I12HJ5ABRHn0UoVKrVLU4dgAOjwOB9aGIXE14MhryDBtTqvViZQCapCtTvwVvyAA\",\n        children: \"Typescript Playground\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In the above example, we have a template \", _jsx(_components.code, {\n        children: \"ensureAllOf\"\n      }), \" that takes a type and spits out a function that takes an array of that type and will throw a typing error if that array does not contain all of the possible values.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we add ‚Äúyellow‚Äù to the \", _jsx(_components.code, {\n        children: \"Colors\"\n      }), \" type, then \", _jsx(_components.code, {\n        children: \"ensureAllColors\"\n      }), \" will remind us that we need to add ‚Äúyellow‚Äù to the list of values\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaway\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"While \", _jsx(_components.code, {\n        children: \"ensureAllOf\"\n      }), \" may come in handy in some cases, it is almost always easier to use an enumeration:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"enum Color {\\n    red = 'red',\\n    green = 'green',\\n    blue = 'blue'\\n}\\n\\nfunction addColor(color: Color) {\\n    console.log('init', color);\\n}\\n\\nconst colors = Object.values(Color);\\n\\nfunction initColorsUsingEnsure() {\\n    colors.forEach(color =\u003e {\\n        addColor(color);\\n    });\\n}\\ninitColorsUsingEnsure();\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/KYOwrgtgBAwg9gGzgJygbwFBW1ZwAmUAvFAOR76kA0WOA5nqMWQ8KNbdgEYJjDOkefUhgC+GDADMwIAMYAXAJZwQUAIb588JMgAUsxCgBcsQ8gCU6TlAMgAzomAA6JHV2lFIRfOo2z5gG4xCVs7eT8dO2YAeS4AK2AFJwA3NV5gO11tFECJaTklFShPb2zkOwBVO086AFF7MDxdS0wcCJQ7J0kUWrVZAAt9M2IAPis2to0tMyGdXLbRXPES+TLK6pA6hqbAoA\",\n        children: \"Typescript Playground\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Using an enumeration, there is no need to write a type and have to add the new value to the ensureOfAll array.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nWhen creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:","excerptHTML":"\u003cp\u003eWhen creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"When creating more complex systems, there are times where you will want to ensure that an array contains every value of a defined type. We have a union of primitive literal types to define the possible values a type can have:\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-11-smart-contract-security","date":"2023-08-11","title":"Smart Contract Security","frontmatter":{"title":"Smart Contract Security","tags":["ethereum","smart-contracts","security"]},"contentRaw":"\nThe crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it‚Äôs important to make sure the Smart Contract is secure and follows best practices.\n\nIn general, the best practices around Smart Contracts are the same for writing secure code in general.\n\n## Keep it Simple\n\nKeep your Smart Contract code simple. Smart Contracts that try to be too clever often have unintended side-effects or functionality. Keeping a Smart Contract simple also means that the surface area for attacks is smaller.\n\n## Write Small Functions\n\nWrite small functions that do one thing. Many Smart Contracts will have many small functions that can be composed together, rather than one large function that does everything. This helps keep the code readable, making it easier to understand and secure.\n\n## Linting\n\nLint your code. Smart Contracts written in Solidity have tools already written that can help catch common errors via linting. The easiest linters to set up just help improve formatting, but some can help you write more secure code by letting your know when functions have been deprecated or marked as insecure.\n\n## Unit Tests\n\nUnit test your code. The best unit tests you can write for Smart Contracts are validating what users shouldn‚Äôt be able to do. As an example, make sure unauthorized accounts cannot withdraw assets from your contract. These are sometimes called **negative** tests and they can be even more important than your typical that validate your functions do what you expect them to do. These tests check that they fail in the correct way when misused.\n\n## Scan for Security Vulnerabilities\n\nScan your code for security vulnerabilities. This is pretty self-explanatory. Many Smart Contract toolchains provide scanning tools to check your Smart Contract code.\n\nThere are a few ways to surface security issues in Ethereum Smart Contracts. One way is to use [slither](https://github.com/crytic/slither):\n\n```tsx\nnpm install slither\nslither .\n```\n\nThis may take a while to run, but it will scan the compiles contracts for security issues.\n\n## Compliance\n\nFor Ethereum Smart Contracts, you can also use [slither](https://github.com/crytic/slither) to check the compliance of your ERC20 token or ERC721 contracts. Running this check will verify that your contract implements the expected interfaces of the given contracts.\n\n## Wrapping it Up\n\nSecurity is a major consideration in any application, but Smart Contracts pose a new type of attack vector for malicious users. Smart Contracts often interact with pools of cryptocurrency, NFTs, and other blockchain assets that make them new targets for attackers. It‚Äôs important when writing Smart Contracts to always make sure the contract fails correctly, even more-so than completing actions successfully.\n","contentHTML":"\u003cp\u003eThe crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it‚Äôs important to make sure the Smart Contract is secure and follows best practices.\u003c/p\u003e\n\u003cp\u003eIn general, the best practices around Smart Contracts are the same for writing secure code in general.\u003c/p\u003e\n\u003ch2\u003eKeep it Simple\u003c/h2\u003e\n\u003cp\u003eKeep your Smart Contract code simple. Smart Contracts that try to be too clever often have unintended side-effects or functionality. Keeping a Smart Contract simple also means that the surface area for attacks is smaller.\u003c/p\u003e\n\u003ch2\u003eWrite Small Functions\u003c/h2\u003e\n\u003cp\u003eWrite small functions that do one thing. Many Smart Contracts will have many small functions that can be composed together, rather than one large function that does everything. This helps keep the code readable, making it easier to understand and secure.\u003c/p\u003e\n\u003ch2\u003eLinting\u003c/h2\u003e\n\u003cp\u003eLint your code. Smart Contracts written in Solidity have tools already written that can help catch common errors via linting. The easiest linters to set up just help improve formatting, but some can help you write more secure code by letting your know when functions have been deprecated or marked as insecure.\u003c/p\u003e\n\u003ch2\u003eUnit Tests\u003c/h2\u003e\n\u003cp\u003eUnit test your code. The best unit tests you can write for Smart Contracts are validating what users shouldn‚Äôt be able to do. As an example, make sure unauthorized accounts cannot withdraw assets from your contract. These are sometimes called \u003cstrong\u003enegative\u003c/strong\u003e tests and they can be even more important than your typical that validate your functions do what you expect them to do. These tests check that they fail in the correct way when misused.\u003c/p\u003e\n\u003ch2\u003eScan for Security Vulnerabilities\u003c/h2\u003e\n\u003cp\u003eScan your code for security vulnerabilities. This is pretty self-explanatory. Many Smart Contract toolchains provide scanning tools to check your Smart Contract code.\u003c/p\u003e\n\u003cp\u003eThere are a few ways to surface security issues in Ethereum Smart Contracts. One way is to use \u003ca href=\"https://github.com/crytic/slither\"\u003eslither\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003enpm install slither\nslither .\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis may take a while to run, but it will scan the compiles contracts for security issues.\u003c/p\u003e\n\u003ch2\u003eCompliance\u003c/h2\u003e\n\u003cp\u003eFor Ethereum Smart Contracts, you can also use \u003ca href=\"https://github.com/crytic/slither\"\u003eslither\u003c/a\u003e to check the compliance of your ERC20 token or ERC721 contracts. Running this check will verify that your contract implements the expected interfaces of the given contracts.\u003c/p\u003e\n\u003ch2\u003eWrapping it Up\u003c/h2\u003e\n\u003cp\u003eSecurity is a major consideration in any application, but Smart Contracts pose a new type of attack vector for malicious users. Smart Contracts often interact with pools of cryptocurrency, NFTs, and other blockchain assets that make them new targets for attackers. It‚Äôs important when writing Smart Contracts to always make sure the contract fails correctly, even more-so than completing actions successfully.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    strong: \"strong\",\n    a: \"a\",\n    pre: \"pre\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"The crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it‚Äôs important to make sure the Smart Contract is secure and follows best practices.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In general, the best practices around Smart Contracts are the same for writing secure code in general.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Keep it Simple\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Keep your Smart Contract code simple. Smart Contracts that try to be too clever often have unintended side-effects or functionality. Keeping a Smart Contract simple also means that the surface area for attacks is smaller.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Write Small Functions\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Write small functions that do one thing. Many Smart Contracts will have many small functions that can be composed together, rather than one large function that does everything. This helps keep the code readable, making it easier to understand and secure.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Linting\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Lint your code. Smart Contracts written in Solidity have tools already written that can help catch common errors via linting. The easiest linters to set up just help improve formatting, but some can help you write more secure code by letting your know when functions have been deprecated or marked as insecure.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Unit Tests\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Unit test your code. The best unit tests you can write for Smart Contracts are validating what users shouldn‚Äôt be able to do. As an example, make sure unauthorized accounts cannot withdraw assets from your contract. These are sometimes called \", _jsx(_components.strong, {\n        children: \"negative\"\n      }), \" tests and they can be even more important than your typical that validate your functions do what you expect them to do. These tests check that they fail in the correct way when misused.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Scan for Security Vulnerabilities\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Scan your code for security vulnerabilities. This is pretty self-explanatory. Many Smart Contract toolchains provide scanning tools to check your Smart Contract code.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"There are a few ways to surface security issues in Ethereum Smart Contracts. One way is to use \", _jsx(_components.a, {\n        href: \"https://github.com/crytic/slither\",\n        children: \"slither\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"npm install slither\\nslither .\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This may take a while to run, but it will scan the compiles contracts for security issues.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Compliance\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For Ethereum Smart Contracts, you can also use \", _jsx(_components.a, {\n        href: \"https://github.com/crytic/slither\",\n        children: \"slither\"\n      }), \" to check the compliance of your ERC20 token or ERC721 contracts. Running this check will verify that your contract implements the expected interfaces of the given contracts.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Wrapping it Up\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Security is a major consideration in any application, but Smart Contracts pose a new type of attack vector for malicious users. Smart Contracts often interact with pools of cryptocurrency, NFTs, and other blockchain assets that make them new targets for attackers. It‚Äôs important when writing Smart Contracts to always make sure the contract fails correctly, even more-so than completing actions successfully.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nThe crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it‚Äôs important to make sure the Smart Contract is secure and follows best practices.","excerptHTML":"\u003cp\u003eThe crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it‚Äôs important to make sure the Smart Contract is secure and follows best practices.\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\"\n  }, props.components);\n  return _jsx(_components.p, {\n    children: \"The crypto craze has died down, but if you are working on Smart Contracts or thinking about creating a new blockchain projects, security is a huge part of making sure the project is successful. Since Smart Contracts often interact with cryptocurrencies, blockchain assets, or other tokens, it‚Äôs important to make sure the Smart Contract is secure and follows best practices.\"\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["ethereum","smart-contracts","security"]},{"slug":"2023-08-10-get-class","date":"2023-08-10","title":"Forbidden Typescript: Get Class Name","frontmatter":{"title":"Forbidden Typescript: Get Class Name","tags":["typescript"]},"contentRaw":"\nWe don‚Äôt get a lot of information using `typeof` in JavaScript or TypeScript. At most, it tells us whether a value is `undefined`, `number`, `string`, or `object`. If you want to get the class name using a function, you can use the following extended version of `classOf` that is originally from ‚ÄúJavaScript: The Definitive Guide‚Äù:\n\n```tsx\nfunction classOf(obj: unknown) {\n    if (obj === null) return \"Null\";\n    if (typeof obj === \"undefined\") return \"Undefined\";\n\n    if (typeof obj === 'object') {\n        // Warning: this won't work if your Typescript is minified and class names are mangled.\n        return (obj as object).constructor.name;\n    }\n\n    if (typeof obj === 'function') {\n        // Warning: this won't work if your Typescript is minified and function names are mangled.\n        const possibleName = (obj as CallableFunction).name;\n        if (possibleName) {\n            return possibleName;\n        }\n    }\n\n    return Object.prototype.toString.call(obj).slice(8, -1);\n}\n\nconsole.log(classOf(null)); // \"Null\"\nconsole.log(classOf(undefined)); // \"Undefined\"\nconsole.log(classOf(1)); // \"Number\"\nconsole.log(classOf(\"foobar\")); // \"String\"\nconsole.log(classOf({})); // \"Object\"\nconsole.log(classOf([])); // \"Array\"\nconsole.log(classOf(new Date()))\n\nclass Test {}\nconsole.log(classOf(new Test())); // \"Test\"\n\nfunction test() {}\nconsole.log(classOf(test)); // \"test\"\n\nconsole.log(classOf(function () {})) // \"Function\"\n```\n\n[Playground Link](https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABBANgQwM4YPLABRwBGAVgFyLgDWYcA7mAJSIDeAUIh4jMIgSYgF4hiMCBQomAJwCmUEJKQAiAHJiUigNztO3XlACeAB2lweRYoOGLwAE2nAYYaTcVTZ8pQFUwdh05da2hy6eAbGpojmlgKIAOTm0tCxTGycaYgA9BmIAOpoCo4A5uRQABYwGIi0CLFQVXCSlFw8+nDyiAAqRtIYEJIwhnUViAC2jtwwzohoPsjoWCJoIz3TMqMzhSjOAHRB6TJyCrxRmJEkiVAM2xAIGFCSINAN22BL0lppAL6seyFhJmZ+EIYrFQJBYDUUns0llcvkwEUSuVKtUwLV6o1mohWu0usZev1BlxKmMEQ4pjMbIgwdB4EhXstKvlpOswJsdtDODcwHdEIY4FgYIQtso3oJjvxTgBhNDiNDC6QAMXAtIQVwZ705wR4eH5goVouWUPSJsQBw8fIFGCFIreH1N3y+PzS5qO2HO0G2hkkcCgvu62z9AGV7kVrrKUHxiFcMCgYBBpHgABwAGkQAFoAIwMLTfVjcjBwLbbFBwQp4VCYHD4UTiBg5zLZFRqRT525F6QlssV+bVvC2eyOZz1jSNxCKby+IcuNs8jtd8uVrC4PDZhuw5sjQjSSStgvz0uL3srxTAOBEfKuddNkP9Nl79vFw89qsr5ifEdjxTu4gXB9zp9uyXPsAG0AF1Pw3ABBSRJDQfR-0LQCj1fGtpFoRAABE0CgRN6wYH5gM6Ho6nfWckM7Z9gJXJwMI6Ei8Hw0cN3ou5W1YGkISQXC7kYlhvn3ZCX2XfAeMua9xzE9jBMooDj3wTi6V4FIPyYDdlXBOlFCAA)\n\nThis `classOf` function works for any value, including numbers, strings, booleans, classes, and functions. It will return the best name for that given value that is passed. If the object has a constructor name, that value will be returned. If that value is a function, the name of that function will be returned.\n\n## Takeaways\n\nUnfortunately, during some transpilation steps or code compression, these names get mangled or removed completely, so it‚Äôs best not to rely on the class‚Äôs actual name directly. Instead `instanceof` should be used, or a static name attribute that cannot be modified.\n","contentHTML":"\u003cp\u003eWe don‚Äôt get a lot of information using \u003ccode\u003etypeof\u003c/code\u003e in JavaScript or TypeScript. At most, it tells us whether a value is \u003ccode\u003eundefined\u003c/code\u003e, \u003ccode\u003enumber\u003c/code\u003e, \u003ccode\u003estring\u003c/code\u003e, or \u003ccode\u003eobject\u003c/code\u003e. If you want to get the class name using a function, you can use the following extended version of \u003ccode\u003eclassOf\u003c/code\u003e that is originally from ‚ÄúJavaScript: The Definitive Guide‚Äù:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003efunction classOf(obj: unknown) {\n    if (obj === null) return \u0026quot;Null\u0026quot;;\n    if (typeof obj === \u0026quot;undefined\u0026quot;) return \u0026quot;Undefined\u0026quot;;\n\n    if (typeof obj === \u0026#x27;object\u0026#x27;) {\n        // Warning: this won\u0026#x27;t work if your Typescript is minified and class names are mangled.\n        return (obj as object).constructor.name;\n    }\n\n    if (typeof obj === \u0026#x27;function\u0026#x27;) {\n        // Warning: this won\u0026#x27;t work if your Typescript is minified and function names are mangled.\n        const possibleName = (obj as CallableFunction).name;\n        if (possibleName) {\n            return possibleName;\n        }\n    }\n\n    return Object.prototype.toString.call(obj).slice(8, -1);\n}\n\nconsole.log(classOf(null)); // \u0026quot;Null\u0026quot;\nconsole.log(classOf(undefined)); // \u0026quot;Undefined\u0026quot;\nconsole.log(classOf(1)); // \u0026quot;Number\u0026quot;\nconsole.log(classOf(\u0026quot;foobar\u0026quot;)); // \u0026quot;String\u0026quot;\nconsole.log(classOf({})); // \u0026quot;Object\u0026quot;\nconsole.log(classOf([])); // \u0026quot;Array\u0026quot;\nconsole.log(classOf(new Date()))\n\nclass Test {}\nconsole.log(classOf(new Test())); // \u0026quot;Test\u0026quot;\n\nfunction test() {}\nconsole.log(classOf(test)); // \u0026quot;test\u0026quot;\n\nconsole.log(classOf(function () {})) // \u0026quot;Function\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABBANgQwM4YPLABRwBGAVgFyLgDWYcA7mAJSIDeAUIh4jMIgSYgF4hiMCBQomAJwCmUEJKQAiAHJiUigNztO3XlACeAB2lweRYoOGLwAE2nAYYaTcVTZ8pQFUwdh05da2hy6eAbGpojmlgKIAOTm0tCxTGycaYgA9BmIAOpoCo4A5uRQABYwGIi0CLFQVXCSlFw8+nDyiAAqRtIYEJIwhnUViAC2jtwwzohoPsjoWCJoIz3TMqMzhSjOAHRB6TJyCrxRmJEkiVAM2xAIGFCSINAN22BL0lppAL6seyFhJmZ+EIYrFQJBYDUUns0llcvkwEUSuVKtUwLV6o1mohWu0usZev1BlxKmMEQ4pjMbIgwdB4EhXstKvlpOswJsdtDODcwHdEIY4FgYIQtso3oJjvxTgBhNDiNDC6QAMXAtIQVwZ705wR4eH5goVouWUPSJsQBw8fIFGCFIreH1N3y+PzS5qO2HO0G2hkkcCgvu62z9AGV7kVrrKUHxiFcMCgYBBpHgABwAGkQAFoAIwMLTfVjcjBwLbbFBwQp4VCYHD4UTiBg5zLZFRqRT525F6QlssV+bVvC2eyOZz1jSNxCKby+IcuNs8jtd8uVrC4PDZhuw5sjQjSSStgvz0uL3srxTAOBEfKuddNkP9Nl79vFw89qsr5ifEdjxTu4gXB9zp9uyXPsAG0AF1Pw3ABBSRJDQfR-0LQCj1fGtpFoRAABE0CgRN6wYH5gM6Ho6nfWckM7Z9gJXJwMI6Ei8Hw0cN3ou5W1YGkISQXC7kYlhvn3ZCX2XfAeMua9xzE9jBMooDj3wTi6V4FIPyYDdlXBOlFCAA\"\u003ePlayground Link\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis \u003ccode\u003eclassOf\u003c/code\u003e function works for any value, including numbers, strings, booleans, classes, and functions. It will return the best name for that given value that is passed. If the object has a constructor name, that value will be returned. If that value is a function, the name of that function will be returned.\u003c/p\u003e\n\u003ch2\u003eTakeaways\u003c/h2\u003e\n\u003cp\u003eUnfortunately, during some transpilation steps or code compression, these names get mangled or removed completely, so it‚Äôs best not to rely on the class‚Äôs actual name directly. Instead \u003ccode\u003einstanceof\u003c/code\u003e should be used, or a static name attribute that cannot be modified.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    pre: \"pre\",\n    a: \"a\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"We don‚Äôt get a lot of information using \", _jsx(_components.code, {\n        children: \"typeof\"\n      }), \" in JavaScript or TypeScript. At most, it tells us whether a value is \", _jsx(_components.code, {\n        children: \"undefined\"\n      }), \", \", _jsx(_components.code, {\n        children: \"number\"\n      }), \", \", _jsx(_components.code, {\n        children: \"string\"\n      }), \", or \", _jsx(_components.code, {\n        children: \"object\"\n      }), \". If you want to get the class name using a function, you can use the following extended version of \", _jsx(_components.code, {\n        children: \"classOf\"\n      }), \" that is originally from ‚ÄúJavaScript: The Definitive Guide‚Äù:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function classOf(obj: unknown) {\\n    if (obj === null) return \\\"Null\\\";\\n    if (typeof obj === \\\"undefined\\\") return \\\"Undefined\\\";\\n\\n    if (typeof obj === 'object') {\\n        // Warning: this won't work if your Typescript is minified and class names are mangled.\\n        return (obj as object).constructor.name;\\n    }\\n\\n    if (typeof obj === 'function') {\\n        // Warning: this won't work if your Typescript is minified and function names are mangled.\\n        const possibleName = (obj as CallableFunction).name;\\n        if (possibleName) {\\n            return possibleName;\\n        }\\n    }\\n\\n    return Object.prototype.toString.call(obj).slice(8, -1);\\n}\\n\\nconsole.log(classOf(null)); // \\\"Null\\\"\\nconsole.log(classOf(undefined)); // \\\"Undefined\\\"\\nconsole.log(classOf(1)); // \\\"Number\\\"\\nconsole.log(classOf(\\\"foobar\\\")); // \\\"String\\\"\\nconsole.log(classOf({})); // \\\"Object\\\"\\nconsole.log(classOf([])); // \\\"Array\\\"\\nconsole.log(classOf(new Date()))\\n\\nclass Test {}\\nconsole.log(classOf(new Test())); // \\\"Test\\\"\\n\\nfunction test() {}\\nconsole.log(classOf(test)); // \\\"test\\\"\\n\\nconsole.log(classOf(function () {})) // \\\"Function\\\"\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABBANgQwM4YPLABRwBGAVgFyLgDWYcA7mAJSIDeAUIh4jMIgSYgF4hiMCBQomAJwCmUEJKQAiAHJiUigNztO3XlACeAB2lweRYoOGLwAE2nAYYaTcVTZ8pQFUwdh05da2hy6eAbGpojmlgKIAOTm0tCxTGycaYgA9BmIAOpoCo4A5uRQABYwGIi0CLFQVXCSlFw8+nDyiAAqRtIYEJIwhnUViAC2jtwwzohoPsjoWCJoIz3TMqMzhSjOAHRB6TJyCrxRmJEkiVAM2xAIGFCSINAN22BL0lppAL6seyFhJmZ+EIYrFQJBYDUUns0llcvkwEUSuVKtUwLV6o1mohWu0usZev1BlxKmMEQ4pjMbIgwdB4EhXstKvlpOswJsdtDODcwHdEIY4FgYIQtso3oJjvxTgBhNDiNDC6QAMXAtIQVwZ705wR4eH5goVouWUPSJsQBw8fIFGCFIreH1N3y+PzS5qO2HO0G2hkkcCgvu62z9AGV7kVrrKUHxiFcMCgYBBpHgABwAGkQAFoAIwMLTfVjcjBwLbbFBwQp4VCYHD4UTiBg5zLZFRqRT525F6QlssV+bVvC2eyOZz1jSNxCKby+IcuNs8jtd8uVrC4PDZhuw5sjQjSSStgvz0uL3srxTAOBEfKuddNkP9Nl79vFw89qsr5ifEdjxTu4gXB9zp9uyXPsAG0AF1Pw3ABBSRJDQfR-0LQCj1fGtpFoRAABE0CgRN6wYH5gM6Ho6nfWckM7Z9gJXJwMI6Ei8Hw0cN3ou5W1YGkISQXC7kYlhvn3ZCX2XfAeMua9xzE9jBMooDj3wTi6V4FIPyYDdlXBOlFCAA\",\n        children: \"Playground Link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This \", _jsx(_components.code, {\n        children: \"classOf\"\n      }), \" function works for any value, including numbers, strings, booleans, classes, and functions. It will return the best name for that given value that is passed. If the object has a constructor name, that value will be returned. If that value is a function, the name of that function will be returned.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaways\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Unfortunately, during some transpilation steps or code compression, these names get mangled or removed completely, so it‚Äôs best not to rely on the class‚Äôs actual name directly. Instead \", _jsx(_components.code, {\n        children: \"instanceof\"\n      }), \" should be used, or a static name attribute that cannot be modified.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nWe don‚Äôt get a lot of information using `typeof` in JavaScript or TypeScript. At most, it tells us whether a value is `undefined`, `number`, `string`, or `object`. If you want to get the class name using a function, you can use the following extended version of `classOf` that is originally from ‚ÄúJavaScript: The Definitive Guide‚Äù:","excerptHTML":"\u003cp\u003eWe don‚Äôt get a lot of information using \u003ccode\u003etypeof\u003c/code\u003e in JavaScript or TypeScript. At most, it tells us whether a value is \u003ccode\u003eundefined\u003c/code\u003e, \u003ccode\u003enumber\u003c/code\u003e, \u003ccode\u003estring\u003c/code\u003e, or \u003ccode\u003eobject\u003c/code\u003e. If you want to get the class name using a function, you can use the following extended version of \u003ccode\u003eclassOf\u003c/code\u003e that is originally from ‚ÄúJavaScript: The Definitive Guide‚Äù:\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"We don‚Äôt get a lot of information using \", _jsx(_components.code, {\n      children: \"typeof\"\n    }), \" in JavaScript or TypeScript. At most, it tells us whether a value is \", _jsx(_components.code, {\n      children: \"undefined\"\n    }), \", \", _jsx(_components.code, {\n      children: \"number\"\n    }), \", \", _jsx(_components.code, {\n      children: \"string\"\n    }), \", or \", _jsx(_components.code, {\n      children: \"object\"\n    }), \". If you want to get the class name using a function, you can use the following extended version of \", _jsx(_components.code, {\n      children: \"classOf\"\n    }), \" that is originally from ‚ÄúJavaScript: The Definitive Guide‚Äù:\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-09-enumerating-properties","date":"2023-08-09","title":"Forbidden Typescript: Enumerating Properties","frontmatter":{"title":"Forbidden Typescript: Enumerating Properties","tags":["typescript"]},"contentRaw":"\nIn [‚ÄúJavaScript: The Definitive Guide‚Äù](https://amzn.to/3rV5Xov), there are functions described in **6.5 Enumerating Properties** that probably shouldn‚Äôt be used in production code because they modify their input parameters: `extend`, `merge`, `restrict`, and `subtract`.\n\nLet‚Äôs re-create each one using more modern practices in Typescript that don‚Äôt modify the input parameters:\n\n```tsx\n/**\n * Create a new object that returns the properties of target, overwritten with the properties in props\n */\nfunction extend\u003cT extends object, P extends object\u003e(target: T, props: P): T \u0026 P {\n    return {...target, ...props};\n}\n```\n\nEven in a more modern implementation, I would never recommend this. It is almost always easier to write `{...a, ...b}` inline and have its meaning be more clear.\n\nNext we have merge, not to be confused with extend:\n\n```tsx\n/**\n * Create a new object that returns all the properties of target and props, but the properties\n * in target are left alone.\n */\nfunction merge\u003cT extends object, P extends object\u003e(target: T, props: P): T \u0026 P {\n    return {...props, ...target};\n}\n```\n\nSame thing here, even with a more type-safe implementation, it‚Äôs almost always more clear to have an inline spread of `{...b, ...a}`.\n\nA more interesting function implementation is `restrict`:\n\n```tsx\n/**\n * Create a new object that returns all the values in target that also exist in props.\n */\nfunction restrict\u003cP extends object, T extends P\u003e(target: T, props: P): Pick\u003cT, keyof P\u003e {\n    const t: Partial\u003cT\u003e = { ...target };\n\n    for (let key in target) {\n        if (!(key in props)) {\n            delete t[key];\n        }\n    }\n\n    return t as Pick\u003cT, keyof P\u003e;\n}\n\nconst obj1 = { a: 123, b: 222 };\nconst obj2 = { b: 0 };\n\nconsole.log(restrict(obj1, obj2)); // { b: 222 }\n```\n\nHere we end up cloning our target object in order to delete keys from it later. An alternative approach might be to only construct the object with keys in props in the first place. This implementation is at least type-safe and will give you the correct typings for the object returned from `restrict`.\n\nLastly, here is our type-safe version of `subtract`:\n\n```tsx\n/**\n * Create a new object that returns all the values in target that do not exist in props.\n */\nfunction subtract\u003cT extends object, P extends object\u003e(target: T, props: P): Omit\u003cT, keyof P\u003e {\n    const t: Partial\u003cT\u003e = { ...target };\n\n    for (let key in props) {\n        if (key in t) {\n            delete t[key as unknown as keyof T];\n        }\n    }\n\n    return t as Omit\u003cT, keyof P\u003e;\n}\n\nconsole.log(subtract(obj1, obj2)); // { a: 123 }\n```\n\nBoth the `restrict` and `subtract` make use of type assertions to tell the compiler we know the actual types of the objects and keys when we are removing keys. Without these assertions, `t` is still a `Partial\u003cT\u003e`, even after we delete the keys from the object.\n\n## Takeaway\n\nIt‚Äôs almost always more clear and more type-safe to merge objects using inline spread notation than trying to use a clever utility. There are cases though, like `restrict` and `subtract` where we can leverage the type system to write safer code. There is always a balance to find when trying to write utilities between making something easier for engineers, and adding additional compile time safety.\n","contentHTML":"\u003cp\u003eIn \u003ca href=\"https://amzn.to/3rV5Xov\"\u003e‚ÄúJavaScript: The Definitive Guide‚Äù\u003c/a\u003e, there are functions described in \u003cstrong\u003e6.5 Enumerating Properties\u003c/strong\u003e that probably shouldn‚Äôt be used in production code because they modify their input parameters: \u003ccode\u003eextend\u003c/code\u003e, \u003ccode\u003emerge\u003c/code\u003e, \u003ccode\u003erestrict\u003c/code\u003e, and \u003ccode\u003esubtract\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eLet‚Äôs re-create each one using more modern practices in Typescript that don‚Äôt modify the input parameters:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e/**\n * Create a new object that returns the properties of target, overwritten with the properties in props\n */\nfunction extend\u0026lt;T extends object, P extends object\u0026gt;(target: T, props: P): T \u0026amp; P {\n    return {...target, ...props};\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eEven in a more modern implementation, I would never recommend this. It is almost always easier to write \u003ccode\u003e{...a, ...b}\u003c/code\u003e inline and have its meaning be more clear.\u003c/p\u003e\n\u003cp\u003eNext we have merge, not to be confused with extend:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e/**\n * Create a new object that returns all the properties of target and props, but the properties\n * in target are left alone.\n */\nfunction merge\u0026lt;T extends object, P extends object\u0026gt;(target: T, props: P): T \u0026amp; P {\n    return {...props, ...target};\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSame thing here, even with a more type-safe implementation, it‚Äôs almost always more clear to have an inline spread of \u003ccode\u003e{...b, ...a}\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eA more interesting function implementation is \u003ccode\u003erestrict\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e/**\n * Create a new object that returns all the values in target that also exist in props.\n */\nfunction restrict\u0026lt;P extends object, T extends P\u0026gt;(target: T, props: P): Pick\u0026lt;T, keyof P\u0026gt; {\n    const t: Partial\u0026lt;T\u0026gt; = { ...target };\n\n    for (let key in target) {\n        if (!(key in props)) {\n            delete t[key];\n        }\n    }\n\n    return t as Pick\u0026lt;T, keyof P\u0026gt;;\n}\n\nconst obj1 = { a: 123, b: 222 };\nconst obj2 = { b: 0 };\n\nconsole.log(restrict(obj1, obj2)); // { b: 222 }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere we end up cloning our target object in order to delete keys from it later. An alternative approach might be to only construct the object with keys in props in the first place. This implementation is at least type-safe and will give you the correct typings for the object returned from \u003ccode\u003erestrict\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eLastly, here is our type-safe version of \u003ccode\u003esubtract\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e/**\n * Create a new object that returns all the values in target that do not exist in props.\n */\nfunction subtract\u0026lt;T extends object, P extends object\u0026gt;(target: T, props: P): Omit\u0026lt;T, keyof P\u0026gt; {\n    const t: Partial\u0026lt;T\u0026gt; = { ...target };\n\n    for (let key in props) {\n        if (key in t) {\n            delete t[key as unknown as keyof T];\n        }\n    }\n\n    return t as Omit\u0026lt;T, keyof P\u0026gt;;\n}\n\nconsole.log(subtract(obj1, obj2)); // { a: 123 }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBoth the \u003ccode\u003erestrict\u003c/code\u003e and \u003ccode\u003esubtract\u003c/code\u003e make use of type assertions to tell the compiler we know the actual types of the objects and keys when we are removing keys. Without these assertions, \u003ccode\u003et\u003c/code\u003e is still a \u003ccode\u003ePartial\u0026lt;T\u0026gt;\u003c/code\u003e, even after we delete the keys from the object.\u003c/p\u003e\n\u003ch2\u003eTakeaway\u003c/h2\u003e\n\u003cp\u003eIt‚Äôs almost always more clear and more type-safe to merge objects using inline spread notation than trying to use a clever utility. There are cases though, like \u003ccode\u003erestrict\u003c/code\u003e and \u003ccode\u003esubtract\u003c/code\u003e where we can leverage the type system to write safer code. There is always a balance to find when trying to write utilities between making something easier for engineers, and adding additional compile time safety.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    strong: \"strong\",\n    code: \"code\",\n    pre: \"pre\",\n    h2: \"h2\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"In \", _jsx(_components.a, {\n        href: \"https://amzn.to/3rV5Xov\",\n        children: \"‚ÄúJavaScript: The Definitive Guide‚Äù\"\n      }), \", there are functions described in \", _jsx(_components.strong, {\n        children: \"6.5 Enumerating Properties\"\n      }), \" that probably shouldn‚Äôt be used in production code because they modify their input parameters: \", _jsx(_components.code, {\n        children: \"extend\"\n      }), \", \", _jsx(_components.code, {\n        children: \"merge\"\n      }), \", \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \", and \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let‚Äôs re-create each one using more modern practices in Typescript that don‚Äôt modify the input parameters:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns the properties of target, overwritten with the properties in props\\n */\\nfunction extend\u003cT extends object, P extends object\u003e(target: T, props: P): T \u0026 P {\\n    return {...target, ...props};\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Even in a more modern implementation, I would never recommend this. It is almost always easier to write \", _jsx(_components.code, {\n        children: \"{...a, ...b}\"\n      }), \" inline and have its meaning be more clear.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Next we have merge, not to be confused with extend:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns all the properties of target and props, but the properties\\n * in target are left alone.\\n */\\nfunction merge\u003cT extends object, P extends object\u003e(target: T, props: P): T \u0026 P {\\n    return {...props, ...target};\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Same thing here, even with a more type-safe implementation, it‚Äôs almost always more clear to have an inline spread of \", _jsx(_components.code, {\n        children: \"{...b, ...a}\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"A more interesting function implementation is \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns all the values in target that also exist in props.\\n */\\nfunction restrict\u003cP extends object, T extends P\u003e(target: T, props: P): Pick\u003cT, keyof P\u003e {\\n    const t: Partial\u003cT\u003e = { ...target };\\n\\n    for (let key in target) {\\n        if (!(key in props)) {\\n            delete t[key];\\n        }\\n    }\\n\\n    return t as Pick\u003cT, keyof P\u003e;\\n}\\n\\nconst obj1 = { a: 123, b: 222 };\\nconst obj2 = { b: 0 };\\n\\nconsole.log(restrict(obj1, obj2)); // { b: 222 }\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here we end up cloning our target object in order to delete keys from it later. An alternative approach might be to only construct the object with keys in props in the first place. This implementation is at least type-safe and will give you the correct typings for the object returned from \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Lastly, here is our type-safe version of \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"/**\\n * Create a new object that returns all the values in target that do not exist in props.\\n */\\nfunction subtract\u003cT extends object, P extends object\u003e(target: T, props: P): Omit\u003cT, keyof P\u003e {\\n    const t: Partial\u003cT\u003e = { ...target };\\n\\n    for (let key in props) {\\n        if (key in t) {\\n            delete t[key as unknown as keyof T];\\n        }\\n    }\\n\\n    return t as Omit\u003cT, keyof P\u003e;\\n}\\n\\nconsole.log(subtract(obj1, obj2)); // { a: 123 }\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Both the \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \" make use of type assertions to tell the compiler we know the actual types of the objects and keys when we are removing keys. Without these assertions, \", _jsx(_components.code, {\n        children: \"t\"\n      }), \" is still a \", _jsx(_components.code, {\n        children: \"Partial\u003cT\u003e\"\n      }), \", even after we delete the keys from the object.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Takeaway\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"It‚Äôs almost always more clear and more type-safe to merge objects using inline spread notation than trying to use a clever utility. There are cases though, like \", _jsx(_components.code, {\n        children: \"restrict\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"subtract\"\n      }), \" where we can leverage the type system to write safer code. There is always a balance to find when trying to write utilities between making something easier for engineers, and adding additional compile time safety.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nIn [‚ÄúJavaScript: The Definitive Guide‚Äù](https://amzn.to/3rV5Xov), there are functions described in **6.5 Enumerating Properties** that probably shouldn‚Äôt be used in production code because they modify their input parameters: `extend`, `merge`, `restrict`, and `subtract`.","excerptHTML":"\u003cp\u003eIn \u003ca href=\"https://amzn.to/3rV5Xov\"\u003e‚ÄúJavaScript: The Definitive Guide‚Äù\u003c/a\u003e, there are functions described in \u003cstrong\u003e6.5 Enumerating Properties\u003c/strong\u003e that probably shouldn‚Äôt be used in production code because they modify their input parameters: \u003ccode\u003eextend\u003c/code\u003e, \u003ccode\u003emerge\u003c/code\u003e, \u003ccode\u003erestrict\u003c/code\u003e, and \u003ccode\u003esubtract\u003c/code\u003e.\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    strong: \"strong\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"In \", _jsx(_components.a, {\n      href: \"https://amzn.to/3rV5Xov\",\n      children: \"‚ÄúJavaScript: The Definitive Guide‚Äù\"\n    }), \", there are functions described in \", _jsx(_components.strong, {\n      children: \"6.5 Enumerating Properties\"\n    }), \" that probably shouldn‚Äôt be used in production code because they modify their input parameters: \", _jsx(_components.code, {\n      children: \"extend\"\n    }), \", \", _jsx(_components.code, {\n      children: \"merge\"\n    }), \", \", _jsx(_components.code, {\n      children: \"restrict\"\n    }), \", and \", _jsx(_components.code, {\n      children: \"subtract\"\n    }), \".\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-07-object-create","date":"2023-08-07","title":"Forbidden Typescript: Using Object.create to clone","frontmatter":{"title":"Forbidden Typescript: Using Object.create to clone","tags":["typescript"]},"contentRaw":"\nIn ‚ÄúJavascript: The Definitive Guide‚Äù there is an example that uses `Object.inherit` to inherit the prototype change. JavaScript defines a method `Object.create` that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\n\n```tsx\nfunction inherit\u003cT extends object\u003e(obj: T): T {\n    return Object.create(obj);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\nconst myObject = new MyObject(123);\nconst myClone = inherit(myObject);\n```\n\n[Playground Link](https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABDMALApgJxlAPAFUXQA8p0wATAZ0TgCMArdaAPgAp6GAuRfASh6EA3gChE4xJnRQQmJAHlGzKADoIUgIZkOjPgG4RAXxEiIAGw1UaAWQCeiptESiJiAA4g6ZmBEQaeYCAAtnRYBmISEAhUUJgg0HCYbP6IgSFYfM4RruJQqDBUKhqIALx+Bq7GxlFgMYhB9kpOZWDoAO6Idg7KbACMAEwAzPqm0VD1tgDCZgjopchoWDhsDd3QI6O1cGboKjMA5iuNjlD6iAD0585+PAODiNXR27sHR9OzZ5fOj1s7e3CHBrvVoLGIaSDoODATrHZSfK6xEDoERAA)\n\nHowever, we lied. Notice that in the above code, the `myClone` object was created without `a` being initialized.\n\n```tsx\nconsole.log(myObject); // { a: 123 }\nconsole.log(myClone); // {}\nconsole.log(myClone instanceof MyObject); // true\n```\n\nThis creates what is known as a *type-hole*: the Typescript compiler will not report any bugs when we try to use `myClone.a`.  That‚Äôs because we used `Object.create` which returns the `any` type. In the above example, if we tried to use `myClone.a` in a case where we expected a `number`, but got `undefined`, we can end up with runtime bugs that should have been caught by the compiler.\n\nWe can make the typings a little more clear by doing the following:\n\n```tsx\nfunction inherit\u003cT extends object\u003e(obj: T): Partial\u003cT\u003e {\n    return Object.create(obj);\n}\n```\n\nNow Typescript will report that the value of `myClone.a` might be undefined.\n\nLet‚Äôs improve this a bit more and create an object that inherits and freezes the data in the given object:\n\n```tsx\nfunction inheritAndFreeze\u003cT extends object\u003e(obj: T, values: Partial\u003cT\u003e): Readonly\u003cPartial\u003cT\u003e\u003e {\n    const properties: PropertyDescriptorMap = {};\n\n    Object.keys(obj).forEach((unsafeKey) =\u003e {\n        const key = unsafeKey as keyof T;\n        properties[key] = {\n            value: values[key] ?? undefined,\n            writable: false,\n            configurable: false,\n        };\n    })\n\n    return Object.create(obj, properties);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\n\nconst myObject = new MyObject(123);\nconst myClone = inheritAndFreeze(myObject, { a: 123 });\n\nconsole.log(myClone); // { a: 123 }\nmyClone.a = 999; // Would throw \"Cannot assign to read only property 'a' of object '#\u003cMyObject\u003e' \"\n```\n\n[Playground Link](https://www.typescriptlang.org/play?ssl=29\u0026ssc=102\u0026pln=1\u0026pc=1#code/GYVwdgxgLglg9mABDMALApgJxlAgmAEwDFN10AvdAHgBVF0APKdQgZ0TgCMArdaAPgAUXbgC5ENADSIAbgEMANiHStxABTmZYi2vwCU4gEro5BBAoCeVDVpg6a-fogDeAKEQfEEBKyiIADphw-liwKupBIVoWACIqENj+UHCYALJy-ogAvC4AvgDcru6eAPI8fFAAdADW6Baswjx6lcApAKJyEKiCguCscsDoANJ1etlObp5TXj5+tRbZiH0Dw3WIcuzzcMAShdOegcGhMCoA2vMAuouT+9PySuji98qs53VXAPwfS4TowCjoAiSYq3TwAd2wUDknAUj0QwEUrHQwIAkGj0d4wP8AOYgTDQ2HiBEKJHA0EFEGIXJ6IpTUhQPFIMq8aCVBImZiNbjSQ5RMKsPSFXJFCAKDbsVIWZkVFyU-wgGEwCDrcRgEAAW04WEKlMxvkwIGgKUEclVGq1mDGN32UFQMFYlTkizke08wuFrj1fnVUvK0EWYHQYMQkul0EEAEYAEwAZkFntmiB9AGEFAh0IsUBhIfhiKQKOhBD6w1BpM4VYhozGqfGE2BWHBYZU09iixZU+nBYgAPTdkO+ll+ZzCvWN9DNuCtlNpwOOru9yux1wL6fpx2LACcW-yPb7AHU4CAFARELagsGAETJuRgMBwPzimDYpDJRCkUwcMCWAKRUILADkcj-hwOwiDK-4AMRUKGfpQPwwEXkAA)\n\nIf we didn‚Äôt mark the return value as `Readonly\u003cPartial\u003cT\u003e\u003e`, and instead just had `Partial\u003cT\u003e` we would once again have a type-hole and `myClone.a = 999;` would be allowed by Typescript, but would throw an exception at runtime because property a is read only as a runtime constraint.\n\n## The Takeaway\n\nLet‚Äôs step back and really look at what `inherit` was doing. All it gave us was a template object, and if you read on [MDN about Inheritance and prototype chaining](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain):\n\n\u003e You may also see some legacy code using¬†`[Object.create()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)`¬†to build the inheritance chain. However, because this reassigns the¬†`prototype`¬†property and removes the¬†`[constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor)`¬†property, it can be more error-prone, while performance gains may not be apparent if the constructors haven't created any instances yet.\n\nThe key here is to be wary of using utility functions built into the language that return the `any` type. Be careful what the Typescript constraints are and make sure you don‚Äôt have any type-holes when you are using these generic functions.\n","contentHTML":"\u003cp\u003eIn ‚ÄúJavascript: The Definitive Guide‚Äù there is an example that uses \u003ccode\u003eObject.inherit\u003c/code\u003e to inherit the prototype change. JavaScript defines a method \u003ccode\u003eObject.create\u003c/code\u003e that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003efunction inherit\u0026lt;T extends object\u0026gt;(obj: T): T {\n    return Object.create(obj);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\nconst myObject = new MyObject(123);\nconst myClone = inherit(myObject);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABDMALApgJxlAPAFUXQA8p0wATAZ0TgCMArdaAPgAp6GAuRfASh6EA3gChE4xJnRQQmJAHlGzKADoIUgIZkOjPgG4RAXxEiIAGw1UaAWQCeiptESiJiAA4g6ZmBEQaeYCAAtnRYBmISEAhUUJgg0HCYbP6IgSFYfM4RruJQqDBUKhqIALx+Bq7GxlFgMYhB9kpOZWDoAO6Idg7KbACMAEwAzPqm0VD1tgDCZgjopchoWDhsDd3QI6O1cGboKjMA5iuNjlD6iAD0585+PAODiNXR27sHR9OzZ5fOj1s7e3CHBrvVoLGIaSDoODATrHZSfK6xEDoERAA\"\u003ePlayground Link\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHowever, we lied. Notice that in the above code, the \u003ccode\u003emyClone\u003c/code\u003e object was created without \u003ccode\u003ea\u003c/code\u003e being initialized.\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econsole.log(myObject); // { a: 123 }\nconsole.log(myClone); // {}\nconsole.log(myClone instanceof MyObject); // true\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis creates what is known as a \u003cem\u003etype-hole\u003c/em\u003e: the Typescript compiler will not report any bugs when we try to use \u003ccode\u003emyClone.a\u003c/code\u003e.  That‚Äôs because we used \u003ccode\u003eObject.create\u003c/code\u003e which returns the \u003ccode\u003eany\u003c/code\u003e type. In the above example, if we tried to use \u003ccode\u003emyClone.a\u003c/code\u003e in a case where we expected a \u003ccode\u003enumber\u003c/code\u003e, but got \u003ccode\u003eundefined\u003c/code\u003e, we can end up with runtime bugs that should have been caught by the compiler.\u003c/p\u003e\n\u003cp\u003eWe can make the typings a little more clear by doing the following:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003efunction inherit\u0026lt;T extends object\u0026gt;(obj: T): Partial\u0026lt;T\u0026gt; {\n    return Object.create(obj);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow Typescript will report that the value of \u003ccode\u003emyClone.a\u003c/code\u003e might be undefined.\u003c/p\u003e\n\u003cp\u003eLet‚Äôs improve this a bit more and create an object that inherits and freezes the data in the given object:\u003c/p\u003e\n\u003cdiv class=\"overflow-auto rounded bg-gray-200 p-4 font-mono text-sm dark:bg-gray-800 dark:text-gray-100\"\u003e\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003efunction inheritAndFreeze\u0026lt;T extends object\u0026gt;(obj: T, values: Partial\u0026lt;T\u0026gt;): Readonly\u0026lt;Partial\u0026lt;T\u0026gt;\u0026gt; {\n    const properties: PropertyDescriptorMap = {};\n\n    Object.keys(obj).forEach((unsafeKey) =\u0026gt; {\n        const key = unsafeKey as keyof T;\n        properties[key] = {\n            value: values[key] ?? undefined,\n            writable: false,\n            configurable: false,\n        };\n    })\n\n    return Object.create(obj, properties);\n}\n\nclass MyObject {\n    public a: number;\n\n    constructor(a: number) {\n        this.a = a;\n    }\n}\n\nconst myObject = new MyObject(123);\nconst myClone = inheritAndFreeze(myObject, { a: 123 });\n\nconsole.log(myClone); // { a: 123 }\nmyClone.a = 999; // Would throw \u0026quot;Cannot assign to read only property \u0026#x27;a\u0026#x27; of object \u0026#x27;#\u0026lt;MyObject\u0026gt;\u0026#x27; \u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.typescriptlang.org/play?ssl=29\u0026amp;ssc=102\u0026amp;pln=1\u0026amp;pc=1#code/GYVwdgxgLglg9mABDMALApgJxlAgmAEwDFN10AvdAHgBVF0APKdQgZ0TgCMArdaAPgAUXbgC5ENADSIAbgEMANiHStxABTmZYi2vwCU4gEro5BBAoCeVDVpg6a-fogDeAKEQfEEBKyiIADphw-liwKupBIVoWACIqENj+UHCYALJy-ogAvC4AvgDcru6eAPI8fFAAdADW6Baswjx6lcApAKJyEKiCguCscsDoANJ1etlObp5TXj5+tRbZiH0Dw3WIcuzzcMAShdOegcGhMCoA2vMAuouT+9PySuji98qs53VXAPwfS4TowCjoAiSYq3TwAd2wUDknAUj0QwEUrHQwIAkGj0d4wP8AOYgTDQ2HiBEKJHA0EFEGIXJ6IpTUhQPFIMq8aCVBImZiNbjSQ5RMKsPSFXJFCAKDbsVIWZkVFyU-wgGEwCDrcRgEAAW04WEKlMxvkwIGgKUEclVGq1mDGN32UFQMFYlTkizke08wuFrj1fnVUvK0EWYHQYMQkul0EEAEYAEwAZkFntmiB9AGEFAh0IsUBhIfhiKQKOhBD6w1BpM4VYhozGqfGE2BWHBYZU09iixZU+nBYgAPTdkO+ll+ZzCvWN9DNuCtlNpwOOru9yux1wL6fpx2LACcW-yPb7AHU4CAFARELagsGAETJuRgMBwPzimDYpDJRCkUwcMCWAKRUILADkcj-hwOwiDK-4AMRUKGfpQPwwEXkAA\"\u003ePlayground Link\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf we didn‚Äôt mark the return value as \u003ccode\u003eReadonly\u0026lt;Partial\u0026lt;T\u0026gt;\u0026gt;\u003c/code\u003e, and instead just had \u003ccode\u003ePartial\u0026lt;T\u0026gt;\u003c/code\u003e we would once again have a type-hole and \u003ccode\u003emyClone.a = 999;\u003c/code\u003e would be allowed by Typescript, but would throw an exception at runtime because property a is read only as a runtime constraint.\u003c/p\u003e\n\u003ch2\u003eThe Takeaway\u003c/h2\u003e\n\u003cp\u003eLet‚Äôs step back and really look at what \u003ccode\u003einherit\u003c/code\u003e was doing. All it gave us was a template object, and if you read on \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain\"\u003eMDN about Inheritance and prototype chaining\u003c/a\u003e:\u003c/p\u003e\n\u003cblockquote class=\"border-l-4 border-gray-300 pl-4\"\u003e\n\u003cp\u003eYou may also see some legacy code using¬†\u003ccode\u003e[Object.create()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\u003c/code\u003e¬†to build the inheritance chain. However, because this reassigns the¬†\u003ccode\u003eprototype\u003c/code\u003e¬†property and removes the¬†\u003ccode\u003e[constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor)\u003c/code\u003e¬†property, it can be more error-prone, while performance gains may not be apparent if the constructors haven\u0026#x27;t created any instances yet.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThe key here is to be wary of using utility functions built into the language that return the \u003ccode\u003eany\u003c/code\u003e type. Be careful what the Typescript constraints are and make sure you don‚Äôt have any type-holes when you are using these generic functions.\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    pre: \"pre\",\n    a: \"a\",\n    em: \"em\",\n    h2: \"h2\",\n    blockquote: \"blockquote\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"In ‚ÄúJavascript: The Definitive Guide‚Äù there is an example that uses \", _jsx(_components.code, {\n        children: \"Object.inherit\"\n      }), \" to inherit the prototype change. JavaScript defines a method \", _jsx(_components.code, {\n        children: \"Object.create\"\n      }), \" that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function inherit\u003cT extends object\u003e(obj: T): T {\\n    return Object.create(obj);\\n}\\n\\nclass MyObject {\\n    public a: number;\\n\\n    constructor(a: number) {\\n        this.a = a;\\n    }\\n}\\nconst myObject = new MyObject(123);\\nconst myClone = inherit(myObject);\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?#code/GYVwdgxgLglg9mABDMALApgJxlAPAFUXQA8p0wATAZ0TgCMArdaAPgAp6GAuRfASh6EA3gChE4xJnRQQmJAHlGzKADoIUgIZkOjPgG4RAXxEiIAGw1UaAWQCeiptESiJiAA4g6ZmBEQaeYCAAtnRYBmISEAhUUJgg0HCYbP6IgSFYfM4RruJQqDBUKhqIALx+Bq7GxlFgMYhB9kpOZWDoAO6Idg7KbACMAEwAzPqm0VD1tgDCZgjopchoWDhsDd3QI6O1cGboKjMA5iuNjlD6iAD0585+PAODiNXR27sHR9OzZ5fOj1s7e3CHBrvVoLGIaSDoODATrHZSfK6xEDoERAA\",\n        children: \"Playground Link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"However, we lied. Notice that in the above code, the \", _jsx(_components.code, {\n        children: \"myClone\"\n      }), \" object was created without \", _jsx(_components.code, {\n        children: \"a\"\n      }), \" being initialized.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"console.log(myObject); // { a: 123 }\\nconsole.log(myClone); // {}\\nconsole.log(myClone instanceof MyObject); // true\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This creates what is known as a \", _jsx(_components.em, {\n        children: \"type-hole\"\n      }), \": the Typescript compiler will not report any bugs when we try to use \", _jsx(_components.code, {\n        children: \"myClone.a\"\n      }), \".  That‚Äôs because we used \", _jsx(_components.code, {\n        children: \"Object.create\"\n      }), \" which returns the \", _jsx(_components.code, {\n        children: \"any\"\n      }), \" type. In the above example, if we tried to use \", _jsx(_components.code, {\n        children: \"myClone.a\"\n      }), \" in a case where we expected a \", _jsx(_components.code, {\n        children: \"number\"\n      }), \", but got \", _jsx(_components.code, {\n        children: \"undefined\"\n      }), \", we can end up with runtime bugs that should have been caught by the compiler.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We can make the typings a little more clear by doing the following:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function inherit\u003cT extends object\u003e(obj: T): Partial\u003cT\u003e {\\n    return Object.create(obj);\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now Typescript will report that the value of \", _jsx(_components.code, {\n        children: \"myClone.a\"\n      }), \" might be undefined.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let‚Äôs improve this a bit more and create an object that inherits and freezes the data in the given object:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-tsx\",\n        children: \"function inheritAndFreeze\u003cT extends object\u003e(obj: T, values: Partial\u003cT\u003e): Readonly\u003cPartial\u003cT\u003e\u003e {\\n    const properties: PropertyDescriptorMap = {};\\n\\n    Object.keys(obj).forEach((unsafeKey) =\u003e {\\n        const key = unsafeKey as keyof T;\\n        properties[key] = {\\n            value: values[key] ?? undefined,\\n            writable: false,\\n            configurable: false,\\n        };\\n    })\\n\\n    return Object.create(obj, properties);\\n}\\n\\nclass MyObject {\\n    public a: number;\\n\\n    constructor(a: number) {\\n        this.a = a;\\n    }\\n}\\n\\nconst myObject = new MyObject(123);\\nconst myClone = inheritAndFreeze(myObject, { a: 123 });\\n\\nconsole.log(myClone); // { a: 123 }\\nmyClone.a = 999; // Would throw \\\"Cannot assign to read only property 'a' of object '#\u003cMyObject\u003e' \\\"\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://www.typescriptlang.org/play?ssl=29\u0026ssc=102\u0026pln=1\u0026pc=1#code/GYVwdgxgLglg9mABDMALApgJxlAgmAEwDFN10AvdAHgBVF0APKdQgZ0TgCMArdaAPgAUXbgC5ENADSIAbgEMANiHStxABTmZYi2vwCU4gEro5BBAoCeVDVpg6a-fogDeAKEQfEEBKyiIADphw-liwKupBIVoWACIqENj+UHCYALJy-ogAvC4AvgDcru6eAPI8fFAAdADW6Baswjx6lcApAKJyEKiCguCscsDoANJ1etlObp5TXj5+tRbZiH0Dw3WIcuzzcMAShdOegcGhMCoA2vMAuouT+9PySuji98qs53VXAPwfS4TowCjoAiSYq3TwAd2wUDknAUj0QwEUrHQwIAkGj0d4wP8AOYgTDQ2HiBEKJHA0EFEGIXJ6IpTUhQPFIMq8aCVBImZiNbjSQ5RMKsPSFXJFCAKDbsVIWZkVFyU-wgGEwCDrcRgEAAW04WEKlMxvkwIGgKUEclVGq1mDGN32UFQMFYlTkizke08wuFrj1fnVUvK0EWYHQYMQkul0EEAEYAEwAZkFntmiB9AGEFAh0IsUBhIfhiKQKOhBD6w1BpM4VYhozGqfGE2BWHBYZU09iixZU+nBYgAPTdkO+ll+ZzCvWN9DNuCtlNpwOOru9yux1wL6fpx2LACcW-yPb7AHU4CAFARELagsGAETJuRgMBwPzimDYpDJRCkUwcMCWAKRUILADkcj-hwOwiDK-4AMRUKGfpQPwwEXkAA\",\n        children: \"Playground Link\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we didn‚Äôt mark the return value as \", _jsx(_components.code, {\n        children: \"Readonly\u003cPartial\u003cT\u003e\u003e\"\n      }), \", and instead just had \", _jsx(_components.code, {\n        children: \"Partial\u003cT\u003e\"\n      }), \" we would once again have a type-hole and \", _jsx(_components.code, {\n        children: \"myClone.a = 999;\"\n      }), \" would be allowed by Typescript, but would throw an exception at runtime because property a is read only as a runtime constraint.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"The Takeaway\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Let‚Äôs step back and really look at what \", _jsx(_components.code, {\n        children: \"inherit\"\n      }), \" was doing. All it gave us was a template object, and if you read on \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain\",\n        children: \"MDN about Inheritance and prototype chaining\"\n      }), \":\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"You may also see some legacy code using¬†\", _jsx(_components.code, {\n          children: \"[Object.create()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\"\n        }), \"¬†to build the inheritance chain. However, because this reassigns the¬†\", _jsx(_components.code, {\n          children: \"prototype\"\n        }), \"¬†property and removes the¬†\", _jsx(_components.code, {\n          children: \"[constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor)\"\n        }), \"¬†property, it can be more error-prone, while performance gains may not be apparent if the constructors haven't created any instances yet.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The key here is to be wary of using utility functions built into the language that return the \", _jsx(_components.code, {\n        children: \"any\"\n      }), \" type. Be careful what the Typescript constraints are and make sure you don‚Äôt have any type-holes when you are using these generic functions.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerptRaw":"\nIn ‚ÄúJavascript: The Definitive Guide‚Äù there is an example that uses `Object.inherit` to inherit the prototype change. JavaScript defines a method `Object.create` that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:","excerptHTML":"\u003cp\u003eIn ‚ÄúJavascript: The Definitive Guide‚Äù there is an example that uses \u003ccode\u003eObject.inherit\u003c/code\u003e to inherit the prototype change. JavaScript defines a method \u003ccode\u003eObject.create\u003c/code\u003e that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"In ‚ÄúJavascript: The Definitive Guide‚Äù there is an example that uses \", _jsx(_components.code, {\n      children: \"Object.inherit\"\n    }), \" to inherit the prototype change. JavaScript defines a method \", _jsx(_components.code, {\n      children: \"Object.create\"\n    }), \" that creates a new object using the given argument as the prototype of that object. Translating the examples from The Definitive Guide to Typescript, it looks like:\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["typescript"]},{"slug":"2023-08-06-data-on-the-wire","date":"2023-08-06","title":"Data on the Wire","frontmatter":{"title":"Data on the Wire","tags":["architecture"]},"contentRaw":"\nBack when [Meteor](https://www.meteor.com/) was in vogue, they popularized the concept of ‚ÄúData on the wire‚Äù. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\n\n\u003e Data on the wire refers mostly to the way that Meteor forms a websocket connection to the server on page load and then transfers the data needed over that connection.\n\u003e\n\u003e The websocket is a live connection and as the data changes, the updates are automatically pushed over the wire and the client updates in real time. (Similar to how many people can edit the same document simultaneously in Google Docs and see each others changes in real time)\n\u003e\n\n- [coagmano on Stackoverflow](https://stackoverflow.com/questions/48512242/in-meteor-what-does-data-on-the-wire-mean)\n\nThis idea was pretty interesting: a UI could always be considered up to date even if another client created a new row in the database. This is because Meteor would listen to the changelog of the MongoDB it was connected to, and then if a client was subscribed to the dataset that change belonged it, Meteor would push that change over the connected websocket.\n\nData on the wire enabled clients to stay up-to-date with any changes and create an amazing experience for users who would see changes instantly. For developers, this was also a huge win for prototyping applications.\n\nBut the problem with data on the wire is that the client can subscribe to a dataset with additional MongoDB filters, but the server now needs to keep track of what clients are subscribed to what subset of data.\n\nIf we start with a dataset `A`, and a user creates a new item `i`, then we know that if a user is subscribed to dataset `A`, we can just send the changes for `i` via a websocket.\n\n```mermaid\nsequenceDiagram\n    Client-\u003e\u003eServer: Subscribe to dataset A\n    MongoDB--\u003e\u003eServer: New item i was inserted into A\n    Server--\u003e\u003eClient: Push new item i via websocket\n```\n\nBut if we want to start scaling our servers up, then we must broadcast any change to dataset `A` to every service, and then each service must check if any websocket is subscribed to `A`:\n\n```mermaid\ngraph LR\n  MongoDB --\u003e Server1\n  Client --\u003e Server2\n  MongoDB --\u003e Server2\n  MongoDB --\u003e Server3 \n```\n\n(Technically, each server would either read from the MongoDB change stream, or have a service push an event to them that is listening to the change stream)\n\nNow, each Service needs to additionally check if the item `i` meets any additional filter criteria that each subscriber may have for dataset `A`.\n\nAs datasets grow and filters become more computationally expensive, this can cause a lot of processing and memory burden for each Server.\n\nThis is such a problem that it is even called out in the Meteor documentation: **Scaling Updates**.\n\n\u003e As previously mentioned, Meteor uses MongoDB‚Äôs Oplog to identify which changes to apply to which publication. Each change to the database is processed by every Meteor server, so frequent changes can result in high CPU usage across the board. At the same time, your database will come under higher load as all your servers keep fetching data from the oplog.\n\u003e\n\nI‚Äôve just thought about this recently since I had a conversation about keeping UI‚Äôs up-to-date with realtime data based on subscribing to that dataset via a websocket and it sounded eerily familiar to problems I have seen in the past.\n\nIn fact, similarly, I‚Äôve seen trouble with GraphQL Subscriptions having similar issues, since each server node now needs to identify when to push data back to a subscriber:\n\n\u003e GraphQL Subscriptions (GQLS) are a mechanism which allow clients to subscribe to changes in a piece of data from the server, and get notified whenever that data changes.\n\u003e\n\n[The relay spec](https://relay.dev/docs/v13.0.0/guided-tour/updating-data/graphql-subscriptions/) makes no mention of how a server might do this though. There is a handy tutorial by LogRocket on implementing a NodeJS server to handle subscriptions though: [GraphQL Subscriptions with NodeJS and Express](https://blog.logrocket.com/graphql-subscriptions-nodejs-express/).\n\nBut if you look at the diagrams, they seem awfully familiar‚Ä¶\n","contentHTML":"\u003cp\u003eBack when \u003ca href=\"https://www.meteor.com/\"\u003eMeteor\u003c/a\u003e was in vogue, they popularized the concept of ‚ÄúData on the wire‚Äù. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\u003c/p\u003e\n\u003cblockquote class=\"border-l-4 border-gray-300 pl-4\"\u003e\n\u003cp\u003eData on the wire refers mostly to the way that Meteor forms a websocket connection to the server on page load and then transfers the data needed over that connection.\u003c/p\u003e\n\u003cp\u003eThe websocket is a live connection and as the data changes, the updates are automatically pushed over the wire and the client updates in real time. (Similar to how many people can edit the same document simultaneously in Google Docs and see each others changes in real time)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/48512242/in-meteor-what-does-data-on-the-wire-mean\"\u003ecoagmano on Stackoverflow\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis idea was pretty interesting: a UI could always be considered up to date even if another client created a new row in the database. This is because Meteor would listen to the changelog of the MongoDB it was connected to, and then if a client was subscribed to the dataset that change belonged it, Meteor would push that change over the connected websocket.\u003c/p\u003e\n\u003cp\u003eData on the wire enabled clients to stay up-to-date with any changes and create an amazing experience for users who would see changes instantly. For developers, this was also a huge win for prototyping applications.\u003c/p\u003e\n\u003cp\u003eBut the problem with data on the wire is that the client can subscribe to a dataset with additional MongoDB filters, but the server now needs to keep track of what clients are subscribed to what subset of data.\u003c/p\u003e\n\u003cp\u003eIf we start with a dataset \u003ccode\u003eA\u003c/code\u003e, and a user creates a new item \u003ccode\u003ei\u003c/code\u003e, then we know that if a user is subscribed to dataset \u003ccode\u003eA\u003c/code\u003e, we can just send the changes for \u003ccode\u003ei\u003c/code\u003e via a websocket.\u003c/p\u003e\n\u003cdiv class=\"py-8 [\u0026amp;_svg]:m-auto\"\u003e\u003cdiv class=\"mermaid\" data-mermaid-src=\"sequenceDiagram\n    Client-\u0026gt;\u0026gt;Server: Subscribe to dataset A\n    MongoDB--\u0026gt;\u0026gt;Server: New item i was inserted into A\n    Server--\u0026gt;\u0026gt;Client: Push new item i via websocket\"\u003esequenceDiagram\n    Client-\u0026gt;\u0026gt;Server: Subscribe to dataset A\n    MongoDB--\u0026gt;\u0026gt;Server: New item i was inserted into A\n    Server--\u0026gt;\u0026gt;Client: Push new item i via websocket\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eBut if we want to start scaling our servers up, then we must broadcast any change to dataset \u003ccode\u003eA\u003c/code\u003e to every service, and then each service must check if any websocket is subscribed to \u003ccode\u003eA\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"py-8 [\u0026amp;_svg]:m-auto\"\u003e\u003cdiv class=\"mermaid\" data-mermaid-src=\"graph LR\n  MongoDB --\u0026gt; Server1\n  Client --\u0026gt; Server2\n  MongoDB --\u0026gt; Server2\n  MongoDB --\u0026gt; Server3 \"\u003egraph LR\n  MongoDB --\u0026gt; Server1\n  Client --\u0026gt; Server2\n  MongoDB --\u0026gt; Server2\n  MongoDB --\u0026gt; Server3 \u003c/div\u003e\u003c/div\u003e\n\u003cp\u003e(Technically, each server would either read from the MongoDB change stream, or have a service push an event to them that is listening to the change stream)\u003c/p\u003e\n\u003cp\u003eNow, each Service needs to additionally check if the item \u003ccode\u003ei\u003c/code\u003e meets any additional filter criteria that each subscriber may have for dataset \u003ccode\u003eA\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eAs datasets grow and filters become more computationally expensive, this can cause a lot of processing and memory burden for each Server.\u003c/p\u003e\n\u003cp\u003eThis is such a problem that it is even called out in the Meteor documentation: \u003cstrong\u003eScaling Updates\u003c/strong\u003e.\u003c/p\u003e\n\u003cblockquote class=\"border-l-4 border-gray-300 pl-4\"\u003e\n\u003cp\u003eAs previously mentioned, Meteor uses MongoDB‚Äôs Oplog to identify which changes to apply to which publication. Each change to the database is processed by every Meteor server, so frequent changes can result in high CPU usage across the board. At the same time, your database will come under higher load as all your servers keep fetching data from the oplog.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eI‚Äôve just thought about this recently since I had a conversation about keeping UI‚Äôs up-to-date with realtime data based on subscribing to that dataset via a websocket and it sounded eerily familiar to problems I have seen in the past.\u003c/p\u003e\n\u003cp\u003eIn fact, similarly, I‚Äôve seen trouble with GraphQL Subscriptions having similar issues, since each server node now needs to identify when to push data back to a subscriber:\u003c/p\u003e\n\u003cblockquote class=\"border-l-4 border-gray-300 pl-4\"\u003e\n\u003cp\u003eGraphQL Subscriptions (GQLS) are a mechanism which allow clients to subscribe to changes in a piece of data from the server, and get notified whenever that data changes.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://relay.dev/docs/v13.0.0/guided-tour/updating-data/graphql-subscriptions/\"\u003eThe relay spec\u003c/a\u003e makes no mention of how a server might do this though. There is a handy tutorial by LogRocket on implementing a NodeJS server to handle subscriptions though: \u003ca href=\"https://blog.logrocket.com/graphql-subscriptions-nodejs-express/\"\u003eGraphQL Subscriptions with NodeJS and Express\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eBut if you look at the diagrams, they seem awfully familiar‚Ä¶\u003c/p\u003e","contentCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    blockquote: \"blockquote\",\n    ul: \"ul\",\n    li: \"li\",\n    code: \"code\",\n    strong: \"strong\"\n  }, props.components), {Mermaid} = _components;\n  if (!Mermaid) _missingMdxReference(\"Mermaid\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Back when \", _jsx(_components.a, {\n        href: \"https://www.meteor.com/\",\n        children: \"Meteor\"\n      }), \" was in vogue, they popularized the concept of ‚ÄúData on the wire‚Äù. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"Data on the wire refers mostly to the way that Meteor forms a websocket connection to the server on page load and then transfers the data needed over that connection.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The websocket is a live connection and as the data changes, the updates are automatically pushed over the wire and the client updates in real time. (Similar to how many people can edit the same document simultaneously in Google Docs and see each others changes in real time)\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://stackoverflow.com/questions/48512242/in-meteor-what-does-data-on-the-wire-mean\",\n          children: \"coagmano on Stackoverflow\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This idea was pretty interesting: a UI could always be considered up to date even if another client created a new row in the database. This is because Meteor would listen to the changelog of the MongoDB it was connected to, and then if a client was subscribed to the dataset that change belonged it, Meteor would push that change over the connected websocket.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Data on the wire enabled clients to stay up-to-date with any changes and create an amazing experience for users who would see changes instantly. For developers, this was also a huge win for prototyping applications.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But the problem with data on the wire is that the client can subscribe to a dataset with additional MongoDB filters, but the server now needs to keep track of what clients are subscribed to what subset of data.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we start with a dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \", and a user creates a new item \", _jsx(_components.code, {\n        children: \"i\"\n      }), \", then we know that if a user is subscribed to dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \", we can just send the changes for \", _jsx(_components.code, {\n        children: \"i\"\n      }), \" via a websocket.\"]\n    }), \"\\n\", _jsx(Mermaid, {\n      chart: \"sequenceDiagram\\n    Client-\u003e\u003eServer: Subscribe to dataset A\\n    MongoDB--\u003e\u003eServer: New item i was inserted into A\\n    Server--\u003e\u003eClient: Push new item i via websocket\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"But if we want to start scaling our servers up, then we must broadcast any change to dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \" to every service, and then each service must check if any websocket is subscribed to \", _jsx(_components.code, {\n        children: \"A\"\n      }), \":\"]\n    }), \"\\n\", _jsx(Mermaid, {\n      chart: \"graph LR\\n  MongoDB --\u003e Server1\\n  Client --\u003e Server2\\n  MongoDB --\u003e Server2\\n  MongoDB --\u003e Server3 \"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"(Technically, each server would either read from the MongoDB change stream, or have a service push an event to them that is listening to the change stream)\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now, each Service needs to additionally check if the item \", _jsx(_components.code, {\n        children: \"i\"\n      }), \" meets any additional filter criteria that each subscriber may have for dataset \", _jsx(_components.code, {\n        children: \"A\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As datasets grow and filters become more computationally expensive, this can cause a lot of processing and memory burden for each Server.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This is such a problem that it is even called out in the Meteor documentation: \", _jsx(_components.strong, {\n        children: \"Scaling Updates\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"As previously mentioned, Meteor uses MongoDB‚Äôs Oplog to identify which changes to apply to which publication. Each change to the database is processed by every Meteor server, so frequent changes can result in high CPU usage across the board. At the same time, your database will come under higher load as all your servers keep fetching data from the oplog.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I‚Äôve just thought about this recently since I had a conversation about keeping UI‚Äôs up-to-date with realtime data based on subscribing to that dataset via a websocket and it sounded eerily familiar to problems I have seen in the past.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In fact, similarly, I‚Äôve seen trouble with GraphQL Subscriptions having similar issues, since each server node now needs to identify when to push data back to a subscriber:\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"GraphQL Subscriptions (GQLS) are a mechanism which allow clients to subscribe to changes in a piece of data from the server, and get notified whenever that data changes.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"https://relay.dev/docs/v13.0.0/guided-tour/updating-data/graphql-subscriptions/\",\n        children: \"The relay spec\"\n      }), \" makes no mention of how a server might do this though. There is a handy tutorial by LogRocket on implementing a NodeJS server to handle subscriptions though: \", _jsx(_components.a, {\n        href: \"https://blog.logrocket.com/graphql-subscriptions-nodejs-express/\",\n        children: \"GraphQL Subscriptions with NodeJS and Express\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But if you look at the diagrams, they seem awfully familiar‚Ä¶\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","excerptRaw":"\nBack when [Meteor](https://www.meteor.com/) was in vogue, they popularized the concept of ‚ÄúData on the wire‚Äù. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.","excerptHTML":"\u003cp\u003eBack when \u003ca href=\"https://www.meteor.com/\"\u003eMeteor\u003c/a\u003e was in vogue, they popularized the concept of ‚ÄúData on the wire‚Äù. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\u003c/p\u003e","excerptCode":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\"\n  }, props.components);\n  return _jsxs(_components.p, {\n    children: [\"Back when \", _jsx(_components.a, {\n      href: \"https://www.meteor.com/\",\n      children: \"Meteor\"\n    }), \" was in vogue, they popularized the concept of ‚ÄúData on the wire‚Äù. This was the idea that the UI would be updated with changes from the dataset it is subscribed to.\"]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","tags":["architecture"]}],"hasNextPage":false,"hasPreviousPage":true},"__N_SSG":true},"page":"/blog/[page]","query":{"page":"1"},"buildId":"gEVTUNzVunNOiSnIwtpBI","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>